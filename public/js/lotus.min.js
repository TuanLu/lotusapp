!function(e){function t(t){for(var n,i,l=t[0],o=t[1],h=t[2],d=0,p=[];d<l.length;d++)i=l[d],r[i]&&p.push(r[i][0]),r[i]=0;for(n in o)Object.prototype.hasOwnProperty.call(o,n)&&(e[n]=o[n]);for(c&&c(t);p.length;)p.shift()();return s.push.apply(s,h||[]),a()}function a(){for(var e,t=0;t<s.length;t++){for(var a=s[t],n=!0,l=1;l<a.length;l++){var o=a[l];0!==r[o]&&(n=!1)}n&&(s.splice(t--,1),e=i(i.s=a[0]))}return e}var n={},r={1:0},s=[];function i(t){if(n[t])return n[t].exports;var a=n[t]={i:t,l:!1,exports:{}};return e[t].call(a.exports,a,a.exports,i),a.l=!0,a.exports}i.m=e,i.c=n,i.d=function(e,t,a){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(i.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)i.d(a,n,function(t){return e[t]}.bind(null,n));return a},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="";var l=window.webpackJsonp=window.webpackJsonp||[],o=l.push.bind(l);l.push=t,l=l.slice();for(var h=0;h<l.length;h++)t(l[h]);var c=o;s.push([492,0]),a()}({315:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),s=a(10),i=a.n(s),l=a(24),o=a(494),h=a(17),c=a(495),d=a(296);var p={START_APP:"START_APP",UPDATE_STATE_DATA:"UPDATE_STATE_DATA"};const u=e=>({type:p.UPDATE_STATE_DATA,updateData:e});d.a.SubMenu;var m,g,f=class extends r.a.Component{renderMenuItem(){let e=this.props.mainState,t=(e.defaultRouter,e.userRoles.filter(e=>!1!==e.include_in_menu));return t=t.map((e,t)=>r.a.createElement(d.a.Item,{onClick:()=>{this.props.dispatch(u({defaultRouter:e.path}))},key:e.path},r.a.createElement(h.a,{type:e.icon}),r.a.createElement("span",null,e.label)))}render(){let e=this.props.mainState.defaultRouter;return r.a.createElement("div",null,r.a.createElement(d.a,{defaultSelectedKeys:[e],mode:"inline",theme:"dark"},this.renderMenuItem()))}},y=a(505),E=a(41),S=a(502),x=a(405),v=a(497),_=a(132),w=a(411),C=a(503);Object.assign;function b(e,t){let a={};return t=t||"id",e.length&&e.forEach(e=>{a[e[t]]=e}),a}window.ISD_BASE_URL&&""!=window.ISD_BASE_URL||(window.ISD_BASE_URL=window.location.protocol+"//"+(m=document.location.href,null!=(g=m.match(/:\/\/(www[0-9]?\.)?(.[^/:]+)/i))&&g.length>2&&"string"==typeof g[2]&&g[2].length>0?g[2]:null)+"/");const k=()=>{let e=sessionStorage.getItem("ISD_TOKEN");if(""!=e&&null!=e)return{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer "+e}},I=[{value:"0",text:"Ngừng kích hoạt"},{value:"1",text:"Kích hoạt"}],j=[{id:"1",value:"1",text:"Phê duyệt"},{id:"2",value:"2",text:"Chờ phê duyệt"}],D=[{id:"0",value:"0",text:"Chờ"},{id:"2",value:"2",text:"Không đạt"},{id:"1",value:"1",text:"Đạt"}];var O=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e};function T(e,t){var a={};for(var n in e)t.indexOf(n)>=0||Object.prototype.hasOwnProperty.call(e,n)&&(a[n]=e[n]);return a}const q=S.a.Item,N=r.a.createContext(),A=S.a.create()(e=>{let t=e.form,a=(e.index,T(e,["form","index"]));return r.a.createElement(N.Provider,{value:t},r.a.createElement("tr",a))});class L extends r.a.Component{constructor(...e){var t;return t=super(...e),this.getInput=(()=>{switch(this.props.inputType){case"ranking":return r.a.createElement(_.a,{placeholder:"Chọn xếp hạng"},r.a.createElement(_.a.Option,{value:"A"},"A"),r.a.createElement(_.a.Option,{value:"B"},"B"),r.a.createElement(_.a.Option,{value:"C"},"C"),r.a.createElement(_.a.Option,{value:"D"},"D"));default:return r.a.createElement(v.a,null)}}),t}render(){var e=this.props;const t=e.editing,a=e.required,n=e.dataIndex,s=e.title,i=(e.inputType,e.record),l=(e.index,T(e,["editing","required","dataIndex","title","inputType","record","index"]));return r.a.createElement(N.Consumer,null,e=>{const o=e.getFieldDecorator;return r.a.createElement("td",l,t?r.a.createElement(q,{style:{margin:0}},o(n,{rules:[{required:a,message:`Hãy nhập dữ liệu ô ${s}!`}],initialValue:i[n]})(this.getInput())):l.children)})}}var R=class extends r.a.Component{constructor(e){super(e),this.isEditing=(e=>e.key===this.state.editingKey),this.cancel=(e=>{this.setState({editingKey:""}),1==this.state.newitem&&(this.state.newitem=0,this.delete(e))}),this.delete=(e=>{if(e.id)fetch(ISD_BASE_URL+"npp/deleteNpp/"+e.id,{headers:k()}).then(e=>e.json()).then(e=>{if("error"==e.status)c.a.error("Có lỗi xảy ra khi xoá nhà cung cấp!",3);else{let t=this.state.data.filter(t=>t.id!=e.data);this.setState({data:t}),c.a.success(e.message),this.state.newitem=0}}).catch(e=>{c.a.error("Có lỗi xảy ra khi xoá nhà cung cấp!",3),console.log(e)});else if(e.key){let t=this.state.data.filter(t=>t.key!=e.key);this.setState({data:t})}}),this.state={data:[],editingKey:"",newitem:0},this.columns=[{title:"Mã NCC",dataIndex:"ma_npp",width:"10%",editable:!0,required:!0},{title:"Tên",dataIndex:"name",editable:!0,required:!0},{title:"Địa chỉ",dataIndex:"address",editable:!0,required:!0},{title:"Điện thoại",dataIndex:"phone",editable:!0},{title:"Xếp hạng",dataIndex:"ranking",editable:!0},{title:"Actions",dataIndex:"operation",render:(e,t)=>{const a=this.isEditing(t);return r.a.createElement("div",{style:{minWidth:100}},a?r.a.createElement("span",null,r.a.createElement(N.Consumer,null,e=>r.a.createElement("a",{href:"javascript:;",onClick:()=>this.save(e,t.key),style:{marginRight:8}},"Lưu")),r.a.createElement(y.a,{title:"Bạn thật sự muốn huỷ?",onConfirm:()=>this.cancel(t)},r.a.createElement("a",{href:"javascript:;"},"Huỷ"))):r.a.createElement(r.a.Fragment,null,r.a.createElement("a",{href:"javascript:;",onClick:()=>this.edit(t.key)},"Sửa")," | ",r.a.createElement(y.a,{title:"Bạn thật sự muốn xoá?",okType:"danger",onConfirm:()=>this.delete(t)},r.a.createElement("a",{href:"javascript:;"},"Xoá"))))}}]}addNewRow(){if(0==this.state.newitem){let e=this.getDefaultFields();e=O({},e,{key:this.state.data.length+1}),this.setState({data:[e,...this.state.data],editingKey:e.key}),this.state.newitem=1}else c.a.error("Bạn đang thêm mới NCC rồi ...")}getDefaultFields(){return{ma_npp:"",name:"",address:"",phone:"",ranking:"A"}}edit(e){this.setState({editingKey:e})}save(e,t){e.validateFields((e,a)=>{if(e)return;const n=[...this.state.data],r=n.findIndex(e=>t===e.key);if(r>-1){const e=n[r];let t=O({},e,a);fetch(ISD_BASE_URL+"npp/updateNpp",{method:"POST",headers:k(),body:JSON.stringify(t)}).then(e=>e.json()).then(e=>{"error"==e.status?(c.a.error(e.message,3),e.show_login&&this.props.dispatch(u({showLogin:!0}))):(n.splice(r,1,O({},t,e.data)),this.setState({data:n,editingKey:""}),c.a.success(e.message),this.state.newitem=0)}).catch(e=>{console.log("parsing failed",e),c.a.error("Có lỗi xảy ra trong quá trình lưu hoặc chỉnh sửa!")})}else n.push(data),this.setState({data:n,editingKey:""})})}fetchData(){fetch(ISD_BASE_URL+"npp/fetchNpp",{headers:k()}).then(e=>e.json()).then(e=>{if("error"==e.status)c.a.warning(e.message,3);else if(e.data){let t=e.data.map((e,t)=>O({},e,{key:t}));this.setState({data:t})}}).catch(e=>{c.a.error("Có lỗi khi tải dữ liệu nhà cung cấp!",3),console.log(e)})}componentDidMount(){this.fetchData()}render(){const e={body:{row:A,cell:L}},t=this.columns.map(e=>e.editable?O({},e,{onCell:t=>({record:t,inputType:e.dataIndex,dataIndex:e.dataIndex,title:e.title,editing:this.isEditing(t),required:e.required})}):e);return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"table-operations"},r.a.createElement(w.a,null,r.a.createElement(x.a,{span:12},r.a.createElement("h2",{className:"head-title"},"Quản lý nhà cung cấp")),r.a.createElement(x.a,{span:12},r.a.createElement("div",{className:"action-btns"},r.a.createElement(E.a,{onClick:()=>this.addNewRow(),type:"primary",icon:"plus"},"Thêm mới NCC"))))),r.a.createElement(C.a,{components:e,bordered:!0,dataSource:this.state.data,columns:t,rowClassName:"editable-row"}))}},P=a(499);const K=P.a.SHOW_PARENT;var M=Object(l.b)(e=>({mainState:e.main.present}))(class extends r.a.Component{constructor(e){super(e),this.onChange=(e=>{this.setState({value:e}),this.props.onChange&&this.props.onChange(e)}),this.state={value:this.props.selectedRoles||[],treeData:[]}}fetchData(){fetch(ISD_BASE_URL+"fetchAllRoles").then(e=>e.json()).then(e=>{e.data?(this.setState({treeData:e.data}),this.props.dispatch(u({allUserRoles:e.data}))):console.warn(e.message)}).catch(e=>{console.log(e)})}componentDidMount(){let e=this.props.mainState.allUserRoles;e?this.setState({treeData:e}):this.fetchData()}render(){const e={treeData:this.state.treeData,value:this.state.value,onChange:this.onChange,treeCheckable:!0,showCheckedStrategy:K,searchPlaceholder:"Hãy chọn quyền",style:{width:300}};return r.a.createElement(P.a,e)}}),B=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e};function Y(e,t){var a={};for(var n in e)t.indexOf(n)>=0||Object.prototype.hasOwnProperty.call(e,n)&&(a[n]=e[n]);return a}const F=S.a.Item,U=r.a.createContext(),H=S.a.create()(e=>{let t=e.form,a=(e.index,Y(e,["form","index"]));return r.a.createElement(U.Provider,{value:t},r.a.createElement("tr",a))});class Q extends r.a.Component{constructor(...e){var t;return t=super(...e),this.getInput=(()=>{switch(this.props.inputType){case"status":return r.a.createElement(_.a,{placeholder:"Chọn xếp hạng"},I.map(e=>r.a.createElement(_.a.Option,{key:e.value,key:e.value},e.text)));case"hash":return r.a.createElement(v.a,{type:"password",placeholder:"Nhập mật khẩu"});case"roles":let e=[];return this.props.record&&this.props.record.roles&&""!=this.props.record.roles&&(e=this.props.record.roles.split(",")),r.a.createElement(M,{selectedRoles:e});default:return r.a.createElement(v.a,null)}}),t}render(){var e=this.props;const t=e.editing,a=e.required,n=e.dataIndex,s=e.title,i=(e.inputType,e.record),l=(e.index,Y(e,["editing","required","dataIndex","title","inputType","record","index"]));return r.a.createElement(U.Consumer,null,e=>{const o=e.getFieldDecorator;return r.a.createElement("td",l,t?r.a.createElement(F,{style:{margin:0}},o(n,{rules:(e=>{let t=[{required:a,message:`Hãy nhập dữ liệu ô ${s}!`}];return"email"==n&&(t=[...t,{type:"email",message:"Email không hợp lệ"}]),t})(),initialValue:i[n]})(this.getInput())):l.children)})}}var V=class extends r.a.Component{constructor(e){super(e),this.isEditing=(e=>e.key===this.state.editingKey),this.cancel=(e=>{this.setState({editingKey:""}),1==this.state.newitem&&(this.state.newitem=0,this.delete(e))}),this.delete=(e=>{if(e.id)fetch(ISD_BASE_URL+"users/deleteUser/"+e.id,{headers:k()}).then(e=>e.json()).then(e=>{if("error"==e.status)c.a.error(response.message,3);else{let t=this.state.data.filter(t=>t.id!=e.data);this.setState({data:t}),c.a.success(e.message),this.state.newitem=0}}).catch(e=>{c.a.error("Có lỗi xảy ra khi xoá user!",3),console.log(e)});else if(e.key){let t=this.state.data.filter(t=>t.key!=e.key);this.setState({data:t})}}),this.state={data:[],editingKey:"",newitem:0},this.columns=[{title:"Tên đăng nhập",dataIndex:"username",editable:!0,width:"12%",required:!0},{title:"Email",dataIndex:"email",editable:!0,width:"15%",required:!0},{title:"Mật khẩu",dataIndex:"hash",editable:!0,width:"10%",required:!1,render:(e,t)=>"Đã mã hoá"},{title:"Họ và tên",dataIndex:"name",editable:!0,width:"15%",required:!1},{title:"Quyền",dataIndex:"roles",width:"25%",editable:!0,required:!1},{title:"Trạng thái",dataIndex:"status",editable:!0,render:(e,t)=>{let a=I.filter(t=>t.value==e);return r.a.createElement("span",null,a[0].text)}},{title:"Actions",dataIndex:"operation",render:(e,t)=>{const a=this.isEditing(t);return r.a.createElement("div",{style:{minWidth:100}},a?r.a.createElement("span",null,r.a.createElement(U.Consumer,null,e=>r.a.createElement("a",{href:"javascript:;",onClick:()=>this.save(e,t.key),style:{marginRight:8}},"Lưu")),r.a.createElement(y.a,{title:"Bạn thật sự muốn huỷ?",onConfirm:()=>this.cancel(t)},r.a.createElement("a",{href:"javascript:;"}," "," | ","Huỷ"))):r.a.createElement(r.a.Fragment,null,r.a.createElement("a",{href:"javascript:;",onClick:()=>this.edit(t.key)},"Sửa")," | ",r.a.createElement(y.a,{title:"Bạn thật sự muốn xoá?",okType:"danger",onConfirm:()=>this.delete(t)},r.a.createElement("a",{href:"javascript:;"},"Xoá"))))}}]}addNewRow(){if(0==this.state.newitem){let e=this.getDefaultFields();e=B({},e,{key:this.state.data.length+1}),this.setState({data:[e,...this.state.data],editingKey:e.key}),this.state.newitem=1}else c.a.error("Bạn đang thêm mới người dùng rồi ...")}getDefaultFields(){return{username:"",email:"",name:"",hash:"",status:"1",roles:[]}}edit(e){this.setState({editingKey:e})}save(e,t){e.validateFields((e,a)=>{if(e)return;const n=[...this.state.data],r=n.findIndex(e=>t===e.key);if(r>-1){const e=n[r];let t=B({},e,a);fetch(ISD_BASE_URL+"users/updateUser",{method:"POST",headers:k(),body:JSON.stringify(t)}).then(e=>e.json()).then(e=>{"error"==e.status?(c.a.error(e.message,3),e.show_login&&this.props.dispatch(u({showLogin:!0}))):(n.splice(r,1,B({},t,e.data)),this.setState({data:n,editingKey:""}),c.a.success(e.message),this.state.newitem=0)}).catch(e=>{console.log("parsing failed",e),c.a.error("Có lỗi xảy ra trong quá trình lưu hoặc chỉnh sửa!")})}else n.push(data),this.setState({data:n,editingKey:""})})}fetchData(){fetch(ISD_BASE_URL+"users/fetchUsers",{headers:k()}).then(e=>e.json()).then(e=>{if("error"==e.status)c.a.warning(e.message,3);else if(e.data){let t=e.data.map((e,t)=>B({},e,{key:t}));this.setState({data:t})}}).catch(e=>{c.a.error("Có lỗi khi tải dữ liệu !",3),console.log(e)})}componentDidMount(){this.fetchData()}render(){const e={body:{row:H,cell:Q}},t=this.columns.map(e=>e.editable?B({},e,{onCell:t=>({record:t,inputType:e.dataIndex,dataIndex:e.dataIndex,title:e.title,editing:this.isEditing(t),required:e.required})}):e);return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"table-operations"},r.a.createElement(w.a,null,r.a.createElement(x.a,{span:12},r.a.createElement("h2",{className:"head-title"},"Quản lý người dùng")),r.a.createElement(x.a,{span:12},r.a.createElement("div",{className:"action-btns"},r.a.createElement(E.a,{onClick:()=>this.addNewRow(),type:"primary",icon:"plus"},"Thêm mới người dùng"))))),r.a.createElement(C.a,{components:e,bordered:!0,dataSource:this.state.data,columns:t,rowClassName:"editable-row"}))}},$=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e};const X=S.a.Item;var J=S.a.create()(class extends r.a.Component{constructor(...e){var t;return t=super(...e),this.state={loading:!1},this.handleSubmit=(e=>{e.preventDefault(),this.props.form.validateFields((e,t)=>{e||(this.setState({loading:!0}),this.getToken($({},t)))})}),t}getToken(e){fetch(ISD_BASE_URL+"token",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then(e=>e.json()).then(e=>{e.token?(sessionStorage.setItem("ISD_TOKEN",e.token),this.props.dispatch(u({showLogin:!1,userRoles:e.scopes||[],userInfo:e.userInfo,defaultRouter:e.scopes[0]&&e.scopes[0].path?e.scopes[0].path:""}))):(c.a.error(e.message,5),this.setState({loading:!1}))}).catch(e=>{console.warn(e),c.a.error("Có lỗi trong quá trình đăng nhập!")})}render(){const e=this.props.form.getFieldDecorator;return r.a.createElement("div",{className:"login-wrapper"},r.a.createElement("div",{className:"login-logo"},r.a.createElement("img",{src:"./images/logo.png"})),r.a.createElement(S.a,{onSubmit:this.handleSubmit,className:"login-form"},r.a.createElement(X,null,e("userName",{rules:[{required:!0,message:"Nhập tên đăng nhập!"}]})(r.a.createElement(v.a,{prefix:r.a.createElement(h.a,{type:"user",style:{color:"rgba(0,0,0,.25)"}}),placeholder:"Tên đăng nhập"}))),r.a.createElement(X,null,e("password",{rules:[{required:!0,message:"Nhập mật khẩu!"}]})(r.a.createElement(v.a,{prefix:r.a.createElement(h.a,{type:"lock",style:{color:"rgba(0,0,0,.25)"}}),type:"password",placeholder:"Mật khẩu"}))),r.a.createElement(X,null,r.a.createElement(E.a,{loading:this.state.loading,type:"primary",htmlType:"submit",className:"login-form-button"},"Đăng nhập"))))}});var z=class extends r.a.Component{showUserName(){let e=this.props.mainState.userInfo;if(e)return e.name||e.username||e.email}render(){return r.a.createElement("div",{className:"admin-user-info"},r.a.createElement("span",null,"Xin chào, ",r.a.createElement("b",null,this.showUserName())),r.a.createElement(E.a,{onClick:()=>{this.props.dispatch(u({showLogin:!0}))},type:"primary",ghost:!0},"Đăng xuất"))}},W=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e};class G extends r.a.Component{render(){return r.a.createElement("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%,-50%)"},className:"isd-app-loading"},r.a.createElement(h.a,{style:W({fontSize:46,color:"#08c",width:"100%"},this.props.style),type:"loading"}))}}var Z=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e};function ee(e,t){var a={};for(var n in e)t.indexOf(n)>=0||Object.prototype.hasOwnProperty.call(e,n)&&(a[n]=e[n]);return a}const te=S.a.Item,ae=r.a.createContext(),ne=S.a.create()(e=>{let t=e.form,a=(e.index,ee(e,["form","index"]));return r.a.createElement(ae.Provider,{value:t},r.a.createElement("tr",a))});class re extends r.a.Component{constructor(...e){var t;return t=super(...e),this.getInput=(()=>(this.props.inputType,r.a.createElement(v.a,null))),t}render(){var e=this.props;const t=e.editing,a=e.required,n=e.dataIndex,s=e.title,i=(e.inputType,e.record),l=(e.index,ee(e,["editing","required","dataIndex","title","inputType","record","index"]));return r.a.createElement(ae.Consumer,null,e=>{const o=e.getFieldDecorator;return r.a.createElement("td",l,t?r.a.createElement(te,{style:{margin:0}},o(n,{rules:[{required:a,message:`Hãy nhập dữ liệu ô ${s}!`}],initialValue:i[n]})(this.getInput())):l.children)})}}var se=class extends r.a.Component{constructor(e){super(e),this.isEditing=(e=>e.key===this.state.editingKey),this.cancel=(e=>{this.setState({editingKey:""}),1==this.state.newitem&&(this.state.newitem=0,this.delete(e))}),this.delete=(e=>{if(e.id)fetch(ISD_BASE_URL+"qlkho/deleteKho/"+e.id,{headers:k()}).then(e=>e.json()).then(e=>{if("error"==e.status)c.a.error("Có lỗi xảy ra khi xoá dữ liệu kho!",3);else{let t=this.state.data.filter(t=>t.id!=e.data);this.setState({data:t}),c.a.success(e.message),this.state.newitem=0}}).catch(e=>{c.a.error("Có lỗi xảy ra khi xoá dữ liệu kho!",3),console.log(e)});else if(e.key){let t=this.state.data.filter(t=>t.key!=e.key);this.setState({data:t})}}),this.state={data:[],editingKey:"",newitem:0},this.columns=[{title:"Mã Kho",dataIndex:"ma_kho",width:"10%",editable:!0,required:!0},{title:"Tên",dataIndex:"name",editable:!0,required:!0},{title:"Thông tin",dataIndex:"description",editable:!0,required:!0},{title:"Actions",dataIndex:"operation",render:(e,t)=>{const a=this.isEditing(t);return r.a.createElement("div",{style:{minWidth:100}},a?r.a.createElement("span",null,r.a.createElement(ae.Consumer,null,e=>r.a.createElement("a",{href:"javascript:;",onClick:()=>this.save(e,t.key),style:{marginRight:8}},"Lưu")),r.a.createElement(y.a,{title:"Bạn thật sự muốn huỷ?",onConfirm:()=>this.cancel(t)},r.a.createElement("a",{href:"javascript:;"},"Huỷ"))):r.a.createElement(r.a.Fragment,null,r.a.createElement("a",{href:"javascript:;",onClick:()=>this.edit(t.key)},"Sửa")," | ",r.a.createElement(y.a,{title:"Bạn thật sự muốn xoá?",okType:"danger",onConfirm:()=>this.delete(t)},r.a.createElement("a",{href:"javascript:;"},"Xoá"))))}}]}addNewRow(){if(0==this.state.newitem){let e=this.getDefaultFields();e=Z({},e,{key:this.state.data.length+1}),this.setState({data:[e,...this.state.data],editingKey:e.key}),this.state.newitem=1}else c.a.error("Bạn đang thêm mới kho rồi ...")}getDefaultFields(){return{ma_kho:"",name:"",description:""}}edit(e){this.setState({editingKey:e})}save(e,t){e.validateFields((e,a)=>{if(e)return;const n=[...this.state.data],r=n.findIndex(e=>t===e.key);if(r>-1){const e=n[r];let t=Z({},e,a);fetch(ISD_BASE_URL+"qlkho/updateKho",{method:"POST",headers:k(),body:JSON.stringify(t)}).then(e=>e.json()).then(e=>{"error"==e.status?c.a.error(e.message,3):(n.splice(r,1,Z({},t,e.data)),this.setState({data:n,editingKey:""}),c.a.success(e.message),this.state.newitem=0)}).catch(e=>{console.log("parsing failed",e),c.a.error("Có lỗi xảy ra trong quá trình lưu hoặc chỉnh sửa!")})}else n.push(data),this.setState({data:n,editingKey:""})})}fetchData(){fetch(ISD_BASE_URL+"qlkho/fetchKho",{headers:k()}).then(e=>e.json()).then(e=>{if("error"==e.status)c.a.warning(e.message,3);else if(e.data){let t=e.data.map((e,t)=>Z({},e,{key:t}));this.setState({data:t})}}).catch(e=>{c.a.error("Có lỗi khi tải dữ liệu dữ liệu kho!",3),console.log(e)})}componentDidMount(){this.fetchData()}render(){const e={body:{row:ne,cell:re}},t=this.columns.map(e=>e.editable?Z({},e,{onCell:t=>({record:t,inputType:e.dataIndex,dataIndex:e.dataIndex,title:e.title,editing:this.isEditing(t),required:e.required})}):e);return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"table-operations"},r.a.createElement(w.a,null,r.a.createElement(x.a,{span:12},r.a.createElement("h2",{className:"head-title"},"Quản lý kho")),r.a.createElement(x.a,{span:12},r.a.createElement("div",{className:"action-btns"},r.a.createElement(E.a,{onClick:()=>this.addNewRow(),type:"primary",icon:"plus"},"Thêm kho mới"))))),r.a.createElement(C.a,{components:e,bordered:!0,dataSource:this.state.data,columns:t,rowClassName:"editable-row"}))}},ie=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e};function le(e,t){var a={};for(var n in e)t.indexOf(n)>=0||Object.prototype.hasOwnProperty.call(e,n)&&(a[n]=e[n]);return a}const oe=S.a.Item,he=r.a.createContext(),ce=S.a.create()(e=>{let t=e.form,a=(e.index,le(e,["form","index"]));return r.a.createElement(he.Provider,{value:t},r.a.createElement("tr",a))});class de extends r.a.Component{constructor(...e){var t;return t=super(...e),this.getInput=(()=>{switch(this.props.inputType){case"ma_kho":let e=this.props.categories;return r.a.createElement(_.a,{style:{width:250},placeholder:"Chọn kho"},e.map(e=>r.a.createElement(_.a.Option,{key:e.id,value:e.ma_kho},e.name)));default:return r.a.createElement(v.a,null)}}),t}render(){var e=this.props;const t=e.editing,a=e.required,n=e.dataIndex,s=e.title,i=(e.inputType,e.record),l=(e.index,le(e,["editing","required","dataIndex","title","inputType","record","index"]));return r.a.createElement(he.Consumer,null,e=>{const o=e.getFieldDecorator;return r.a.createElement("td",l,t?r.a.createElement(oe,{style:{margin:0}},o(n,{rules:[{required:a,message:`Hãy nhập dữ liệu ô ${s}!`}],initialValue:i[n]})(this.getInput())):l.children)})}}var pe=class extends r.a.Component{constructor(e){super(e),this.isEditing=(e=>e.key===this.state.editingKey),this.cancel=(e=>{this.setState({editingKey:""}),1==this.state.newitem&&(this.state.newitem=0,this.delete(e))}),this.delete=(e=>{if(e.id)fetch(ISD_BASE_URL+"qlvtkho/deleteVtkho/"+e.id,{headers:k()}).then(e=>e.json()).then(e=>{if("error"==e.status)c.a.error("Có lỗi xảy ra khi xoá dữ liệu vị trí kho!",3);else{let t=this.state.data.filter(t=>t.id!=e.data);this.setState({data:t}),c.a.success(e.message),this.state.newitem=0}}).catch(e=>{c.a.error("Có lỗi xảy ra khi xoá dữ liệu vị trí kho!",3),console.log(e)});else if(e.key){let t=this.state.data.filter(t=>t.key!=e.key);this.setState({data:t})}}),this.state={data:[],editingKey:"",newitem:0},this.columns=[{title:"Mã Kho",dataIndex:"ma_kho",width:"25%",editable:!0,required:!0,render:(e,t)=>{let a=e;return this.state.categoryList&&this.state.categoryList[e]&&(a=this.state.categoryList[e].name),r.a.createElement("span",null,e," - ",a)}},{title:"Tên vị trí",dataIndex:"name",editable:!0,required:!0},{title:"Thông tin",dataIndex:"description",editable:!0,required:!0},{title:"Actions",dataIndex:"operation",render:(e,t)=>{const a=this.isEditing(t);return r.a.createElement("div",{style:{minWidth:100}},a?r.a.createElement("span",null,r.a.createElement(he.Consumer,null,e=>r.a.createElement("a",{href:"javascript:;",onClick:()=>this.save(e,t.key),style:{marginRight:8}},"Lưu")),r.a.createElement(y.a,{title:"Bạn thật sự muốn huỷ?",onConfirm:()=>this.cancel(t)},r.a.createElement("a",{href:"javascript:;"},"Huỷ"))):r.a.createElement(r.a.Fragment,null,r.a.createElement("a",{href:"javascript:;",onClick:()=>this.edit(t.key)},"Sửa")," | ",r.a.createElement(y.a,{title:"Bạn thật sự muốn xoá?",okType:"danger",onConfirm:()=>this.delete(t)},r.a.createElement("a",{href:"javascript:;"},"Xoá"))))}}]}addNewRow(){if(0==this.state.newitem){let e=this.getDefaultFields();e=ie({},e,{key:this.state.data.length+1}),this.setState({data:[e,...this.state.data],editingKey:e.key}),this.state.newitem=1}else c.a.error("Bạn đang thêm mới vị trí kho rồi ...")}getDefaultFields(){return{ma_kho:"",name:"",description:""}}edit(e){this.setState({editingKey:e})}save(e,t){e.validateFields((e,a)=>{if(e)return;const n=[...this.state.data],r=n.findIndex(e=>t===e.key);if(r>-1){const e=n[r];let t=ie({},e,a);fetch(ISD_BASE_URL+"qlvtkho/updateVtkho",{method:"POST",headers:k(),body:JSON.stringify(t)}).then(e=>e.json()).then(e=>{"error"==e.status?c.a.error(e.message,3):(n.splice(r,1,ie({},t,e.data)),this.setState({data:n,editingKey:""}),c.a.success(e.message),this.state.newitem=0)}).catch(e=>{console.log("parsing failed",e),c.a.error("Có lỗi xảy ra trong quá trình lưu hoặc chỉnh sửa!")})}else n.push(data),this.setState({data:n,editingKey:""})})}fetchCategories(){fetch(ISD_BASE_URL+"qlkho/fetchKho",{headers:k()}).then(e=>e.json()).then(e=>{e.data?e.data&&(this.props.dispatch(u({categories:e.data})),this.setState({categoryList:b(e.data,"ma_kho")})):c.a.error(e.message)}).catch(e=>{console.log(e)})}fetchData(){fetch(ISD_BASE_URL+"qlvtkho/fetchVtkho",{headers:k()}).then(e=>e.json()).then(e=>{if("error"==e.status)c.a.warning(e.message,3);else if(e.data){let t=e.data.map((e,t)=>ie({},e,{key:t}));this.setState({data:t})}}).catch(e=>{c.a.error("Có lỗi khi tải dữ liệu dữ liệu vị trí kho!",3),console.log(e)})}componentDidMount(){this.fetchCategories(),this.fetchData()}render(){const e={body:{row:ce,cell:de}};let t=this.props.mainState.categories;const a=this.columns.map(e=>e.editable?ie({},e,{onCell:a=>({record:a,inputType:e.dataIndex,dataIndex:e.dataIndex,title:e.title,editing:this.isEditing(a),required:e.required,categories:t})}):e);return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"table-operations"},r.a.createElement(w.a,null,r.a.createElement(x.a,{span:12},r.a.createElement("h2",{className:"head-title"},"Quản lý vị trí trong kho")),r.a.createElement(x.a,{span:12},r.a.createElement("div",{className:"action-btns"},r.a.createElement(E.a,{onClick:()=>this.addNewRow(),type:"primary",icon:"plus"},"Thêm vị trí kho mới"))))),r.a.createElement(C.a,{components:e,bordered:!0,dataSource:this.state.data,columns:a,rowClassName:"editable-row"}))}},ue=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e};function me(e,t){var a={};for(var n in e)t.indexOf(n)>=0||Object.prototype.hasOwnProperty.call(e,n)&&(a[n]=e[n]);return a}const ge=S.a.Item,fe=r.a.createContext(),ye=S.a.create()(e=>{let t=e.form,a=(e.index,me(e,["form","index"]));return r.a.createElement(fe.Provider,{value:t},r.a.createElement("tr",a))});class Ee extends r.a.Component{constructor(...e){var t;return t=super(...e),this.getInput=(()=>(this.props.inputType,r.a.createElement(v.a,null))),t}render(){var e=this.props;const t=e.editing,a=e.required,n=e.dataIndex,s=e.title,i=(e.inputType,e.record),l=(e.index,me(e,["editing","required","dataIndex","title","inputType","record","index"]));return r.a.createElement(fe.Consumer,null,e=>{const o=e.getFieldDecorator;return r.a.createElement("td",l,t?r.a.createElement(ge,{style:{margin:0}},o(n,{rules:[{required:a,message:`Hãy nhập dữ liệu ô ${s}!`}],initialValue:i[n]})(this.getInput())):l.children)})}}var Se=class extends r.a.Component{constructor(e){super(e),this.isEditing=(e=>e.key===this.state.editingKey),this.cancel=(e=>{this.setState({editingKey:""}),1==this.state.newitem&&(this.state.newitem=0,this.delete(e))}),this.delete=(e=>{if(e.id)fetch(ISD_BASE_URL+"qlcate/deleteCate/"+e.id,{headers:k()}).then(e=>e.json()).then(e=>{if("error"==e.status)c.a.error("Có lỗi xảy ra khi xoá dữ liệu kho!",3);else{let t=this.state.data.filter(t=>t.id!=e.data);this.setState({data:t}),c.a.success(e.message),this.state.newitem=0}}).catch(e=>{c.a.error("Có lỗi xảy ra khi xoá dữ liệu kho!",3),console.log(e)});else if(e.key){let t=this.state.data.filter(t=>t.key!=e.key);this.setState({data:t})}}),this.state={data:[],editingKey:"",newitem:0},this.columns=[{title:"Tên danh mục",dataIndex:"name",editable:!0,required:!0},{title:"Thông tin",dataIndex:"description",editable:!0,required:!0},{title:"Actions",dataIndex:"operation",render:(e,t)=>{const a=this.isEditing(t);return r.a.createElement("div",{style:{minWidth:100}},a?r.a.createElement("span",null,r.a.createElement(fe.Consumer,null,e=>r.a.createElement("a",{href:"javascript:;",onClick:()=>this.save(e,t.key),style:{marginRight:8}},"Lưu")),r.a.createElement(y.a,{title:"Bạn thật sự muốn huỷ?",onConfirm:()=>this.cancel(t)},r.a.createElement("a",{href:"javascript:;"},"Huỷ"))):r.a.createElement(r.a.Fragment,null,r.a.createElement("a",{href:"javascript:;",onClick:()=>this.edit(t.key)},"Sửa")," | ",r.a.createElement(y.a,{title:"Bạn thật sự muốn xoá?",okType:"danger",onConfirm:()=>this.delete(t)},r.a.createElement("a",{href:"javascript:;"},"Xoá"))))}}]}addNewRow(){if(0==this.state.newitem){let e=this.getDefaultFields();e=ue({},e,{key:this.state.data.length+1}),this.setState({data:[e,...this.state.data],editingKey:e.key}),this.state.newitem=1}else c.a.error("Bạn đang thêm mới danh mục rồi ...")}getDefaultFields(){return{name:"",description:""}}edit(e){this.setState({editingKey:e})}save(e,t){e.validateFields((e,a)=>{if(e)return;const n=[...this.state.data],r=n.findIndex(e=>t===e.key);if(r>-1){const e=n[r];let t=ue({},e,a);fetch(ISD_BASE_URL+"qlcate/updateCate",{method:"POST",headers:k(),body:JSON.stringify(t)}).then(e=>e.json()).then(e=>{"error"==e.status?c.a.error(e.message,3):(n.splice(r,1,ue({},t,e.data)),this.setState({data:n,editingKey:""}),c.a.success(e.message),this.state.newitem=0)}).catch(e=>{console.log("parsing failed",e),c.a.error("Có lỗi xảy ra trong quá trình lưu hoặc chỉnh sửa!")})}else n.push(data),this.setState({data:n,editingKey:""})})}fetchData(){fetch(ISD_BASE_URL+"qlcate/fetchCate",{headers:k()}).then(e=>e.json()).then(e=>{if("error"==e.status)c.a.warning(e.message,3);else if(e.data){let t=e.data.map((e,t)=>ue({},e,{key:t}));this.setState({data:t})}}).catch(e=>{c.a.error("Có lỗi khi tải dữ liệu dữ liệu danh mục!",3),console.log(e)})}componentDidMount(){this.fetchData()}render(){const e={body:{row:ye,cell:Ee}},t=this.columns.map(e=>e.editable?ue({},e,{onCell:t=>({record:t,inputType:e.dataIndex,dataIndex:e.dataIndex,title:e.title,editing:this.isEditing(t),required:e.required})}):e);return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"table-operations"},r.a.createElement(w.a,null,r.a.createElement(x.a,{span:12},r.a.createElement("h2",{className:"head-title"},"Quản lý Danh mục")),r.a.createElement(x.a,{span:12},r.a.createElement("div",{className:"action-btns"},r.a.createElement(E.a,{onClick:()=>this.addNewRow(),type:"primary",icon:"plus"},"Thêm mới"))))),r.a.createElement(C.a,{components:e,bordered:!0,dataSource:this.state.data,columns:t,rowClassName:"editable-row"}))}},xe=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e};function ve(e,t){var a={};for(var n in e)t.indexOf(n)>=0||Object.prototype.hasOwnProperty.call(e,n)&&(a[n]=e[n]);return a}const _e=S.a.Item,we=r.a.createContext(),Ce=S.a.create()(e=>{let t=e.form,a=(e.index,ve(e,["form","index"]));return r.a.createElement(we.Provider,{value:t},r.a.createElement("tr",a))});class be extends r.a.Component{constructor(...e){var t;return t=super(...e),this.getInput=(()=>(this.props.inputType,r.a.createElement(v.a,null))),t}render(){var e=this.props;const t=e.editing,a=e.required,n=e.dataIndex,s=e.title,i=(e.inputType,e.record),l=(e.index,ve(e,["editing","required","dataIndex","title","inputType","record","index"]));return r.a.createElement(we.Consumer,null,e=>{const o=e.getFieldDecorator;return r.a.createElement("td",l,t?r.a.createElement(_e,{style:{margin:0}},o(n,{rules:[{required:a,message:`Hãy nhập dữ liệu ô ${s}!`}],initialValue:i[n]})(this.getInput())):l.children)})}}var ke=class extends r.a.Component{constructor(e){super(e),this.isEditing=(e=>e.key===this.state.editingKey),this.cancel=(e=>{this.setState({editingKey:""}),1==this.state.newitem&&(this.state.newitem=0,this.delete(e))}),this.delete=(e=>{if(e.id)fetch(ISD_BASE_URL+"qlkh/deleteKh/"+e.id,{headers:k()}).then(e=>e.json()).then(e=>{if("error"==e.status)c.a.error("Có lỗi xảy ra khi xoá dữ liệu khách hàng!",3);else{let t=this.state.data.filter(t=>t.id!=e.data);this.setState({data:t}),c.a.success(e.message),this.state.newitem=0}}).catch(e=>{c.a.error("Có lỗi xảy ra khi xoá dữ liệu khách hàng!",3),console.log(e)});else if(e.key){let t=this.state.data.filter(t=>t.key!=e.key);this.setState({data:t})}}),this.state={data:[],editingKey:"",newitem:0},this.columns=[{title:"Mã Khách Hàng",dataIndex:"ma_kh",width:"10%",editable:!0,required:!0},{title:"Tên",dataIndex:"name",editable:!0,required:!0},{title:"Số điện thoại",dataIndex:"phone",editable:!0,required:!0},{title:"Địa chỉ",dataIndex:"adress",editable:!0,required:!0},{title:"Thông tin",dataIndex:"description",editable:!0,required:!1},{title:"Actions",dataIndex:"operation",render:(e,t)=>{const a=this.isEditing(t);return r.a.createElement("div",{style:{minWidth:100}},a?r.a.createElement("span",null,r.a.createElement(we.Consumer,null,e=>r.a.createElement("a",{href:"javascript:;",onClick:()=>this.save(e,t.key),style:{marginRight:8}},"Lưu")),r.a.createElement(y.a,{title:"Bạn thật sự muốn huỷ?",onConfirm:()=>this.cancel(t)},r.a.createElement("a",{href:"javascript:;"},"Huỷ"))):r.a.createElement(r.a.Fragment,null,r.a.createElement("a",{href:"javascript:;",onClick:()=>this.edit(t.key)},"Sửa")," | ",r.a.createElement(y.a,{title:"Bạn thật sự muốn xoá?",okType:"danger",onConfirm:()=>this.delete(t)},r.a.createElement("a",{href:"javascript:;"},"Xoá"))))}}]}addNewRow(){if(0==this.state.newitem){let e=this.getDefaultFields();e=xe({},e,{key:this.state.data.length+1}),this.setState({data:[e,...this.state.data],editingKey:e.key}),this.state.newitem=1}else c.a.error("Bạn đang thêm mới khách hàng rồi ...")}getDefaultFields(){return{ma_kh:"",name:"",description:""}}edit(e){this.setState({editingKey:e})}save(e,t){e.validateFields((e,a)=>{if(e)return;const n=[...this.state.data],r=n.findIndex(e=>t===e.key);if(r>-1){const e=n[r];let t=xe({},e,a);fetch(ISD_BASE_URL+"qlkh/updateKh",{method:"POST",headers:k(),body:JSON.stringify(t)}).then(e=>e.json()).then(e=>{"error"==e.status?c.a.error(e.message,3):(n.splice(r,1,xe({},t,e.data)),this.setState({data:n,editingKey:""}),c.a.success(e.message),this.state.newitem=0)}).catch(e=>{console.log("parsing failed",e),c.a.error("Có lỗi xảy ra trong quá trình lưu hoặc chỉnh sửa!")})}else n.push(data),this.setState({data:n,editingKey:""})})}fetchData(){fetch(ISD_BASE_URL+"qlkh/fetchKh",{headers:k()}).then(e=>e.json()).then(e=>{if("error"==e.status)c.a.warning(e.message,3);else if(e.data){let t=e.data.map((e,t)=>xe({},e,{key:t}));this.setState({data:t})}}).catch(e=>{c.a.error("Có lỗi khi tải dữ liệu dữ liệu khách hàng!",3),console.log(e)})}componentDidMount(){this.fetchData()}render(){const e={body:{row:Ce,cell:be}},t=this.columns.map(e=>e.editable?xe({},e,{onCell:t=>({record:t,inputType:e.dataIndex,dataIndex:e.dataIndex,title:e.title,editing:this.isEditing(t),required:e.required})}):e);return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"table-operations"},r.a.createElement(w.a,null,r.a.createElement(x.a,{span:12},r.a.createElement("h2",{className:"head-title"},"Quản lý khách hàng")),r.a.createElement(x.a,{span:12},r.a.createElement("div",{className:"action-btns"},r.a.createElement(E.a,{onClick:()=>this.addNewRow(),type:"primary",icon:"plus"},"Thêm khách hàng mới"))))),r.a.createElement(C.a,{components:e,bordered:!0,dataSource:this.state.data,columns:t,rowClassName:"editable-row"}))}},Ie=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e};function je(e,t){var a={};for(var n in e)t.indexOf(n)>=0||Object.prototype.hasOwnProperty.call(e,n)&&(a[n]=e[n]);return a}const De=S.a.Item,Oe=r.a.createContext(),Te={headTitle:"Quản lý sản phẩm",addNewTitle:"Thêm sản phẩm mới"},qe={fetch:"product/fetch",update:"product/update",delete:"product/delete/"},Ne=S.a.create()(e=>{let t=e.form,a=(e.index,je(e,["form","index"]));return r.a.createElement(Oe.Provider,{value:t},r.a.createElement("tr",a))});class Ae extends r.a.Component{constructor(...e){var t;return t=super(...e),this.getInput=(()=>{switch(this.props.inputType){case"category_id":let e=this.props.categories;return r.a.createElement(_.a,{style:{width:250},placeholder:"Chọn danh mục"},e.map(e=>r.a.createElement(_.a.Option,{key:e.id,value:e.id},e.name)));default:return r.a.createElement(v.a,null)}}),t}render(){var e=this.props;const t=e.editing,a=e.required,n=e.dataIndex,s=e.title,i=(e.inputType,e.record),l=(e.index,je(e,["editing","required","dataIndex","title","inputType","record","index"]));return r.a.createElement(Oe.Consumer,null,e=>{const o=e.getFieldDecorator;return r.a.createElement("td",l,t?r.a.createElement(De,{style:{margin:0}},o(n,{rules:[{required:a,message:`Hãy nhập dữ liệu ô ${s}!`}],initialValue:i[n]})(this.getInput())):l.children)})}}var Le=class extends r.a.Component{constructor(e){super(e),this.isEditing=(e=>e.key===this.state.editingKey),this.cancel=(e=>{this.setState({editingKey:""}),1==this.state.newitem&&(this.state.newitem=0,this.delete(e))}),this.delete=(e=>{if(e.id)fetch(ISD_BASE_URL+qe.delete+e.id,{headers:k()}).then(e=>e.json()).then(e=>{if("error"==e.status)c.a.error("Có lỗi xảy ra khi xoá sản phẩm!",3);else{let t=this.state.data.filter(t=>t.id!=e.data);this.setState({data:t}),c.a.success(e.message),this.state.newitem=0}}).catch(e=>{c.a.error("Có lỗi xảy ra khi xoá sản phẩm!",3),console.log(e)});else if(e.key){let t=this.state.data.filter(t=>t.key!=e.key);this.setState({data:t})}}),this.state={data:[],editingKey:"",categoryList:{},newitem:0},this.columns=[{title:"Mã Danh mục",dataIndex:"category_id",width:"15%",editable:!0,required:!0,render:(e,t)=>{let a=e;return this.state.categoryList&&this.state.categoryList[e]&&(a=this.state.categoryList[e].name),r.a.createElement("span",null,a)}},{title:"Mã VT",dataIndex:"product_id",width:"15%",editable:!0,required:!0},{title:"Tên sản phẩm",dataIndex:"name",editable:!0,required:!0},{title:"Đơn vị",dataIndex:"unit",editable:!0},{title:"Min",dataIndex:"min",editable:!0},{title:"Max",dataIndex:"max",editable:!0},{title:"Actions",dataIndex:"operation",render:(e,t)=>{const a=this.isEditing(t);return r.a.createElement("div",{style:{minWidth:100}},a?r.a.createElement("span",null,r.a.createElement(Oe.Consumer,null,e=>r.a.createElement("a",{href:"javascript:;",onClick:()=>this.save(e,t.key),style:{marginRight:8}},"Lưu")),r.a.createElement(y.a,{title:"Bạn thật sự muốn huỷ?",onConfirm:()=>this.cancel(t)},r.a.createElement("a",{href:"javascript:;"},"Huỷ"))):r.a.createElement(r.a.Fragment,null,r.a.createElement("a",{href:"javascript:;",onClick:()=>this.edit(t.key)},"Sửa")," | ",r.a.createElement(y.a,{title:"Bạn thật sự muốn xoá?",okType:"danger",onConfirm:()=>this.delete(t)},r.a.createElement("a",{href:"javascript:;"},"Xoá"))))}}]}addNewRow(){if(0==this.state.newitem){let e=this.getDefaultFields();e=Ie({},e,{key:this.state.data.length+1}),this.setState({data:[e,...this.state.data],editingKey:e.key}),this.state.newitem=1}else c.a.error("Bạn đang thêm mới sản phẩm rồi ...")}getDefaultFields(){return{product_id:"",category_id:"",name:"",unit:"",min:"0",max:"0"}}edit(e){this.setState({editingKey:e})}save(e,t){e.validateFields((e,a)=>{if(e)return;const n=[...this.state.data],r=n.findIndex(e=>t===e.key);if(r>-1){const e=n[r];let t=Ie({},e,a);fetch(ISD_BASE_URL+qe.update,{method:"POST",headers:k(),body:JSON.stringify(t)}).then(e=>e.json()).then(e=>{"error"==e.status?(c.a.error(e.message,3),e.show_login&&this.props.dispatch(u({showLogin:!0}))):(n.splice(r,1,Ie({},t,e.data)),this.setState({data:n,editingKey:""}),c.a.success(e.message),this.state.newitem=0)}).catch(e=>{console.log("parsing failed",e),c.a.error("Có lỗi xảy ra trong quá trình lưu hoặc chỉnh sửa!")})}else n.push(data),this.setState({data:n,editingKey:""})})}fetchCategories(){fetch(ISD_BASE_URL+"qlcate/fetchCate",{headers:k()}).then(e=>e.json()).then(e=>{e.data?e.data&&(this.props.dispatch(u({categories:e.data})),this.setState({categoryList:b(e.data)})):c.a.error(e.message)}).catch(e=>{console.log(e)})}fetchData(){fetch(ISD_BASE_URL+qe.fetch,{headers:k()}).then(e=>e.json()).then(e=>{if("error"==e.status)c.a.warning(e.message,3);else if(e.data){let t=e.data.map((e,t)=>Ie({},e,{key:t}));this.setState({data:t})}}).catch(e=>{c.a.error("Có lỗi khi tải dữ liệu sản phẩm!",3),console.log(e)})}componentDidMount(){this.fetchCategories(),this.fetchData()}render(){const e={body:{row:Ne,cell:Ae}};let t=this.props.mainState.categories;const a=this.columns.map(e=>e.editable?Ie({},e,{onCell:a=>({record:a,inputType:e.dataIndex,dataIndex:e.dataIndex,title:e.title,editing:this.isEditing(a),required:e.required,categories:t})}):e);return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"table-operations"},r.a.createElement(w.a,null,r.a.createElement(x.a,{span:12},r.a.createElement("h2",{className:"head-title"},Te.headTitle)),r.a.createElement(x.a,{span:12},r.a.createElement("div",{className:"action-btns"},r.a.createElement(E.a,{onClick:()=>this.addNewRow(),type:"primary",icon:"plus"},Te.addNewTitle))))),r.a.createElement(C.a,{components:e,bordered:!0,dataSource:this.state.data,columns:a,rowClassName:"editable-row"}))}},Re=a(7),Pe=a.n(Re),Ke=a(501),Me=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e};const Be=S.a.Item;_.a.Option;var Ye=class extends r.a.Component{constructor(e){super(e),this.state={productListbyCateList:[]}}fetchData(){fetch(ISD_BASE_URL+"sx/fetchKho",{headers:k()}).then(e=>e.json()).then(e=>{"error"==e.status?c.a.warning(e.message,3):e.data&&this.props.dispatch(u({kho:e.data}))}).catch(e=>{c.a.error("Có lỗi khi tải dữ liệu dữ liệu kho!",3),console.log(e)})}fetchProductbyCate(){fetch(ISD_BASE_URL+"sx/fetchProductByCate/19",{headers:k()}).then(e=>e.json()).then(e=>{e.data?e.data&&(this.props.dispatch(u({productListbyCate:e.data})),this.setState({productListbyCateList:e.data})):c.a.error(e.message)}).catch(e=>{console.log(e)})}componentDidMount(){this.fetchProductbyCate()}render(){var e=this.props.mainState;let t=e.sx,a=e.phieuAction,n=t.hd;n=Pe()(n);let s=this.state.productListbyCateList||[];n.isValid()||(n=null);let i=t.nsx;(i=Pe()(i)).isValid()||(i=null);let l=!(!a||"view"!=a.action);return r.a.createElement(S.a,null,r.a.createElement(w.a,null,r.a.createElement(x.a,{span:12},r.a.createElement(Be,{label:"SỐ",labelCol:{span:5},wrapperCol:{span:12}},r.a.createElement(v.a,{readOnly:l,onChange:e=>{this.props.dispatch(u({sx:Me({},this.props.mainState.sx,{so:e.target.value})}))},value:t.so}))),r.a.createElement(x.a,{span:12},r.a.createElement(Be,{label:"CÔNG ĐOẠN",labelCol:{span:5},wrapperCol:{span:12}},r.a.createElement(v.a,{readOnly:l,onChange:e=>{this.props.dispatch(u({sx:Me({},this.props.mainState.sx,{cong_doan:e.target.value})}))},value:t.cong_doan})))),r.a.createElement(w.a,null,r.a.createElement(x.a,{span:12},r.a.createElement(Be,{label:"MÃ",labelCol:{span:5},wrapperCol:{span:12}},r.a.createElement(v.a,{readOnly:l,onChange:e=>{this.props.dispatch(u({sx:Me({},this.props.mainState.sx,{ma:e.target.value})}))},value:t.ma}))),r.a.createElement(x.a,{span:12},r.a.createElement(Be,{label:"SẢN PHẨM",labelCol:{span:5},wrapperCol:{span:12}},r.a.createElement(_.a,{defaultValue:t.ma_sp,showSearch:!0,optionFilterProp:"children",onChange:(e,t)=>{this.props.dispatch(u({sx:Me({},this.props.mainState.sx,{ma_sp:e})}))},filterOption:(e,t)=>t.props.children.toLowerCase().indexOf(e.toLowerCase())>=0,placeholder:"Chọn VT"},s.map(e=>r.a.createElement(_.a.Option,{key:e.product_id,value:e.product_id},`${e.product_id} - ${e.name} - ${e.unit} `)))))),r.a.createElement(w.a,null,r.a.createElement(x.a,{span:12},r.a.createElement(Be,{label:"CỠ LÔ",labelCol:{span:5},wrapperCol:{span:12}},r.a.createElement(v.a,{readOnly:l,onChange:e=>{this.props.dispatch(u({sx:Me({},this.props.mainState.sx,{co_lo:e.target.value})}))},value:t.co_lo}))),r.a.createElement(x.a,{span:12},r.a.createElement(Be,{label:"SĐK",labelCol:{span:5},wrapperCol:{span:12}},r.a.createElement(v.a,{readOnly:l,onChange:e=>{this.props.dispatch(u({sx:Me({},this.props.mainState.sx,{so_dk:e.target.value})}))},value:t.so_dk})))),r.a.createElement(w.a,null,r.a.createElement(x.a,{span:12},r.a.createElement(Be,{label:"SỐ LÔ",labelCol:{span:5},wrapperCol:{span:12}},r.a.createElement(v.a,{readOnly:l,onChange:e=>{this.props.dispatch(u({sx:Me({},this.props.mainState.sx,{so_lo:e.target.value})}))},value:t.so_lo}))),r.a.createElement(x.a,{span:12},r.a.createElement(Be,{label:"QCĐG",labelCol:{span:5},wrapperCol:{span:12}},r.a.createElement(v.a,{readOnly:l,onChange:e=>{this.props.dispatch(u({sx:Me({},this.props.mainState.sx,{qcdg:e.target.value})}))},value:t.qcdg})))),r.a.createElement(w.a,null,r.a.createElement(x.a,{span:12},r.a.createElement(Be,{label:"HSD",labelCol:{span:5},wrapperCol:{span:12}},r.a.createElement(Ke.a,{defaultValue:n,onChange:e=>{e=null!=e?e.format("YYYY-MM-DD"):"",this.props.dispatch(u({sx:Me({},this.props.mainState.sx,{hd:e})}))},placeholder:"Chọn ngày",format:"DD/MM/YYYY"}))),r.a.createElement(x.a,{span:12},r.a.createElement(Be,{label:"NSX",labelCol:{span:5},wrapperCol:{span:12}},r.a.createElement(Ke.a,{defaultValue:i,onChange:e=>{e=null!=e?e.format("YYYY-MM-DD"):"",this.props.dispatch(u({sx:Me({},this.props.mainState.sx,{nsx:e})}))},placeholder:"Chọn ngày",format:"DD/MM/YYYY"})))),r.a.createElement(w.a,null,r.a.createElement(x.a,{span:12},r.a.createElement(Be,{label:"ĐH",labelCol:{span:5},wrapperCol:{span:12}},r.a.createElement(v.a,{readOnly:l,onChange:e=>{this.props.dispatch(u({sx:Me({},this.props.mainState.sx,{dh:e.target.value})}))},value:t.dh}))),r.a.createElement(x.a,{span:12},r.a.createElement(Be,{label:"DẠNG BÀO CHẾ",labelCol:{span:5},wrapperCol:{span:12}},r.a.createElement(v.a,{readOnly:l,onChange:e=>{this.props.dispatch(u({sx:Me({},this.props.mainState.sx,{dang_bao_che:e.target.value})}))},value:t.dang_bao_che})))),r.a.createElement(w.a,null,r.a.createElement(x.a,{span:12},r.a.createElement(Be,{label:"TTTB/KLTB",labelCol:{span:5},wrapperCol:{span:12}},r.a.createElement(v.a,{readOnly:l,onChange:e=>{this.props.dispatch(u({sx:Me({},this.props.mainState.sx,{tttb_kltb:e.target.value})}))},value:t.tttb_kltb})))))}},Fe=a(496),Ue=a(506),He=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e};function Qe(e,t){var a={};for(var n in e)t.indexOf(n)>=0||Object.prototype.hasOwnProperty.call(e,n)&&(a[n]=e[n]);return a}const Ve=b(D),$e=S.a.Item,Xe=r.a.createContext(),Je={headTitle:"Nguyên liệu",addNewTitle:"Thêm"},ze={fetch:"sx/fetch",update:"sx/updateProduct",delete:"sx/deleteProduct/",changeStatus:"sx/changeStatus"},We=S.a.create()(e=>{let t=e.form,a=(e.index,Qe(e,["form","index"]));return r.a.createElement(Xe.Provider,{value:t},r.a.createElement("tr",a))});class Ge extends r.a.Component{constructor(...e){var t;return t=super(...e),this.getInput=(()=>{switch(this.props.inputType){case"product_id":let e=this.props.products;return r.a.createElement(_.a,{showSearch:!0,optionFilterProp:"children",onChange:(e,t)=>{let a=t.props.children.split("-");return a&&a[3]&&(a=a[3].trim()),!1},filterOption:(e,t)=>t.props.children.toLowerCase().indexOf(e.toLowerCase())>=0,style:{width:200},placeholder:"Chọn VT"},e.map(e=>r.a.createElement(_.a.Option,{key:e.product_id,value:e.product_id},`${e.product_id} - ${e.name} - ${e.unit} `)));case"sl_1000":case"sl_nvl":case"price":return r.a.createElement(Fe.a,{formatter:e=>`${e}`.replace(/\B(?=(\d{3})+(?!\d))/g,",")});case"hu_hao":return r.a.createElement(Fe.a,{min:0,max:100,formatter:e=>`${e}%`,parser:e=>e.replace("%","")});case"nsx":case"hd":return r.a.createElement(Ke.a,{placeholder:"Chọn ngày",format:"DD/MM/YYYY"});default:return r.a.createElement(v.a,null)}}),this.handleChange=(e=>{console.log(e)}),t}render(){var e=this.props;const t=e.editing,a=e.required,n=e.dataIndex,s=e.title,i=(e.inputType,e.record),l=(e.index,Qe(e,["editing","required","dataIndex","title","inputType","record","index"]));return r.a.createElement(Xe.Consumer,null,e=>{const o=e.getFieldDecorator;let h;return i&&(h=i[n],"ngay_san_xuat"!=n&&"ngay_het_han"!=n||(h=Pe()(h)).isValid()||(h=null)),r.a.createElement("td",l,t?r.a.createElement($e,{style:{margin:0}},o(n,{rules:[{required:a,message:`Hãy nhập dữ liệu ô ${s}!`}],initialValue:h})(this.getInput())):l.children)})}}var Ze=class extends r.a.Component{constructor(e){super(e),this.onSelectChange=(e=>{this.setState({selectedRowKeys:e})}),this.changeStatus=((e,t)=>{this.setState({loading:!0});let a={ids:this.state.selectedRowKeys,type:t,status:e};fetch(ISD_BASE_URL+ze.changeStatus,{method:"POST",headers:k(),body:JSON.stringify(a)}).then(e=>e.json()).then(e=>{"error"==e.status?(c.a.error(e.message,3),e.show_login&&this.props.dispatch(u({showLogin:!0}))):(this.fetchSelectedProduct(),c.a.success(e.message)),this.setState({selectedRowKeys:[],loading:!1})}).catch(e=>{console.log("parsing failed",e),c.a.error("Có lỗi xảy ra trong quá trình lưu hoặc chỉnh sửa!")})}),this.isEditing=(e=>e.key===this.props.mainState.phieuAction.editingKey),this.cancel=(e=>{this.props.dispatch(u({phieuAction:He({},this.props.mainState.phieuAction,{editingKey:""})}))}),this.delete=(e=>{if(e.id)fetch(ISD_BASE_URL+ze.delete+e.id,{headers:k()}).then(e=>e.json()).then(t=>{if("error"==t.status)c.a.error("Có lỗi xảy ra khi xoá sản phẩm!",3);else{let a=this.props.mainState.sx.products.filter(t=>t.key!=e.id);this.props.dispatch(u({sx:He({},this.props.mainState.sx,{products:a})})),c.a.success(t.message)}}).catch(e=>{c.a.error("Có lỗi xảy ra khi xoá sản phẩm!",3),console.log(e)});else if(e.key){let t=this.props.mainState.sx.products.filter(t=>t.key!=e.key);this.props.dispatch(u({sx:He({},this.props.mainState.sx,{products:t})}))}}),this.state={productList:{},selectedRowKeys:[],loading:!1,loadProduct:!1},this.columns=[{title:"Công đoạn",dataIndex:"cong_doan",width:200,editable:!0,required:!0},{title:"Mã maquet",dataIndex:"ma_maquet",width:200,editable:!0,required:!0},{title:"Mã NL",dataIndex:"product_id",width:"20%",editable:!0,render:(e,t)=>{let a=e,n="kg";return this.state.productList&&this.state.productList[e]&&(a=this.state.productList[e].name,n=this.state.productList[e].unit),r.a.createElement("span",null,e," - ",a," - ",n)}},{title:"SL cho 1000.000 viên/lọ/gói",dataIndex:"sl_1000",editable:!0,render:(e,t)=>`${e}`.replace(/\B(?=(\d{3})+(?!\d))/g,",")},{title:"Hư hao",dataIndex:"hu_hao",editable:!0,render:(e,t)=>`${e}%`},{title:"SL NVL cần",dataIndex:"sl_nvl",editable:!0,required:!0,render:(e,t)=>`${e}`.replace(/\B(?=(\d{3})+(?!\d))/g,",")},{title:"Actions",dataIndex:"operation",width:100,render:(e,t)=>{if(this.isReadOnly())return"";const a=this.isEditing(t);return r.a.createElement("div",{style:{minWidth:100}},a?r.a.createElement("span",null,r.a.createElement(Xe.Consumer,null,e=>r.a.createElement("a",{href:"javascript:;",onClick:()=>this.save(e,t.key),style:{marginRight:8}},"Lưu")),r.a.createElement(y.a,{title:"Bạn thật sự muốn huỷ?",onConfirm:()=>this.cancel(t.key)},r.a.createElement("a",{href:"javascript:;"},"Huỷ"))):r.a.createElement(r.a.Fragment,null,r.a.createElement("a",{href:"javascript:;",onClick:()=>this.edit(t.key)},"Sửa")," | ",r.a.createElement(y.a,{title:"Bạn thật sự muốn xoá?",okType:"danger",onConfirm:()=>this.delete(t)},r.a.createElement("a",{href:"javascript:;"},"Xoá"))))}}]}showCheckStatus(e){if(e){let t="info";return"2"==e&&(t="error"),"1"==e&&(t="success"),r.a.createElement(Ue.a,{message:Ve[e].text,type:t,showIcon:!0})}return r.a.createElement(Ue.a,{message:Ve[0].text,type:"info",showIcon:!0})}addNewRow(){let e=(this.props.mainState.sx||[]).products,t=this.props.mainState.phieuAction.editingKey;if(void 0!==t&&""!==t)return!1;let a=this.getDefaultFields();a=He({},a,{key:e.length+1}),this.props.dispatch(u({sx:He({},this.props.mainState.sx,{products:[a,...e]}),phieuAction:He({},this.props.mainState.phieuAction,{editingKey:a.key})}))}getDefaultFields(){return{ma_sx:"",ma_maquet:"",product_id:"",cong_doan:"",sl_1000:"",sl_nvl:"",hu_hao:"",status:"",create_on:""}}isReadOnly(){let e=this.props.mainState.phieuAction;return!(!e||"view"!=e.action)}edit(e){this.props.dispatch(u({phieuAction:He({},this.props.mainState.phieuAction,{editingKey:e})}))}save(e,t){e.validateFields((e,a)=>{if(e)return;const n=[...this.props.mainState.sx.products];let r=this.props.mainState.sx.ma_sx||"";const s=n.findIndex(e=>t===e.key);if(s>-1){const e=n[s];let t=He({},e,a,{ma_sx:r});if(!n.id&&!r)return n.splice(s,1,He({},t)),this.props.dispatch(u({sx:He({},this.props.mainState.sx,{products:n}),phieuAction:He({},this.props.mainState.phieuAction,{editingKey:""})})),!1;r&&fetch(ISD_BASE_URL+ze.update,{method:"POST",headers:k(),body:JSON.stringify(t)}).then(e=>e.json()).then(e=>{"error"==e.status?(c.a.error(e.message,3),e.show_login&&this.props.dispatch(u({showLogin:!0}))):(n.splice(s,1,He({},t,e.data)),this.props.dispatch(u({sx:He({},this.props.mainState.sx,{products:n}),phieuAction:He({},this.props.mainState.phieuAction,{editingKey:""})})),c.a.success(e.message))}).catch(e=>{console.log("parsing failed",e),c.a.error("Có lỗi xảy ra trong quá trình lưu hoặc chỉnh sửa!")})}else n.push(data),this.setState({data:n,editingKey:""})})}fetchProduct(){fetch(ISD_BASE_URL+"sx/fetchProductDetailsList",{headers:k()}).then(e=>e.json()).then(e=>{e.data?e.data&&(this.props.dispatch(u({products:e.data})),this.setState({productList:b(e.data,"product_id")})):c.a.error(e.message)}).catch(e=>{console.log(e)})}fetchSelectedProduct(){let e=this.props.mainState.sx.ma_sx;this.setState({loadProduct:!0}),fetch(ISD_BASE_URL+`sx/fetchSelectedProduct/${e}`,{headers:k()}).then(e=>e.json()).then(e=>{e.data?e.data&&this.props.dispatch(u({sx:He({},this.props.mainState.sx,{products:e.data})})):c.a.error(e.message),this.setState({loadProduct:!1})}).catch(e=>{console.log(e)})}getStatusMenu(e){const t=D.map(t=>r.a.createElement(d.a.Item,{key:t.id},r.a.createElement("a",{onClick:()=>{this.changeStatus(t.id,e)},rel:"noopener noreferrer"},t.text)));return r.a.createElement(d.a,null,t)}componentDidMount(){var e=this.props.mainState;let t=e.products,a=e.sx;t.length||this.fetchProduct(),a.ma_sx&&this.fetchSelectedProduct()}render(){const e={body:{row:We,cell:Ge}};let t=this.props.mainState.products,a=this.columns.map(e=>e.editable?He({},e,{onCell:a=>({record:a,inputType:e.dataIndex,dataIndex:e.dataIndex,title:e.title,editing:this.isEditing(a),required:e.required,products:t})}):e);a=a.filter(e=>{if(this.props.isQA||this.props.isQC){if("operation"==e.dataIndex)return!1;if(this.props.isQC&&"qa_check"==e.dataIndex)return!1}return!0});let n=this.props.mainState.sx.products||[];const s={selectedRowKeys:this.state.selectedRowKeys,onChange:this.onSelectChange};return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"table-operations"},r.a.createElement(w.a,null,r.a.createElement(x.a,{span:12},r.a.createElement("h2",{className:"head-title"},Je.headTitle)),r.a.createElement(x.a,{span:12},r.a.createElement("div",{className:"action-btns"},this.isReadOnly()?null:r.a.createElement(E.a,{onClick:()=>this.addNewRow(),type:"primary",icon:"plus"},Je.addNewTitle))))),r.a.createElement(C.a,{rowSelection:s,components:e,bordered:!0,dataSource:n,columns:a,rowClassName:"editable-row",loading:this.state.loadProduct}))}},et=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e};const tt=S.a.Item;_.a.Option;var at=class extends r.a.Component{constructor(e){super(e),this.state={productListbyCateList:[]}}fetchData(){fetch(ISD_BASE_URL+"sx/fetchKho",{headers:k()}).then(e=>e.json()).then(e=>{"error"==e.status?c.a.warning(e.message,3):e.data&&this.props.dispatch(u({kho:e.data}))}).catch(e=>{c.a.error("Có lỗi khi tải dữ liệu dữ liệu kho!",3),console.log(e)})}fetchProductbyCate(){fetch(ISD_BASE_URL+"sx/fetchProductByCate/19",{headers:k()}).then(e=>e.json()).then(e=>{e.data?e.data&&(this.props.dispatch(u({productListbyCate:e.data})),this.setState({productListbyCateList:e.data})):c.a.error(e.message)}).catch(e=>{console.log(e)})}componentDidMount(){this.fetchProductbyCate()}render(){var e=this.props.mainState;let t=e.sx,a=e.phieuAction,n=t.hd;n=Pe()(n);let s=this.state.productListbyCateList||[];n.isValid()||(n=null);let i=t.nsx;(i=Pe()(i)).isValid()||(i=null);let l=!(!a||"view"!=a.action);return r.a.createElement(S.a,null,r.a.createElement(w.a,null,r.a.createElement(x.a,{span:12},r.a.createElement(tt,{label:"MÃ",labelCol:{span:5},wrapperCol:{span:12}},r.a.createElement(v.a,{readOnly:l,onChange:e=>{this.props.dispatch(u({sx:et({},this.props.mainState.sx,{ma:e.target.value})}))},value:t.ma}))),r.a.createElement(x.a,{span:12},r.a.createElement(tt,{label:"SẢN PHẨM",labelCol:{span:5},wrapperCol:{span:12}},r.a.createElement(_.a,{defaultValue:t.ma_sp,showSearch:!0,optionFilterProp:"children",onChange:(e,t)=>{this.props.dispatch(u({sx:et({},this.props.mainState.sx,{ma_sp:e})}))},filterOption:(e,t)=>t.props.children.toLowerCase().indexOf(e.toLowerCase())>=0,placeholder:"Chọn VT"},s.map(e=>r.a.createElement(_.a.Option,{key:e.product_id,value:e.product_id},`${e.product_id} - ${e.name} - ${e.unit} `)))))),r.a.createElement(w.a,null,r.a.createElement(x.a,{span:12},r.a.createElement(tt,{label:"CỠ LÔ",labelCol:{span:5},wrapperCol:{span:12}},r.a.createElement(v.a,{readOnly:l,onChange:e=>{this.props.dispatch(u({sx:et({},this.props.mainState.sx,{co_lo:e.target.value})}))},value:t.co_lo}))),r.a.createElement(x.a,{span:12},r.a.createElement(tt,{label:"SĐK",labelCol:{span:5},wrapperCol:{span:12}},r.a.createElement(v.a,{readOnly:l,onChange:e=>{this.props.dispatch(u({sx:et({},this.props.mainState.sx,{so_dk:e.target.value})}))},value:t.so_dk})))),r.a.createElement(w.a,null,r.a.createElement(x.a,{span:12},r.a.createElement(tt,{label:"SỐ LÔ",labelCol:{span:5},wrapperCol:{span:12}},r.a.createElement(v.a,{readOnly:l,onChange:e=>{this.props.dispatch(u({sx:et({},this.props.mainState.sx,{so_lo:e.target.value})}))},value:t.so_lo}))),r.a.createElement(x.a,{span:12},r.a.createElement(tt,{label:"QCĐG",labelCol:{span:5},wrapperCol:{span:12}},r.a.createElement(v.a,{readOnly:l,onChange:e=>{this.props.dispatch(u({sx:et({},this.props.mainState.sx,{qcdg:e.target.value})}))},value:t.qcdg})))),r.a.createElement(w.a,null,r.a.createElement(x.a,{span:12},r.a.createElement(tt,{label:"HSD",labelCol:{span:5},wrapperCol:{span:12}},r.a.createElement(Ke.a,{defaultValue:n,onChange:e=>{e=null!=e?e.format("YYYY-MM-DD"):"",this.props.dispatch(u({sx:et({},this.props.mainState.sx,{hd:e})}))},placeholder:"Chọn ngày",format:"DD/MM/YYYY"}))),r.a.createElement(x.a,{span:12},r.a.createElement(tt,{label:"NSX",labelCol:{span:5},wrapperCol:{span:12}},r.a.createElement(Ke.a,{defaultValue:i,onChange:e=>{e=null!=e?e.format("YYYY-MM-DD"):"",this.props.dispatch(u({sx:et({},this.props.mainState.sx,{nsx:e})}))},placeholder:"Chọn ngày",format:"DD/MM/YYYY"})))),r.a.createElement(w.a,null,r.a.createElement(x.a,{span:12},r.a.createElement(tt,{label:"ĐH",labelCol:{span:5},wrapperCol:{span:12}},r.a.createElement(v.a,{readOnly:l,onChange:e=>{this.props.dispatch(u({sx:et({},this.props.mainState.sx,{dh:e.target.value})}))},value:t.dh}))),r.a.createElement(x.a,{span:12},r.a.createElement(tt,{label:"DẠNG BÀO CHẾ",labelCol:{span:5},wrapperCol:{span:12}},r.a.createElement(v.a,{readOnly:l,onChange:e=>{this.props.dispatch(u({sx:et({},this.props.mainState.sx,{dang_bao_che:e.target.value})}))},value:t.dang_bao_che})))),r.a.createElement(w.a,null,r.a.createElement(x.a,{span:12},r.a.createElement(tt,{label:"TTTB/KLTB",labelCol:{span:5},wrapperCol:{span:12}},r.a.createElement(v.a,{readOnly:l,onChange:e=>{this.props.dispatch(u({sx:et({},this.props.mainState.sx,{tttb_kltb:e.target.value})}))},value:t.tttb_kltb})))))}},nt=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e};var rt=Object(l.b)(e=>({mainState:e.main.present}))(class extends r.a.Component{constructor(...e){var t;return t=super(...e),this.handleSubmit=(e=>{e.preventDefault(),this.validBeforeSave()&&fetch(ISD_BASE_URL+"sx/update",{method:"POST",headers:k(),body:JSON.stringify(this.props.mainState.sx)}).then(e=>e.json()).then(e=>{"error"==e.status?(c.a.error(e.message,3),e.show_login&&this.props.dispatch(u({showLogin:!0}))):(c.a.success(e.message),this.props.dispatch(u({sx:{refresh:!0},phieuAction:{}})))}).catch(e=>{console.log("parsing failed",e),c.a.error("Có lỗi xảy ra trong quá trình lưu hoặc chỉnh sửa!")})}),t}validBeforeSave(){let e=this.props.mainState.sx;return e.ma?!!e.so||(c.a.error("Số sản xuất không được để trống"),!1):(c.a.error("Mã sản xuất không được để trống"),!1)}cancel(){this.props.dispatch(u({phieuAction:nt({},this.props.mainState.phieuAction,{addNewItem:!1})}))}render(){let e=this.props.mainState.phieuAction;return r.a.createElement("div",null,r.a.createElement("div",{className:"table-operations"},r.a.createElement(w.a,null,r.a.createElement(x.a,{span:12},r.a.createElement("h2",{className:"head-title"},"Lệnh sản xuất")),r.a.createElement(x.a,{span:12},r.a.createElement("div",{className:"action-btns"},e&&"edit"==e.action?r.a.createElement(r.a.Fragment,null,r.a.createElement(E.a,{onClick:this.handleSubmit,type:"primary",htmlType:"button",icon:"save"},"Lưu"),r.a.createElement(y.a,{title:"Bạn thật sự muốn huỷ?",onConfirm:()=>this.cancel()},r.a.createElement(E.a,{style:{marginLeft:10},type:"danger"},"Huỷ"))):r.a.createElement(r.a.Fragment,null,r.a.createElement(E.a,{onClick:()=>{this.props.dispatch(u({phieuAction:nt({},this.props.mainState.phieuAction,{action:"edit"})}))},type:"primary",htmlType:"button",icon:"edit"},"Sửa"),r.a.createElement(E.a,{onClick:()=>this.cancel(),style:{marginLeft:10},icon:"left",type:"default"},"Quay lại")))))),r.a.createElement(Ye,{dispatch:this.props.dispatch,mainState:this.props.mainState}),r.a.createElement(Ze,{dispatch:this.props.dispatch,mainState:this.props.mainState}),r.a.createElement(at,{dispatch:this.props.dispatch,mainState:this.props.mainState}))}}),st=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e};function it(e,t){var a={};for(var n in e)t.indexOf(n)>=0||Object.prototype.hasOwnProperty.call(e,n)&&(a[n]=e[n]);return a}const lt=S.a.Item,ot=r.a.createContext(),ht={headTitle:"Quản lý sản xuất",addNewTitle:"Thêm lệnh sản xuất"},ct={fetch:"sx/fetch",delete:"sx/delete/"},dt=S.a.create()(e=>{let t=e.form,a=(e.index,it(e,["form","index"]));return r.a.createElement(ot.Provider,{value:t},r.a.createElement("tr",a))});class pt extends r.a.Component{constructor(...e){var t;return t=super(...e),this.getInput=(()=>(this.props.inputType,r.a.createElement(v.a,null))),t}render(){var e=this.props;const t=e.editing,a=e.required,n=e.dataIndex,s=e.title,i=(e.inputType,e.record),l=(e.index,it(e,["editing","required","dataIndex","title","inputType","record","index"]));return r.a.createElement(ot.Consumer,null,e=>{const o=e.getFieldDecorator;return r.a.createElement("td",l,t?r.a.createElement(lt,{style:{margin:0}},o(n,{rules:[{required:a,message:`Hãy nhập dữ liệu ô ${s}!`}],initialValue:i[n]})(this.getInput())):l.children)})}}var ut=class extends r.a.Component{constructor(e){super(e),this.isEditing=(e=>e.key===this.state.editingKey),this.delete=(e=>{if(e.id)fetch(ISD_BASE_URL+ct.delete+e.id,{headers:k()}).then(e=>e.json()).then(e=>{if("error"==e.status)c.a.error("Có lỗi xảy ra khi xoá sản phẩm!",3);else{let t=this.state.data.filter(t=>t.id!=e.data);this.setState({data:t}),c.a.success(e.message)}}).catch(e=>{c.a.error("Có lỗi xảy ra khi xoá sản phẩm!",3),console.log(e)});else if(e.key){let t=this.state.data.filter(t=>t.key!=e.key);this.setState({data:t})}}),this.state={data:[],addNewItem:!1},this.columns=[{title:"Mã sản xuất",dataIndex:"ma",editable:!1},{title:"Công đoạn",dataIndex:"cong_doan",editable:!1},{title:"Sản phẩm",dataIndex:"ma_sp",editable:!1},{title:"Cỡ lô",dataIndex:"co_lo",editable:!1},{title:"Số lô",dataIndex:"so_lo",editable:!1},{title:"NSX",dataIndex:"nsx",editable:!1},{title:"Tình trạng",dataIndex:"status",editable:!1},{title:"Actions",dataIndex:"operation",render:(e,t)=>{const a=this.isEditing(t);return r.a.createElement("div",{style:{minWidth:100}},a?r.a.createElement("span",null,r.a.createElement(ot.Consumer,null,e=>r.a.createElement("a",{href:"javascript:;",onClick:()=>this.save(e,t.key),style:{marginRight:8}},"Lưu")),r.a.createElement(y.a,{title:"Bạn thật sự muốn huỷ?",onConfirm:()=>this.cancel(t.key)},r.a.createElement("a",{href:"javascript:;"},"Huỷ"))):r.a.createElement(r.a.Fragment,null,r.a.createElement("a",{href:"javascript:;",onClick:()=>this.view(t)},"Xem chi tiết")))}}]}getDefaultFields(){return{id:"",ma_sx:"",ma:"",so:"",cong_doan:"",ma_sp:"",co_lo:"",so_lo:"",nsx:"",hd:"",dang_bao_che:"",so_dk:"",qcdg:"",dh:"",tttb_kltb:"",products:[],status:""}}addNewRow(){this.props.dispatch(u({phieuAction:st({},this.props.mainState.phieuAction,{addNewItem:!0,action:"edit",editingKey:""}),sx:this.getDefaultFields()}))}view(e){var t=this.props.mainState;let a=t.sx,n=t.phieuAction;e&&e.ma_sx&&e.id&&this.props.dispatch(u({sx:st({},a,e),phieuAction:st({},n,{addNewItem:!0,action:"view"})}))}fetchData(){fetch(ISD_BASE_URL+ct.fetch,{headers:k()}).then(e=>e.json()).then(e=>{if("error"==e.status)c.a.warning(e.message,3);else if(e.data){let t=e.data.map((e,t)=>st({},e,{key:t}));this.setState({data:t,dataUpToDate:!0}),this.props.dispatch(u({phieunhap:{refresh:!1}}))}}).catch(e=>{c.a.error("Có lỗi khi tải dữ liệu sản phẩm!",3),console.log(e)})}static getDerivedStateFromProps(e,t){return e.mainState.phieunhap.refresh?{dataUpToDate:null}:null}componentDidUpdate(){null===this.state.dataUpToDate&&this.fetchData()}componentDidMount(){this.fetchData()}render(){let e=this.props.mainState;const t={body:{row:dt,cell:pt}},a=this.columns.map(e=>e.editable?st({},e,{onCell:t=>({record:t,inputType:e.dataIndex,dataIndex:e.dataIndex,title:e.title,editing:this.isEditing(t),required:e.required})}):e);return r.a.createElement(r.a.Fragment,null,e.phieuAction.addNewItem?r.a.createElement(rt,{dispatch:this.props.dispatch,mainState:this.props.mainState}):r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"table-operations"},r.a.createElement(w.a,null,r.a.createElement(x.a,{span:12},r.a.createElement("h2",{className:"head-title"},ht.headTitle)),r.a.createElement(x.a,{span:12},r.a.createElement("div",{className:"action-btns"},r.a.createElement(E.a,{onClick:()=>this.addNewRow(),type:"primary",icon:"plus"},ht.addNewTitle))))),r.a.createElement(C.a,{components:t,bordered:!0,dataSource:this.state.data,columns:a,rowClassName:"editable-row"})))}},mt=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e};const gt=S.a.Item,ft=_.a.Option,yt={person:"Người giao hàng"};var Et=class extends r.a.Component{constructor(e){super(e)}fetchData(){fetch(ISD_BASE_URL+"qlkho/fetchKho",{headers:k()}).then(e=>e.json()).then(e=>{"error"==e.status?c.a.warning(e.message,3):e.data&&this.props.dispatch(u({kho:e.data}))}).catch(e=>{c.a.error("Có lỗi khi tải dữ liệu dữ liệu kho!",3),console.log(e)})}componentDidMount(){this.props.mainState.kho.length||this.fetchData()}render(){var e=this.props.mainState;let t=e.phieunhap,a=e.phieuAction,n=!(!a||"view"!=a.action),s="",i=this.props.mainState.kho;return i.length&&(s=i.map(e=>r.a.createElement(ft,{key:e.id,value:e.ma_kho},e.name))),r.a.createElement(S.a,null,r.a.createElement(gt,{label:"Số chứng từ",labelCol:{span:5},wrapperCol:{span:12}},r.a.createElement(v.a,{readOnly:n,onChange:e=>{this.props.dispatch(u({phieunhap:mt({},this.props.mainState.phieunhap,{so_chung_tu:e.target.value})}))},value:t.so_chung_tu})),r.a.createElement(gt,{label:yt.person,labelCol:{span:5},wrapperCol:{span:12}},r.a.createElement(v.a,{readOnly:n,onChange:e=>{this.props.dispatch(u({phieunhap:mt({},this.props.mainState.phieunhap,{nguoi_giao_dich:e.target.value})}))},value:t.nguoi_giao_dich})),r.a.createElement(gt,{label:"Tại Kho",labelCol:{span:5},wrapperCol:{span:12}},r.a.createElement(_.a,{disabled:n,onChange:e=>{this.props.dispatch(u({phieunhap:mt({},this.props.mainState.phieunhap,{ma_kho:e})}))},defaultValue:t.ma_kho,placeholder:"Chọn kho"},s)),r.a.createElement(gt,{label:"Mô tả",labelCol:{span:5},wrapperCol:{span:12}},r.a.createElement(v.a.TextArea,{readOnly:n,autosize:{minRows:2,maxRows:6},onChange:e=>{this.props.dispatch(u({phieunhap:mt({},this.props.mainState.phieunhap,{note:e.target.value})}))},value:t.note})),r.a.createElement(gt,{label:"Địa điểm",labelCol:{span:5},wrapperCol:{span:12}},r.a.createElement(v.a.TextArea,{readOnly:n,autosize:{minRows:2,maxRows:6},onChange:e=>{this.props.dispatch(u({phieunhap:mt({},this.props.mainState.phieunhap,{address:e.target.value})}))},value:t.address})),this.props.isInventoryOwner?r.a.createElement(gt,{label:"Trạng Thái",labelCol:{span:5},wrapperCol:{span:12}},r.a.createElement(_.a,{disabled:n,onChange:e=>{this.props.dispatch(u({phieunhap:mt({},this.props.mainState.phieunhap,{tinh_trang:e})}))},defaultValue:t.tinh_trang,placeholder:"Chọn trạng thái"},j.map(e=>r.a.createElement(ft,{value:e.value,key:e.value},e.text)))):null,r.a.createElement(gt,{label:"Ngày tạo",labelCol:{span:5},wrapperCol:{span:12}},r.a.createElement(v.a,{readOnly:!0,onChange:e=>{},value:t.create_on||Pe()(new Date).format("DD/MM/YYYY")})),""!=t.ma_phieu?r.a.createElement(gt,{label:"Lý do sửa phiếu",labelCol:{span:5},wrapperCol:{span:12}},r.a.createElement(v.a.TextArea,{readOnly:n,autosize:{minRows:2,maxRows:6},onChange:e=>{this.props.dispatch(u({phieunhap:mt({},this.props.mainState.phieunhap,{editNote:e.target.value})}))},value:t.editNote})):null)}},St=a(131),xt=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e};function vt(e,t){var a={};for(var n in e)t.indexOf(n)>=0||Object.prototype.hasOwnProperty.call(e,n)&&(a[n]=e[n]);return a}const _t=b(D),wt=S.a.Item,Ct=r.a.createContext(),bt={headTitle:"Vật tư của phiếu nhập",addNewTitle:"Thêm vật tư vào phiếu nhập"},kt={fetch:"phieunhap/fetch",update:"phieunhap/updateProduct",delete:"phieunhap/deleteProduct/",changeStatus:"phieunhap/changeStatus"},It=S.a.create()(e=>{let t=e.form,a=(e.index,vt(e,["form","index"]));return r.a.createElement(Ct.Provider,{value:t},r.a.createElement("tr",a))});class jt extends r.a.Component{constructor(...e){var t;return t=super(...e),this.getInput=(()=>{switch(this.props.inputType){case"product_id":let e=this.props.products;return r.a.createElement(_.a,{showSearch:!0,optionFilterProp:"children",onChange:(e,t)=>{let a=t.props.children.split("-");return a&&a[3]&&(a=a[3].trim()),console.log(a,this.props),!1},filterOption:(e,t)=>t.props.children.toLowerCase().indexOf(e.toLowerCase())>=0,style:{width:200},placeholder:"Chọn VT"},e.map(e=>r.a.createElement(_.a.Option,{key:e.product_id,value:e.product_id},`${e.product_id} - ${e.name} - ${e.unit} `)));case"sl_thucnhap":case"sl_chungtu":case"price":return r.a.createElement(Fe.a,{formatter:e=>`${e}`.replace(/\B(?=(\d{3})+(?!\d))/g,",")});case"ngay_san_xuat":case"ngay_het_han":return r.a.createElement(Ke.a,{placeholder:"Chọn ngày",format:"DD/MM/YYYY"});default:return r.a.createElement(v.a,null)}}),this.handleChange=(e=>{console.log(e)}),t}render(){var e=this.props;const t=e.editing,a=e.required,n=e.dataIndex,s=e.title,i=(e.inputType,e.record),l=(e.index,vt(e,["editing","required","dataIndex","title","inputType","record","index"]));return r.a.createElement(Ct.Consumer,null,e=>{const o=e.getFieldDecorator;let h;return i&&(h=i[n],"ngay_san_xuat"!=n&&"ngay_het_han"!=n||(h=Pe()(h)).isValid()||(h=null)),r.a.createElement("td",l,t?r.a.createElement(wt,{style:{margin:0}},o(n,{rules:[{required:a,message:`Hãy nhập dữ liệu ô ${s}!`}],initialValue:h})(this.getInput())):l.children)})}}var Dt=class extends r.a.Component{constructor(e){super(e),this.onSelectChange=(e=>{this.setState({selectedRowKeys:e})}),this.changeStatus=((e,t)=>{this.setState({loading:!0});let a={ids:this.state.selectedRowKeys,type:t,status:e};fetch(ISD_BASE_URL+kt.changeStatus,{method:"POST",headers:k(),body:JSON.stringify(a)}).then(e=>e.json()).then(e=>{"error"==e.status?(c.a.error(e.message,3),e.show_login&&this.props.dispatch(u({showLogin:!0}))):(this.fetchSelectedProduct(),c.a.success(e.message)),this.setState({selectedRowKeys:[],loading:!1})}).catch(e=>{console.log("parsing failed",e),c.a.error("Có lỗi xảy ra trong quá trình lưu hoặc chỉnh sửa!")})}),this.isEditing=(e=>e.key===this.props.mainState.phieuAction.editingKey),this.cancel=(e=>{this.props.dispatch(u({phieuAction:xt({},this.props.mainState.phieuAction,{editingKey:""})}))}),this.delete=(e=>{if(e.id)fetch(ISD_BASE_URL+kt.delete+e.id,{headers:k()}).then(e=>e.json()).then(t=>{if("error"==t.status)c.a.error("Có lỗi xảy ra khi xoá sản phẩm!",3);else{let a=this.props.mainState.phieunhap.products.filter(t=>t.key!=e.id);this.props.dispatch(u({phieunhap:xt({},this.props.mainState.phieunhap,{products:a})})),c.a.success(t.message)}}).catch(e=>{c.a.error("Có lỗi xảy ra khi xoá sản phẩm!",3),console.log(e)});else if(e.key){let t=this.props.mainState.phieunhap.products.filter(t=>t.key!=e.key);this.props.dispatch(u({phieunhap:xt({},this.props.mainState.phieunhap,{products:t})}))}}),this.state={productList:{},selectedRowKeys:[],loading:!1,loadProduct:!1},this.columns=[{title:"Mã Lô",dataIndex:"ma_lo",width:100,editable:!0,required:!1},{title:"Mã VT",dataIndex:"product_id",width:150,editable:!0,required:!0},{title:"Quy cách",dataIndex:"label",width:200,editable:!0,required:!0},{title:"Đơn vị tính",dataIndex:"unit",width:100,editable:!0},{title:"SL theo chứng từ",dataIndex:"sl_chungtu",editable:!0,render:(e,t)=>`${e}`.replace(/\B(?=(\d{3})+(?!\d))/g,",")},{title:"SL thực nhập",dataIndex:"sl_thucnhap",editable:!0,render:(e,t)=>`${e}`.replace(/\B(?=(\d{3})+(?!\d))/g,",")},{title:"Đơn giá",dataIndex:"price",editable:!0,required:!0,render:(e,t)=>`${e}`.replace(/\B(?=(\d{3})+(?!\d))/g,",")},{title:"Ngày SX",dataIndex:"ngay_san_xuat",width:"200px",editable:!0,required:!1,render:(e,t)=>e?Pe()(e).format("DD/MM/YYYY"):""},{title:"Ngày Hết Hạn",dataIndex:"ngay_het_han",width:"200px",editable:!0,required:!1,render:(e,t)=>e?Pe()(e).format("DD/MM/YYYY"):""},{title:"Actions",dataIndex:"operation",width:100,render:(e,t)=>{if(this.isReadOnly())return"";const a=this.isEditing(t);return r.a.createElement("div",{style:{minWidth:100}},a?r.a.createElement("span",null,r.a.createElement(Ct.Consumer,null,e=>r.a.createElement("a",{href:"javascript:;",onClick:()=>this.save(e,t.key),style:{marginRight:8}},"Lưu")),r.a.createElement(y.a,{title:"Bạn thật sự muốn huỷ?",onConfirm:()=>this.cancel(t.key)},r.a.createElement("a",{href:"javascript:;"},"Huỷ"))):r.a.createElement(r.a.Fragment,null,r.a.createElement("a",{href:"javascript:;",onClick:()=>this.edit(t.key)},"Sửa")," | ",r.a.createElement(y.a,{title:"Bạn thật sự muốn xoá?",okType:"danger",onConfirm:()=>this.delete(t)},r.a.createElement("a",{href:"javascript:;"},"Xoá"))))}}]}showCheckStatus(e){if(e){let t="info";return"2"==e&&(t="error"),"1"==e&&(t="success"),r.a.createElement(Ue.a,{message:_t[e].text,type:t,showIcon:!0})}return r.a.createElement(Ue.a,{message:_t[0].text,type:"info",showIcon:!0})}addNewRow(){let e=this.props.mainState.phieunhap.products,t=this.props.mainState.phieuAction.editingKey;if(void 0!==t&&""!==t)return!1;let a=this.getDefaultFields();a=xt({},a,{key:e.length+1}),this.props.dispatch(u({phieunhap:xt({},this.props.mainState.phieunhap,{products:[a,...e]}),phieuAction:xt({},this.props.mainState.phieuAction,{editingKey:a.key})}))}getDefaultFields(){return{ma_phieu:"",ma_lo:"",product_id:"",label:"",unit:"kg",sl_chungtu:"1",sl_thucnhap:"1",price:0,qc_check:"0",qa_check:"0",ngay_het_han:"",ngay_san_xuat:""}}isReadOnly(){let e=this.props.mainState.phieuAction;return!(!e||"view"!=e.action)}edit(e){this.props.dispatch(u({phieuAction:xt({},this.props.mainState.phieuAction,{editingKey:e})}))}save(e,t){e.validateFields((e,a)=>{if(e)return;const n=[...this.props.mainState.phieunhap.products];let r=this.props.mainState.phieunhap.ma_phieu||"";const s=n.findIndex(e=>t===e.key);if(s>-1){const e=n[s];let t=xt({},e,a,{ma_phieu:r,ngay_san_xuat:a.ngay_san_xuat?a.ngay_san_xuat.format("YYYY-MM-DD"):"",ngay_het_han:a.ngay_het_han?a.ngay_het_han.format("YYYY-MM-DD"):""});if(!n.id&&!r)return n.splice(s,1,xt({},t)),this.props.dispatch(u({phieunhap:xt({},this.props.mainState.phieunhap,{products:n}),phieuAction:xt({},this.props.mainState.phieuAction,{editingKey:""})})),!1;r&&fetch(ISD_BASE_URL+kt.update,{method:"POST",headers:k(),body:JSON.stringify(t)}).then(e=>e.json()).then(e=>{"error"==e.status?(c.a.error(e.message,3),e.show_login&&this.props.dispatch(u({showLogin:!0}))):(n.splice(s,1,xt({},t,e.data)),this.props.dispatch(u({phieunhap:xt({},this.props.mainState.phieunhap,{products:n}),phieuAction:xt({},this.props.mainState.phieuAction,{editingKey:""})})),c.a.success(e.message))}).catch(e=>{console.log("parsing failed",e),c.a.error("Có lỗi xảy ra trong quá trình lưu hoặc chỉnh sửa!")})}else n.push(data),this.setState({data:n,editingKey:""})})}fetchProduct(){fetch(ISD_BASE_URL+"phieunhap/fetchProductDetailsList",{headers:k()}).then(e=>e.json()).then(e=>{e.data?e.data&&(this.props.dispatch(u({products:e.data})),this.setState({productList:b(e.data)})):c.a.error(e.message)}).catch(e=>{console.log(e)})}fetchSelectedProduct(){let e=this.props.mainState.phieunhap.ma_phieu;this.setState({loadProduct:!0}),fetch(ISD_BASE_URL+`phieunhap/fetchSelectedProduct/${e}`,{headers:k()}).then(e=>e.json()).then(e=>{e.data?e.data&&this.props.dispatch(u({phieunhap:xt({},this.props.mainState.phieunhap,{products:e.data})})):(c.a.error(e.message),this.props.dispatch(u({phieunhap:xt({},this.props.mainState.phieunhap,{products:[]})}))),this.setState({loadProduct:!1})}).catch(e=>{console.log(e)})}getStatusMenu(e){const t=D.map(t=>r.a.createElement(d.a.Item,{key:t.id},r.a.createElement("a",{onClick:()=>{this.changeStatus(t.id,e)},rel:"noopener noreferrer"},t.text)));return r.a.createElement(d.a,null,t)}getActionsByRoles(){var e=this.state;let t=e.selectedRowKeys,a=e.loading;const n=t.length>0;return r.a.createElement("div",{style:{marginBottom:16}},this.props.isQC?r.a.createElement(St.a,{overlay:this.getStatusMenu("qc_check"),trigger:["click"],disabled:!n},r.a.createElement(E.a,{type:"primary",loading:a},"QC Phê duyệt")):null,this.props.isQA?r.a.createElement(St.a,{overlay:this.getStatusMenu("qa_check"),trigger:["click"],disabled:!n},r.a.createElement(E.a,{type:"primary",loading:a},"QA Phê duyệt")):null,r.a.createElement("span",{style:{marginLeft:8}},n?`Đã chọn ${t.length} vật tư`:""))}componentDidMount(){var e=this.props.mainState;let t=e.products,a=e.phieunhap;t.length||this.fetchProduct(),a.ma_phieu&&this.fetchSelectedProduct()}render(){const e={body:{row:It,cell:jt}};let t=this.props.mainState.products,a=this.columns.map(e=>e.editable?xt({},e,{onCell:a=>({record:a,inputType:e.dataIndex,dataIndex:e.dataIndex,title:e.title,editing:this.isEditing(a),required:e.required,products:t})}):e);a=a.filter(e=>{if(this.props.isQA||this.props.isQC){if("operation"==e.dataIndex)return!1;if(this.props.isQC&&"qa_check"==e.dataIndex)return!1}return!0});let n=this.props.mainState.phieunhap.products||[];const s={selectedRowKeys:this.state.selectedRowKeys,onChange:this.onSelectChange};return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"table-operations"},r.a.createElement(w.a,null,r.a.createElement(x.a,{span:12},r.a.createElement("h2",{className:"head-title"},bt.headTitle)),r.a.createElement(x.a,{span:12},r.a.createElement("div",{className:"action-btns"},this.isReadOnly()?null:r.a.createElement(E.a,{onClick:()=>this.addNewRow(),type:"primary",icon:"plus"},bt.addNewTitle))))),this.getActionsByRoles(),r.a.createElement(C.a,{rowSelection:s,components:e,bordered:!0,dataSource:n,columns:a,rowClassName:"editable-row",loading:this.state.loadProduct,scroll:{x:1500}}))}},Ot=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e};var Tt=Object(l.b)(e=>({mainState:e.main.present}))(class extends r.a.Component{constructor(...e){var t;return t=super(...e),this.handleSubmit=(e=>{e.preventDefault(),this.validBeforeSave()&&fetch(ISD_BASE_URL+"phieunhap/update",{method:"POST",headers:k(),body:JSON.stringify(this.props.mainState.phieunhap)}).then(e=>e.json()).then(e=>{"error"==e.status?(c.a.error(e.message,3),e.show_login&&this.props.dispatch(u({showLogin:!0}))):(c.a.success(e.message),this.props.dispatch(u({phieunhap:{refresh:!0},phieuAction:{}})))}).catch(e=>{console.log("parsing failed",e),c.a.error("Có lỗi xảy ra trong quá trình lưu hoặc chỉnh sửa!")})}),t}validBeforeSave(){let e=this.props.mainState.phieunhap;return e.ma_kho?e.products.length?!(""!=e.ma_phieu&&!e.editNote&&(c.a.error("Hãy nhập lý do sửa phiếu"),1)):(c.a.error("Chưa có sản phẩm nào trong phiếu này."),!1):(c.a.error("Mã kho không được để trống"),!1)}cancel(){this.props.dispatch(u({phieuAction:Ot({},this.props.mainState.phieuAction,{addNewItem:!1})}))}render(){let e=this.props.mainState.phieuAction;return r.a.createElement("div",null,r.a.createElement("div",{className:"table-operations"},r.a.createElement(w.a,null,r.a.createElement(x.a,{span:12},r.a.createElement("h2",{className:"head-title"},"Thông tin phiếu nhập")),r.a.createElement(x.a,{span:12},r.a.createElement("div",{className:"action-btns"},e&&"edit"==e.action?r.a.createElement(r.a.Fragment,null,r.a.createElement(E.a,{onClick:this.handleSubmit,type:"primary",htmlType:"button",icon:"save"},"Lưu phiếu nhập"),r.a.createElement(y.a,{title:"Bạn thật sự muốn huỷ?",onConfirm:()=>this.cancel()},r.a.createElement(E.a,{style:{marginLeft:10},type:"danger"},"Huỷ"))):r.a.createElement(r.a.Fragment,null,this.props.isQA||this.props.isQC?null:r.a.createElement(E.a,{onClick:()=>{this.props.dispatch(u({phieuAction:Ot({},this.props.mainState.phieuAction,{action:"edit"})}))},type:"primary",htmlType:"button",icon:"edit"},"Sửa phiếu nhập"),r.a.createElement(E.a,{onClick:()=>this.cancel(),style:{marginLeft:10},icon:"left",type:"default"},"Quay lại")))))),r.a.createElement(Et,{isInventoryOwner:this.props.isInventoryOwner,dispatch:this.props.dispatch,mainState:this.props.mainState}),r.a.createElement(Dt,{isQA:this.props.isQA,isQC:this.props.isQC,dispatch:this.props.dispatch,mainState:this.props.mainState}))}}),qt=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e};function Nt(e,t){var a={};for(var n in e)t.indexOf(n)>=0||Object.prototype.hasOwnProperty.call(e,n)&&(a[n]=e[n]);return a}const At=b(j),Lt=S.a.Item,Rt=r.a.createContext(),Pt={headTitle:"Quản lý phiếu nhập",addNewTitle:"Thêm phiếu nhập mới"},Kt={fetch:"phieunhap/fetch",delete:"phieunhap/delete/"},Mt=S.a.create()(e=>{let t=e.form,a=(e.index,Nt(e,["form","index"]));return r.a.createElement(Rt.Provider,{value:t},r.a.createElement("tr",a))});class Bt extends r.a.Component{constructor(...e){var t;return t=super(...e),this.getInput=(()=>(this.props.inputType,r.a.createElement(v.a,null))),t}render(){var e=this.props;const t=e.editing,a=e.required,n=e.dataIndex,s=e.title,i=(e.inputType,e.record),l=(e.index,Nt(e,["editing","required","dataIndex","title","inputType","record","index"]));return r.a.createElement(Rt.Consumer,null,e=>{const o=e.getFieldDecorator;return r.a.createElement("td",l,t?r.a.createElement(Lt,{style:{margin:0}},o(n,{rules:[{required:a,message:`Hãy nhập dữ liệu ô ${s}!`}],initialValue:i[n]})(this.getInput())):l.children)})}}var Yt=class extends r.a.Component{constructor(e){super(e),this.isEditing=(e=>e.key===this.state.editingKey),this.delete=(e=>{if(e.id)fetch(ISD_BASE_URL+Kt.delete+e.id,{headers:k()}).then(e=>e.json()).then(e=>{if("error"==e.status)c.a.error("Có lỗi xảy ra khi xoá sản phẩm!",3);else{let t=this.state.data.filter(t=>t.id!=e.data);this.setState({data:t}),c.a.success(e.message)}}).catch(e=>{c.a.error("Có lỗi xảy ra khi xoá sản phẩm!",3),console.log(e)});else if(e.key){let t=this.state.data.filter(t=>t.key!=e.key);this.setState({data:t})}}),this.state={data:[],addNewItem:!1},this.columns=[{title:"Mã Kho",dataIndex:"ma_kho",editable:!1},{title:"Người giao hàng",dataIndex:"nguoi_giao_dich",editable:!1},{title:"Mô tả",dataIndex:"note",editable:!1},{title:"Ngày Tạo",dataIndex:"create_on",editable:!1},{title:"Người Tạo",dataIndex:"username",render:(e,t)=>t.name||e},{title:"Tình trạng",dataIndex:"tinh_trang",editable:!1,render:(e,t)=>At[e].text||e},{title:"Actions",dataIndex:"operation",render:(e,t)=>{const a=this.isEditing(t);return r.a.createElement("div",{style:{minWidth:100}},a?r.a.createElement("span",null,r.a.createElement(Rt.Consumer,null,e=>r.a.createElement("a",{href:"javascript:;",onClick:()=>this.save(e,t.key),style:{marginRight:8}},"Lưu")),r.a.createElement(y.a,{title:"Bạn thật sự muốn huỷ?",onConfirm:()=>this.cancel(t.key)},r.a.createElement("a",{href:"javascript:;"},"Huỷ"))):r.a.createElement(r.a.Fragment,null,r.a.createElement("a",{href:"javascript:;",onClick:()=>this.view(t)},"Xem chi tiết"),this.isQA()||this.isQC()?null:r.a.createElement(r.a.Fragment,null," | ",r.a.createElement(y.a,{title:"Bạn thật sự muốn xoá?",okType:"danger",onConfirm:()=>this.delete(t)},r.a.createElement("a",{href:"javascript:;"},"Xoá")))))}}]}getDefaultFields(){return{id:"",ma_kho:"",ma_phieu:"",nguoi_giao_dich:"",so_chung_tu:"",note:"",address:"",products:[],tinh_trang:"2"}}addNewRow(){this.props.dispatch(u({phieuAction:qt({},this.props.mainState.phieuAction,{addNewItem:!0,action:"edit",editingKey:""}),phieunhap:this.getDefaultFields()}))}isQC(){let e=this.props.mainState.userRoles;for(let t=0;t<e.length;t++)if("nhomqc"==e[t].path)return!0;return!1}isQA(){let e=this.props.mainState.userRoles;for(let t=0;t<e.length;t++)if("nhomqa"==e[t].path)return!0;return!1}isInventoryOwner(){let e=this.props.mainState.userRoles;for(let t=0;t<e.length;t++)if("nhom_thu_kho"==e[t].path)return!0;return!1}view(e){var t=this.props.mainState;let a=t.phieunhap,n=t.phieuAction;e&&e.ma_phieu&&e.id&&this.props.dispatch(u({phieunhap:qt({},a,e),phieuAction:qt({},n,{addNewItem:!0,action:"view"})}))}fetchData(){fetch(ISD_BASE_URL+Kt.fetch,{headers:k()}).then(e=>e.json()).then(e=>{if("error"==e.status)c.a.warning(e.message,3);else if(e.data){let t=e.data.map((e,t)=>qt({},e,{key:t}));this.setState({data:t,dataUpToDate:!0}),this.props.dispatch(u({phieunhap:{refresh:!1}}))}}).catch(e=>{c.a.error("Có lỗi khi tải dữ liệu sản phẩm!",3),console.log(e)})}static getDerivedStateFromProps(e,t){return e.mainState.phieunhap.refresh?{dataUpToDate:null}:null}componentDidUpdate(){null===this.state.dataUpToDate&&this.fetchData()}componentDidMount(){this.fetchData()}render(){let e=this.props.mainState;const t={body:{row:Mt,cell:Bt}},a=this.columns.map(e=>e.editable?qt({},e,{onCell:t=>({record:t,inputType:e.dataIndex,dataIndex:e.dataIndex,title:e.title,editing:this.isEditing(t),required:e.required})}):e);return r.a.createElement(r.a.Fragment,null,e.phieuAction.addNewItem?r.a.createElement(Tt,{isQA:this.isQA(),isQC:this.isQC(),isInventoryOwner:this.isInventoryOwner(),dispatch:this.props.dispatch,mainState:this.props.mainState}):r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"table-operations"},r.a.createElement(w.a,null,r.a.createElement(x.a,{span:12},r.a.createElement("h2",{className:"head-title"},Pt.headTitle)),r.a.createElement(x.a,{span:12},r.a.createElement("div",{className:"action-btns"},this.isQA()||this.isQC()?null:r.a.createElement(E.a,{onClick:()=>this.addNewRow(),type:"primary",icon:"plus"},Pt.addNewTitle))))),r.a.createElement(C.a,{components:t,bordered:!0,dataSource:this.state.data,columns:a,rowClassName:"editable-row"})))}},Ft=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e};const Ut=S.a.Item,Ht=_.a.Option,Qt={person:"Người nhận hàng"};var Vt=class extends r.a.Component{constructor(e){super(e)}fetchData(){fetch(ISD_BASE_URL+"qlkho/fetchKho",{headers:k()}).then(e=>e.json()).then(e=>{"error"==e.status?c.a.warning(e.message,3):e.data&&this.props.dispatch(u({kho:e.data}))}).catch(e=>{c.a.error("Có lỗi khi tải dữ liệu dữ liệu kho!",3),console.log(e)})}componentDidMount(){this.props.mainState.kho.length||this.fetchData()}render(){var e=this.props.mainState;let t=e.phieuxuat,a=e.phieuXuatAction,n=!(!a||"view"!=a.action),s="",i=this.props.mainState.kho;return i.length&&(s=i.map(e=>r.a.createElement(Ht,{key:e.id,value:e.ma_kho},e.name))),r.a.createElement(S.a,null,r.a.createElement(Ut,{label:"Số chứng từ",labelCol:{span:5},wrapperCol:{span:12}},r.a.createElement(v.a,{readOnly:n,onChange:e=>{this.props.dispatch(u({phieuxuat:Ft({},this.props.mainState.phieuxuat,{so_chung_tu:e.target.value})}))},value:t.so_chung_tu})),r.a.createElement(Ut,{label:Qt.person,labelCol:{span:5},wrapperCol:{span:12}},r.a.createElement(v.a,{readOnly:n,onChange:e=>{this.props.dispatch(u({phieuxuat:Ft({},this.props.mainState.phieuxuat,{nguoi_giao_dich:e.target.value})}))},value:t.nguoi_giao_dich})),r.a.createElement(Ut,{label:"Tại Kho",labelCol:{span:5},wrapperCol:{span:12}},r.a.createElement(_.a,{disabled:n,onChange:e=>{this.props.dispatch(u({phieuxuat:Ft({},this.props.mainState.phieuxuat,{ma_kho:e})}))},defaultValue:t.ma_kho,placeholder:"Chọn kho"},s)),r.a.createElement(Ut,{label:"Mô tả",labelCol:{span:5},wrapperCol:{span:12}},r.a.createElement(v.a.TextArea,{readOnly:n,autosize:{minRows:2,maxRows:6},onChange:e=>{this.props.dispatch(u({phieuxuat:Ft({},this.props.mainState.phieuxuat,{note:e.target.value})}))},value:t.note})),r.a.createElement(Ut,{label:"Địa điểm",labelCol:{span:5},wrapperCol:{span:12}},r.a.createElement(v.a.TextArea,{readOnly:n,autosize:{minRows:2,maxRows:6},onChange:e=>{this.props.dispatch(u({phieuxuat:Ft({},this.props.mainState.phieuxuat,{address:e.target.value})}))},value:t.address})),r.a.createElement(Ut,{label:"Ngày tạo",labelCol:{span:5},wrapperCol:{span:12}},r.a.createElement(v.a,{readOnly:!0,onChange:e=>{},value:t.create_on||Pe()(new Date).format("DD/MM/YYYY")})))}},$t=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e};function Xt(e,t){var a={};for(var n in e)t.indexOf(n)>=0||Object.prototype.hasOwnProperty.call(e,n)&&(a[n]=e[n]);return a}const Jt=b(D),zt=S.a.Item,Wt=r.a.createContext(),Gt={headTitle:"Vật tư của phiếu xuất",addNewTitle:"Thêm vật tư vào phiếu xuất"},Zt={fetch:"phieuxuat/fetch",update:"phieuxuat/updateProduct",delete:"phieuxuat/deleteProduct/",changeStatus:"phieuxuat/changeStatus"},ea=S.a.create()(e=>{let t=e.form,a=(e.index,Xt(e,["form","index"]));return r.a.createElement(Wt.Provider,{value:t},r.a.createElement("tr",a))});class ta extends r.a.Component{constructor(...e){var t;return t=super(...e),this.getInput=(()=>{switch(this.props.inputType){case"sl_thucnhap":case"sl_chungtu":case"price":return r.a.createElement(Fe.a,{onChange:e=>{console.log("value change",e),this.props.id?console.log(this.props):console.log(this.props.record)}});case"ngay_san_xuat":case"ngay_het_han":return r.a.createElement(Ke.a,{placeholder:"Chọn ngày",format:"DD/MM/YYYY"});default:return r.a.createElement(v.a,null)}}),this.handleChange=(e=>{console.log(e)}),t}render(){var e=this.props;const t=e.editing,a=e.required,n=e.dataIndex,s=e.title,i=(e.inputType,e.record),l=(e.index,Xt(e,["editing","required","dataIndex","title","inputType","record","index"]));return r.a.createElement(Wt.Consumer,null,e=>{const o=e.getFieldDecorator;let h;return i&&(h=i[n],"ngay_san_xuat"!=n&&"ngay_het_han"!=n||(h=Pe()(h)).isValid()||(h=null)),r.a.createElement("td",l,t?r.a.createElement(zt,{style:{margin:0}},o(n,{rules:[{required:a,message:`Hãy nhập dữ liệu ô ${s}!`}],initialValue:h})(this.getInput())):l.children)})}}var aa=class extends r.a.Component{constructor(e){super(e),this.onSelectChange=(e=>{this.setState({selectedRowKeys:e})}),this.isEditing=(e=>e.key===this.props.mainState.phieuXuatAction.editingKey),this.cancel=(e=>{this.props.dispatch(u({phieuXuatAction:$t({},this.props.mainState.phieuXuatAction,{editingKey:""})}))}),this.delete=(e=>{if(e.id)fetch(ISD_BASE_URL+Zt.delete+e.id,{headers:k()}).then(e=>e.json()).then(t=>{if("error"==t.status)c.a.error("Có lỗi xảy ra khi xoá sản phẩm!",3);else{let a=this.props.mainState.phieuxuat.products.filter(t=>t.key!=e.id);this.props.dispatch(u({phieuxuat:$t({},this.props.mainState.phieuxuat,{products:a})})),c.a.success(t.message)}}).catch(e=>{c.a.error("Có lỗi xảy ra khi xoá sản phẩm!",3),console.log(e)});else if(e.key){let t=this.props.mainState.phieuxuat.products.filter(t=>t.key!=e.key);this.props.dispatch(u({phieuxuat:$t({},this.props.mainState.phieuxuat,{products:t})}))}}),this.state={productList:{},selectedRowKeys:[],loading:!1,loadProduct:!1},this.columns=[{title:"Mã Lô",dataIndex:"ma_lo",width:100,editable:!1,required:!0},{title:"Mã VT",dataIndex:"product_id",width:150,editable:!1,required:!0},{title:"Quy cách",dataIndex:"label",width:200,editable:!1,required:!0},{title:"Đơn vị tính",dataIndex:"unit",width:100,editable:!1},{title:"SL theo chứng từ",dataIndex:"sl_chungtu",editable:!0},{title:"SL thực xuất",dataIndex:"sl_thucnhap",editable:!0},{title:"Đơn giá",dataIndex:"price",editable:!1,required:!0},{title:"Ngày SX",dataIndex:"ngay_san_xuat",width:"200px",editable:!1,required:!0,render:(e,t)=>Pe()(e).format("DD/MM/YYYY")},{title:"Ngày Hết Hạn",dataIndex:"ngay_het_han",width:"200px",editable:!1,required:!0,render:(e,t)=>Pe()(e).format("DD/MM/YYYY")}]}showCheckStatus(e){if(e){let t="info";return"2"==e&&(t="error"),"1"==e&&(t="success"),r.a.createElement(Ue.a,{message:Jt[e].text,type:t,showIcon:!0})}return r.a.createElement(Ue.a,{message:Jt[0].text,type:"info",showIcon:!0})}openProductModal(){this.props.dispatch(u({phieuXuatAction:$t({},this.props.mainState.phieuXuatAction,{openModal:!0})}))}addNewRow(){let e=this.props.mainState.phieuxuat.products,t=this.props.mainState.phieuXuatAction.editingKey;if(void 0!==t&&""!==t)return!1;let a=this.getDefaultFields();a=$t({},a,{key:e.length+1}),this.props.dispatch(u({phieuxuat:$t({},this.props.mainState.phieuxuat,{products:[a,...e]}),phieuXuatAction:$t({},this.props.mainState.phieuXuatAction,{editingKey:a.key})}))}getDefaultFields(){return{ma_phieu:"",ma_lo:"",product_id:"",label:"",unit:"kg",sl_chungtu:"1",sl_thucnhap:"1",price:0,qc_check:"0",qa_check:"0",ngay_het_han:"",ngay_san_xuat:""}}isReadOnly(){let e=this.props.mainState.phieuXuatAction;return!(!e||"view"!=e.action)}edit(e){this.props.dispatch(u({phieuXuatAction:$t({},this.props.mainState.phieuXuatAction,{editingKey:e})}))}save(e,t){e.validateFields((e,a)=>{if(e)return;const n=[...this.props.mainState.phieuxuat.products];let r=this.props.mainState.phieuxuat.ma_phieu||"";const s=n.findIndex(e=>t===e.key);if(s>-1){const e=n[s];let t=$t({},e,a,{ma_phieu:r,ngay_san_xuat:a.ngay_san_xuat.format("YYYY-MM-DD"),ngay_het_han:a.ngay_het_han.format("YYYY-MM-DD")});if(!n.id&&!r)return n.splice(s,1,$t({},t)),this.props.dispatch(u({phieuxuat:$t({},this.props.mainState.phieuxuat,{products:n}),phieuXuatAction:$t({},this.props.mainState.phieuXuatAction,{editingKey:""})})),!1;r&&fetch(ISD_BASE_URL+Zt.update,{method:"POST",headers:k(),body:JSON.stringify(t)}).then(e=>e.json()).then(e=>{"error"==e.status?(c.a.error(e.message,3),e.show_login&&this.props.dispatch(u({showLogin:!0}))):(n.splice(s,1,$t({},t,e.data)),this.props.dispatch(u({phieuxuat:$t({},this.props.mainState.phieuxuat,{products:n}),phieuXuatAction:$t({},this.props.mainState.phieuXuatAction,{editingKey:""})})),c.a.success(e.message))}).catch(e=>{console.log("parsing failed",e),c.a.error("Có lỗi xảy ra trong quá trình lưu hoặc chỉnh sửa!")})}else n.push(data),this.setState({data:n,editingKey:""})})}fetchSelectedProduct(){let e=this.props.mainState.phieuxuat.ma_phieu;this.setState({loadProduct:!0}),fetch(ISD_BASE_URL+`phieuxuat/fetchSelectedProduct/${e}`,{headers:k()}).then(e=>e.json()).then(e=>{e.data?e.data&&this.props.dispatch(u({phieuxuat:$t({},this.props.mainState.phieuxuat,{products:e.data})})):(this.props.dispatch(u({phieuxuat:$t({},this.props.mainState.phieuxuat,{products:[]})})),c.a.error(e.message)),this.setState({loadProduct:!1})}).catch(e=>{console.log(e)})}getStatusMenu(e){const t=D.map(t=>r.a.createElement(d.a.Item,{key:t.id},r.a.createElement("a",{onClick:()=>{this.changeStatus(t.id,e)},rel:"noopener noreferrer"},t.text)));return r.a.createElement(d.a,null,t)}componentDidMount(){this.props.mainState.phieuxuat.ma_phieu&&this.fetchSelectedProduct()}render(){const e={body:{row:ea,cell:ta}};let t=this.columns.map(e=>e.editable?$t({},e,{onCell:t=>({record:t,inputType:e.dataIndex,dataIndex:e.dataIndex,title:e.title,editing:"sl_chungtu"==e.dataIndex||"sl_thucnhap"==e.dataIndex,required:e.required})}):e);t=t.filter(e=>{if(this.props.isQA||this.props.isQC){if("operation"==e.dataIndex)return!1;if(this.props.isQC&&"qa_check"==e.dataIndex)return!1}return!0});let a=this.props.mainState.phieuxuat.products||[];const n={selectedRowKeys:this.state.selectedRowKeys,onChange:this.onSelectChange};return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"table-operations"},r.a.createElement(w.a,null,r.a.createElement(x.a,{span:12},r.a.createElement("h2",{className:"head-title"},Gt.headTitle)),r.a.createElement(x.a,{span:12},r.a.createElement("div",{className:"action-btns"},this.isReadOnly()?null:r.a.createElement(E.a,{onClick:()=>this.openProductModal(),type:"primary",icon:"plus"},Gt.addNewTitle))))),r.a.createElement(C.a,{rowSelection:n,components:e,bordered:!0,dataSource:a,columns:t,rowClassName:"editable-row",loading:this.state.loadProduct,scroll:{x:1500}}))}},na=a(493),ra=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e};const sa=b(D);S.a.Item;var ia=class extends r.a.Component{constructor(e){super(e),this.onInputChange=(e=>{this.setState({searchText:e.target.value})}),this.onSearch=(()=>{const e=this.state.searchText;new RegExp(e,"gi"),this.setState({filterDropdownVisible:!1,filtered:!!e})}),this.handleChange=((e,t,a)=>{this.setState({filteredInfo:t})}),this.clearFilters=(()=>{this.setState({filteredInfo:null})}),this.onSelectChange=(e=>{this.setState({selectedRowKeys:e}),this.props.onRowSelection(e)}),this.state={productList:{},selectedRowKeys:[],loading:!1,loadProduct:!1,filteredInfo:null,filterDropdownVisible:!1,searchText:"",filtered:!1},this.columns=[{title:"Mã VT",dataIndex:"product_id",width:150,editable:!0,required:!0},{title:"Mã Kho",dataIndex:"ma_kho",width:100,editable:!0,required:!0},{title:"Mã Lô",dataIndex:"ma_lo",width:100,editable:!0,required:!0},{title:"Quy cách",dataIndex:"label",width:200,editable:!0,required:!0},{title:"SL",dataIndex:"sl_thucnhap",editable:!0},{title:"Đơn giá",dataIndex:"price",editable:!0,required:!0},{title:"Ngày SX",dataIndex:"ngay_san_xuat",width:"200px",editable:!0,required:!0,render:(e,t)=>Pe()(e).format("DD/MM/YYYY")},{title:"Ngày hết hạn",dataIndex:"ngay_het_han",width:"200px",editable:!0,required:!0,render:(e,t)=>Pe()(e).format("DD/MM/YYYY")},{title:"QC Duyệt",dataIndex:"qc_check",editable:!1,filterable:!0,filters:D,filterMultiple:!1,width:130,render:(e,t)=>this.showCheckStatus(e)},{title:"QA Duyệt",dataIndex:"qa_check",editable:!1,filterable:!0,filters:D,filterMultiple:!1,width:130,render:(e,t)=>this.showCheckStatus(e)}]}showCheckStatus(e){if(e){let t="processing";return"2"==e&&(t="error"),"1"==e&&(t="success"),r.a.createElement(na.a,{text:sa[e].text,status:t})}return r.a.createElement(na.a,{text:sa[0].text,status:"processing"})}getDefaultFields(){return{ma_phieu:"",ma_lo:"",product_id:"",label:"",unit:"kg",sl_chungtu:"1",sl_thucnhap:"1",price:0,qc_check:"0",qa_check:"0"}}isReadOnly(){let e=this.props.mainState.phieuAction;return!(!e||"view"!=e.action)}fetchAllProduct(){this.setState({loadProduct:!0}),fetch(ISD_BASE_URL+"tinhtrangkho/fetchAllProduct",{headers:k()}).then(e=>e.json()).then(e=>{e.data?e.data&&this.props.dispatch(u({productsForExport:e.data})):c.a.error(e.message),this.setState({loadProduct:!1})}).catch(e=>{console.log(e)})}getStatusMenu(e){const t=D.map(t=>r.a.createElement(d.a.Item,{key:t.id},r.a.createElement("a",{onClick:()=>{this.changeStatus(t.id,e)},rel:"noopener noreferrer"},t.text)));return r.a.createElement(d.a,null,t)}getActionsByRoles(){if(!this.props.isQA&&!this.props.isQC)return!1;var e=this.state;let t=e.selectedRowKeys,a=e.loading;const n=t.length>0;return r.a.createElement("div",{style:{marginBottom:16}},this.props.isQC?r.a.createElement(St.a,{overlay:this.getStatusMenu("qc_check"),trigger:["click"],disabled:!n},r.a.createElement(E.a,{type:"primary",loading:a},"QC Phê duyệt")):null,this.props.isQA?r.a.createElement(St.a,{overlay:this.getStatusMenu("qa_check"),trigger:["click"],disabled:!n},r.a.createElement(E.a,{type:"primary",loading:a},"QA Phê duyệt")):null,r.a.createElement("span",{style:{marginLeft:8}},n?`Đã chọn ${t.length} vật tư`:""))}componentDidMount(){this.fetchAllProduct()}render(){let e=this.columns;e=e.filter(e=>{if(this.props.isQA||this.props.isQC){if("operation"==e.dataIndex)return!1;if(this.props.isQC&&"qa_check"==e.dataIndex)return!1}return!0});var t=this.state;let a=t.filteredInfo,n=t.searchText;a=a||{},e=e.map(e=>{if(e.filterable)switch(e.dataIndex){case"qc_check":return ra({},e,{filteredValue:a.qc_check||null,onFilter:(e,t)=>t.qc_check.includes(e)});case"qa_check":return ra({},e,{filteredValue:a.qa_check||null,onFilter:(e,t)=>t.qa_check.includes(e)})}return"product_id"==e.dataIndex?ra({},e,{filterDropdown:r.a.createElement("div",{className:"custom-filter-dropdown"},r.a.createElement(v.a,{ref:e=>this.searchInput=e,placeholder:"Nhập mã vật tư",value:this.state.searchText,onChange:this.onInputChange,onPressEnter:this.onSearch}),r.a.createElement(E.a,{type:"primary",onClick:this.onSearch},"Tìm")),filterIcon:r.a.createElement(h.a,{type:"search",style:{color:this.state.filtered?"#108ee9":"#aaa"}}),filterDropdownVisible:this.state.filterDropdownVisible,onFilterDropdownVisibleChange:e=>{this.setState({filterDropdownVisible:e},()=>this.searchInput&&this.searchInput.focus())}}):e});let s=this.props.mainState.productsForExport||[];const i=new RegExp(n,"gi");n&&(s=s.map(e=>e.product_id.match(i)?ra({},e,{product_id:r.a.createElement("span",null,e.product_id.split(new RegExp(`(?<=${n})|(?=${n})`,"i")).map((e,t)=>e.toLowerCase()===n.toLowerCase()?r.a.createElement("span",{key:t,className:"highlight"},e):e))}):null).filter(e=>!!e));const l={selectedRowKeys:this.state.selectedRowKeys,onChange:this.onSelectChange};return r.a.createElement(r.a.Fragment,null,this.getActionsByRoles(),r.a.createElement(C.a,{size:"small",rowSelection:l,bordered:!0,dataSource:s,columns:e,loading:this.state.loadProduct,scroll:{x:1500,y:250},pagination:{pageSize:50},onChange:this.handleChange}))}},la=a(498),oa=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e};var ha=Object(l.b)(e=>({mainState:e.main.present}))(class extends r.a.Component{constructor(e){super(e),this.handleSubmit=(e=>{e.preventDefault(),this.validBeforeSave()&&fetch(ISD_BASE_URL+"phieuxuat/update",{method:"POST",headers:k(),body:JSON.stringify(this.props.mainState.phieuxuat)}).then(e=>e.json()).then(e=>{"error"==e.status?(c.a.error(e.message,3),e.show_login&&this.props.dispatch(u({showLogin:!0}))):(c.a.success(e.message),this.props.dispatch(u({phieuxuat:{refresh:!0},phieuXuatAction:{}})))}).catch(e=>{console.log("parsing failed",e),c.a.error("Có lỗi xảy ra trong quá trình lưu hoặc chỉnh sửa!")})}),this.state={selectedItems:[]}}validBeforeSave(){let e=this.props.mainState.phieuxuat;return e.ma_kho?e.nguoi_giao_dich?!!e.products.length||(c.a.error("Chưa có sản phẩm nào trong phiếu này."),!1):(c.a.error("Thiếu thông tin người giao dịch"),!1):(c.a.error("Mã kho không được để trống"),!1)}cancel(){this.props.dispatch(u({phieuXuatAction:oa({},this.props.mainState.phieuXuatAction,{addNewItem:!1})}))}render(){let e=this.props.mainState.phieuXuatAction;return r.a.createElement("div",null,r.a.createElement("div",{className:"table-operations"},r.a.createElement(w.a,null,r.a.createElement(x.a,{span:12},r.a.createElement("h2",{className:"head-title"},"Thông tin phiếu xuất")),r.a.createElement(x.a,{span:12},r.a.createElement("div",{className:"action-btns"},e&&"edit"==e.action?r.a.createElement(r.a.Fragment,null,r.a.createElement(E.a,{onClick:this.handleSubmit,type:"primary",htmlType:"button",icon:"save"},"Lưu"),r.a.createElement(y.a,{title:"Bạn thật sự muốn huỷ?",onConfirm:()=>this.cancel()},r.a.createElement(E.a,{style:{marginLeft:10},type:"danger"},"Huỷ"))):r.a.createElement(r.a.Fragment,null,r.a.createElement(E.a,{onClick:()=>{this.props.dispatch(u({phieuXuatAction:oa({},this.props.mainState.phieuXuatAction,{action:"edit"})}))},type:"primary",htmlType:"button",icon:"edit"},"Sửa"),r.a.createElement(E.a,{onClick:()=>this.cancel(),style:{marginLeft:10},icon:"left",type:"default"},"Quay lại")))))),r.a.createElement(la.a,{width:"95%",title:"Chọn vật tư cho phiếu xuất",okText:"Chọn vật tư",cancelText:"Đóng",visible:e.openModal,onCancel:()=>{this.props.dispatch(u({phieuXuatAction:oa({},this.props.mainState.phieuXuatAction,{openModal:!1})}))},onOk:()=>{let e=this.props.mainState.productsForExport.filter(e=>-1!==this.state.selectedItems.indexOf(e.id));this.props.dispatch(u({phieuXuatAction:oa({},this.props.mainState.phieuXuatAction,{openModal:!1}),phieuxuat:oa({},this.props.mainState.phieuxuat,{products:[...this.props.mainState.phieuxuat.products,...e]})}))}},r.a.createElement(ia,{onRowSelection:e=>{this.setState({selectedItems:e})},dispatch:this.props.dispatch,mainState:this.props.mainState})),r.a.createElement(Vt,{dispatch:this.props.dispatch,mainState:this.props.mainState}),r.a.createElement(aa,{dispatch:this.props.dispatch,mainState:this.props.mainState}))}}),ca=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e};function da(e,t){var a={};for(var n in e)t.indexOf(n)>=0||Object.prototype.hasOwnProperty.call(e,n)&&(a[n]=e[n]);return a}const pa=b(j),ua=S.a.Item,ma=r.a.createContext(),ga={headTitle:"Quản lý phiếu xuất",addNewTitle:"Thêm phiếu xuất mới"},fa={fetch:"phieuxuat/fetch",delete:"phieuxuat/delete/"},ya=S.a.create()(e=>{let t=e.form,a=(e.index,da(e,["form","index"]));return r.a.createElement(ma.Provider,{value:t},r.a.createElement("tr",a))});class Ea extends r.a.Component{constructor(...e){var t;return t=super(...e),this.getInput=(()=>(this.props.inputType,r.a.createElement(v.a,null))),t}render(){var e=this.props;const t=e.editing,a=e.required,n=e.dataIndex,s=e.title,i=(e.inputType,e.record),l=(e.index,da(e,["editing","required","dataIndex","title","inputType","record","index"]));return r.a.createElement(ma.Consumer,null,e=>{const o=e.getFieldDecorator;return r.a.createElement("td",l,t?r.a.createElement(ua,{style:{margin:0}},o(n,{rules:[{required:a,message:`Hãy nhập dữ liệu ô ${s}!`}],initialValue:i[n]})(this.getInput())):l.children)})}}var Sa=class extends r.a.Component{constructor(e){super(e),this.isEditing=(e=>e.key===this.state.editingKey),this.delete=(e=>{if(e.id)fetch(ISD_BASE_URL+fa.delete+e.id,{headers:k()}).then(e=>e.json()).then(e=>{if("error"==e.status)c.a.error("Có lỗi xảy ra khi xoá sản phẩm!",3);else{let t=this.state.data.filter(t=>t.id!=e.data);this.setState({data:t}),c.a.success(e.message)}}).catch(e=>{c.a.error("Có lỗi xảy ra khi xoá sản phẩm!",3),console.log(e)});else if(e.key){let t=this.state.data.filter(t=>t.key!=e.key);this.setState({data:t})}}),this.state={data:[],addNewItem:!1},this.columns=[{title:"Mã Kho",dataIndex:"ma_kho",editable:!1},{title:"Người nhận hàng",dataIndex:"nguoi_giao_dich",editable:!1},{title:"Lý do xuất kho",dataIndex:"note",editable:!1},{title:"Ngày Tạo",dataIndex:"create_on",editable:!1},{title:"Người Tạo",dataIndex:"username",render:(e,t)=>t.name||e},{title:"Tình trạng",dataIndex:"tinh_trang",editable:!1,render:(e,t)=>pa[e].text||e},{title:"Actions",dataIndex:"operation",render:(e,t)=>{const a=this.isEditing(t);return r.a.createElement("div",{style:{minWidth:100}},a?r.a.createElement("span",null,r.a.createElement(ma.Consumer,null,e=>r.a.createElement("a",{href:"javascript:;",onClick:()=>this.save(e,t.key),style:{marginRight:8}},"Lưu")),r.a.createElement(y.a,{title:"Bạn thật sự muốn huỷ?",onConfirm:()=>this.cancel(t.key)},r.a.createElement("a",{href:"javascript:;"},"Huỷ"))):r.a.createElement(r.a.Fragment,null,r.a.createElement("a",{href:"javascript:;",onClick:()=>this.view(t)},"Xem chi tiết"),r.a.createElement(r.a.Fragment,null," | ",r.a.createElement(y.a,{title:"Bạn thật sự muốn xoá?",okType:"danger",onConfirm:()=>this.delete(t)},r.a.createElement("a",{href:"javascript:;"},"Xoá")))))}}]}getDefaultFields(){return{id:"",ma_kho:"",ma_phieu:"",nguoi_giao_dich:"",so_chung_tu:"",type:"",note:"",address:"",products:[],tinh_trang:"2"}}addNewRow(){this.props.dispatch(u({phieuXuatAction:ca({},this.props.mainState.phieuXuatAction,{addNewItem:!0,action:"edit",editingKey:""}),phieuxuat:this.getDefaultFields()}))}view(e){var t=this.props.mainState;let a=t.phieuxuat,n=t.phieuXuatAction;e&&e.ma_phieu&&e.id&&this.props.dispatch(u({phieuxuat:ca({},a,e),phieuXuatAction:ca({},n,{addNewItem:!0,action:"view"})}))}fetchData(){fetch(ISD_BASE_URL+fa.fetch,{headers:k()}).then(e=>e.json()).then(e=>{if("error"==e.status)c.a.warning(e.message,3);else if(e.data){let t=e.data.map((e,t)=>ca({},e,{key:t}));this.setState({data:t,dataUpToDate:!0}),this.props.dispatch(u({phieuxuat:{refresh:!1}}))}}).catch(e=>{c.a.error("Có lỗi khi tải dữ liệu sản phẩm!",3),console.log(e)})}static getDerivedStateFromProps(e,t){return e.mainState.phieuxuat.refresh?{dataUpToDate:null}:null}componentDidUpdate(){null===this.state.dataUpToDate&&this.fetchData()}componentDidMount(){this.fetchData()}render(){let e=this.props.mainState;const t={body:{row:ya,cell:Ea}},a=this.columns.map(e=>e.editable?ca({},e,{onCell:t=>({record:t,inputType:e.dataIndex,dataIndex:e.dataIndex,title:e.title,editing:this.isEditing(t),required:e.required})}):e);return r.a.createElement(r.a.Fragment,null,e.phieuXuatAction.addNewItem?r.a.createElement(ha,{dispatch:this.props.dispatch,mainState:this.props.mainState}):r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"table-operations"},r.a.createElement(w.a,null,r.a.createElement(x.a,{span:12},r.a.createElement("h2",{className:"head-title"},ga.headTitle)),r.a.createElement(x.a,{span:12},r.a.createElement("div",{className:"action-btns"},r.a.createElement(E.a,{onClick:()=>this.addNewRow(),type:"primary",icon:"plus"},ga.addNewTitle))))),r.a.createElement(C.a,{components:t,bordered:!0,dataSource:this.state.data,columns:a,rowClassName:"editable-row"})))}},xa=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e};function va(e,t){var a={};for(var n in e)t.indexOf(n)>=0||Object.prototype.hasOwnProperty.call(e,n)&&(a[n]=e[n]);return a}const _a=S.a.Item,wa=r.a.createContext(),Ca=S.a.create()(e=>{let t=e.form,a=(e.index,va(e,["form","index"]));return r.a.createElement(wa.Provider,{value:t},r.a.createElement("tr",a))});class ba extends r.a.Component{constructor(...e){var t;return t=super(...e),this.getInput=(()=>{switch(this.props.inputType){case"ma_kh":let e=this.props.khachhang||[];return r.a.createElement(_.a,{style:{width:250},placeholder:"Chọn khách hàng"},e.map(e=>r.a.createElement(_.a.Option,{key:e.id,value:e.name},`${e.id} - ${e.name}`)));case"product_id":let t=this.props.products;return r.a.createElement(_.a,{showSearch:!0,optionFilterProp:"children",filterOption:(e,t)=>t.props.children.toLowerCase().indexOf(e.toLowerCase())>=0,style:{width:200},placeholder:"Chọn VT"},t.map(e=>r.a.createElement(_.a.Option,{key:e.id,value:e.product_id},`${e.product_id} - ${e.name} - ${e.unit} `)));case"date_delive":return r.a.createElement(Ke.a,{placeholder:"Chọn ngày",format:"DD/MM/YYYY"});default:return r.a.createElement(v.a,null)}}),t}render(){var e=this.props;const t=e.editing,a=e.required,n=e.dataIndex,s=e.title,i=(e.inputType,e.record),l=(e.index,va(e,["editing","required","dataIndex","title","inputType","record","index"]));return r.a.createElement(wa.Consumer,null,e=>{const o=e.getFieldDecorator;let h;return i&&(h=i[n],"date_delive"==n&&((h=Pe()(h)).isValid()||(h=null))),r.a.createElement("td",l,t?r.a.createElement(_a,{style:{margin:0}},o(n,{rules:[{required:a,message:`Hãy nhập dữ liệu ô ${s}!`}],initialValue:h})(this.getInput())):l.children)})}}var ka=class extends r.a.Component{constructor(e){super(e),this.isEditing=(e=>e.key===this.state.editingKey),this.cancel=(e=>{this.setState({editingKey:""}),1==this.state.newitem&&(this.state.newitem=0,this.delete(e))}),this.delete=(e=>{if(e.id)fetch(ISD_BASE_URL+"order/deleteDh/"+e.id,{headers:k()}).then(e=>e.json()).then(e=>{if("error"==e.status)c.a.error("Có lỗi xảy ra khi xoá đơn hàng!",3);else{let t=this.state.data.filter(t=>t.id!=e.data);this.setState({data:t}),c.a.success(e.message),this.state.newitem=0}}).catch(e=>{c.a.error("Có lỗi xảy ra khi xoá đơn hàng!",3),console.log(e)});else if(e.key){let t=this.state.data.filter(t=>t.key!=e.key);this.setState({data:t})}}),this.state={data:[],editingKey:"",newitem:0},this.columns=[{title:"Mã Đơn Hàng",dataIndex:"ma_order",width:"10%",editable:!0,required:!0},{title:"Mã Khách hàng",dataIndex:"ma_kh",editable:!0,required:!0},{title:"Mã sản phẩm",dataIndex:"product_id",editable:!0},{title:"Số lượng",dataIndex:"qty",editable:!0},{title:"Ngày nhận hàng",dataIndex:"date_delive",editable:!0,render:(e,t)=>Pe()(e).format("DD/MM/YYYY")},{title:"Actions",dataIndex:"operation",render:(e,t)=>{const a=this.isEditing(t);return r.a.createElement("div",{style:{minWidth:100}},a?r.a.createElement("span",null,r.a.createElement(wa.Consumer,null,e=>r.a.createElement("a",{href:"javascript:;",onClick:()=>this.save(e,t.key),style:{marginRight:8}},"Lưu")),r.a.createElement(y.a,{title:"Bạn thật sự muốn huỷ?",onConfirm:()=>this.cancel(t)},r.a.createElement("a",{href:"javascript:;"},"Huỷ"))):r.a.createElement(r.a.Fragment,null,r.a.createElement("a",{href:"javascript:;",onClick:()=>this.edit(t.key)},"Sửa")," | ",r.a.createElement(y.a,{title:"Bạn thật sự muốn xoá?",okType:"danger",onConfirm:()=>this.delete(t)},r.a.createElement("a",{href:"javascript:;"},"Xoá"))))}}]}addNewRow(){if(0==this.state.newitem){let e=this.getDefaultFields();e=xa({},e,{key:this.state.data.length+1}),this.setState({data:[e,...this.state.data],editingKey:e.key}),this.state.newitem=1}else c.a.error("Bạn đang thêm mới đơn hàng rồi ...")}getDefaultFields(){return{ma_order:"",name:"",phone:"",product_id:"",qty:"",date_delive:""}}edit(e){this.setState({editingKey:e})}save(e,t){e.validateFields((e,a)=>{if(e)return;const n=[...this.state.data],r=n.findIndex(e=>t===e.key);if(r>-1){const e=n[r];let t=xa({},e,a,{date_delive:a.date_delive.format("YYYY-MM-DD")});fetch(ISD_BASE_URL+"order/updateDh",{method:"POST",headers:k(),body:JSON.stringify(t)}).then(e=>e.json()).then(e=>{"error"==e.status?(c.a.error(e.message,3),e.show_login&&this.props.dispatch(u({showLogin:!0}))):(n.splice(r,1,xa({},t,e.data)),this.setState({data:n,editingKey:""}),c.a.success(e.message),this.state.newitem=0)}).catch(e=>{console.log("parsing failed",e),c.a.error("Có lỗi xảy ra trong quá trình lưu hoặc chỉnh sửa!")})}else n.push(data),this.setState({data:n,editingKey:""})})}fetchData(){fetch(ISD_BASE_URL+"order/fetchDh",{headers:k()}).then(e=>e.json()).then(e=>{if("error"==e.status)c.a.warning(e.message,3);else if(e.data){let t=e.data.map((e,t)=>xa({},e,{key:t}));this.setState({data:t})}}).catch(e=>{c.a.error("Có lỗi khi tải dữ liệu đơn hàng!",3),console.log(e)})}fetchKhachhang(){fetch(ISD_BASE_URL+"qlkh/fetchKh",{headers:k()}).then(e=>e.json()).then(e=>{e.data?e.data&&(this.props.dispatch(u({khachhang:e.data})),this.setState({khachhangList:b(e.data)})):c.a.error(e.message)}).catch(e=>{console.log(e)})}fetchProduct(){fetch(ISD_BASE_URL+"product/fetch",{headers:k()}).then(e=>e.json()).then(e=>{e.data?e.data&&(this.props.dispatch(u({products:e.data})),this.setState({productList:b(e.data)})):c.a.error(e.message)}).catch(e=>{console.log(e)})}componentDidMount(){this.fetchKhachhang(),this.fetchProduct(),this.fetchData()}render(){const e={body:{row:Ca,cell:ba}};let t=this.props.mainState.products,a=this.props.mainState.khachhang;const n=this.columns.map(e=>e.editable?xa({},e,{onCell:n=>({record:n,inputType:e.dataIndex,dataIndex:e.dataIndex,title:e.title,editing:this.isEditing(n),required:e.required,products:t,khachhang:a})}):e);return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"table-operations"},r.a.createElement(w.a,null,r.a.createElement(x.a,{span:12},r.a.createElement("h2",{className:"head-title"},"Quản lý đơn hàng")),r.a.createElement(x.a,{span:12},r.a.createElement("div",{className:"action-btns"},r.a.createElement(E.a,{onClick:()=>this.addNewRow(),type:"primary",icon:"plus"},"Thêm mới đơn hàng"))))),r.a.createElement(C.a,{components:e,bordered:!0,dataSource:this.state.data,columns:n,rowClassName:"editable-row"}))}},Ia=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e};const ja=S.a.Item,Da=_.a.Option;var Oa=S.a.create()(class extends r.a.Component{constructor(e){super(e),this.handleSubmit=(e=>{e.preventDefault(),this.props.form.validateFields((e,t)=>{if(e)return;let a={id:this.props.record.id,ma_phieu:this.props.record.ma_phieu,ma_kho:this.state.ma_kho,vi_tri_kho:t.vi_tri_kho.join(",")};this.changeProductPosition(a)})}),this.changeProductPosition=(e=>{this.setState({loading:!0}),fetch(ISD_BASE_URL+"phieunhap/changePosition",{method:"POST",headers:k(),body:JSON.stringify(e)}).then(e=>e.json()).then(e=>{"error"==e.status?(c.a.error(e.message,3),e.show_login&&this.props.dispatch(u({showLogin:!0}))):c.a.success(e.message),this.setState({loading:!1})}).catch(e=>{console.log("parsing failed",e),c.a.error("Có lỗi xảy ra trong quá trình lưu hoặc chỉnh sửa!")})}),this.state={loading:!1,expandedRowRender:!0,ma_kho:this.props.record.ma_kho,vi_tri_kho:this.props.record.vi_tri_kho},this.changeInventory=this.changeInventory.bind(this)}changeInventory(e){this.setState({ma_kho:e,vi_tri_kho:""}),this.props.form.resetFields(["vi_tri_kho"])}fetchKhoData(){fetch(ISD_BASE_URL+"qlkho/fetchKho",{headers:k()}).then(e=>e.json()).then(e=>{"error"==e.status?c.a.warning(e.message,3):e.data&&this.props.dispatch(u({kho:e.data}))}).catch(e=>{c.a.error("Có lỗi khi tải dữ liệu dữ liệu kho!",3),console.log(e)})}fetchViTriKhoData(){fetch(ISD_BASE_URL+"qlvtkho/fetchVtkho",{headers:k()}).then(e=>e.json()).then(e=>{"error"==e.status?c.a.warning(e.message,3):e.data&&this.props.dispatch(u({vi_tri_kho:e.data}))}).catch(e=>{c.a.error("Có lỗi khi tải dữ liệu dữ liệu vị trí kho!",3),console.log(e)})}componentDidMount(){let e=this.props.mainState,t=e.kho||[],a=e.vi_tri_kho||[];t.length||this.fetchKhoData(),a.length||this.fetchViTriKhoData()}khoOptions(){let e=this.props.mainState.kho||[];if(e.length)return e.map(e=>r.a.createElement(Da,{key:e.id,value:e.ma_kho},e.ma_kho," ","-"," ",e.name))}viTriKhoOptions(){let e=this.props.mainState.vi_tri_kho||[];if(e.length)return(e=e.filter(e=>e.ma_kho==this.state.ma_kho)).map(e=>r.a.createElement(Da,{key:e.id,value:e.id},e.name))}render(){const e=this.props.form.getFieldDecorator;var t=this.state;let a=t.ma_kho,n=t.vi_tri_kho,s=[];return""!=n&&(s=n.split(",")),r.a.createElement(S.a,{onSubmit:this.handleSubmit,className:"form-cap-nhat-vi-tri"},r.a.createElement(ja,{label:"Tại kho"},e("ma_kho",{required:!0,initialValue:a})(r.a.createElement(_.a,{onChange:this.changeInventory,placeholder:"Kho hàng"},this.khoOptions()))),r.a.createElement(ja,{label:"Chọn vị trí trong kho"},e("vi_tri_kho",Ia({},{rules:[{required:!0,message:"Hãy chọn vị trí kho"}]},{initialValue:s}))(r.a.createElement(_.a,{mode:"multiple",placeholder:"Chọn vị trí kho"},this.viTriKhoOptions()))),r.a.createElement(ja,{wrapperCol:{xs:{span:24,offset:0},sm:{span:16,offset:8}}},r.a.createElement(E.a,{loading:this.state.loading,type:"primary",htmlType:"submit"},"Cập nhật vị trí")))}}),Ta=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e};const qa=Ke.a.RangePicker,Na=S.a.Item,Aa=_.a.Option;const La=S.a.create()(class extends r.a.Component{constructor(...e){var t;return t=super(...e),this.state={loading:!1},this.handleSearch=(e=>{e.preventDefault(),this.props.form.validateFields((e,t)=>{let a=Ta({},t);if(a.ngay_san_xuat&&a.ngay_san_xuat.length){let e=a.ngay_san_xuat;a.ngay_san_xuat=[e[0].format("YYYY-MM-DD"),e[1].format("YYYY-MM-DD")]}if(a.ngay_het_han&&a.ngay_het_han.length){let e=a.ngay_het_han;a.ngay_het_han=[e[0].format("YYYY-MM-DD"),e[1].format("YYYY-MM-DD")]}this.search(a)})}),this.handleReset=(()=>{this.props.form.resetFields(),this.search()}),t}fetchProductInInventory(){fetch(ISD_BASE_URL+"tinhtrangkho/fetchProductInInventory",{headers:k()}).then(e=>e.json()).then(e=>{"error"==e.status?c.a.warning(e.message,3):e.data&&this.props.dispatch(u({productInInventory:e.data}))}).catch(e=>{c.a.error("Có lỗi khi tải dữ liệu dữ liệu kho!",3),console.log(e)})}fetchKho(){fetch(ISD_BASE_URL+"qlkho/fetchKho",{headers:k()}).then(e=>e.json()).then(e=>{"error"==e.status?c.a.warning(e.message,3):e.data&&this.props.dispatch(u({kho:e.data}))}).catch(e=>{c.a.error("Có lỗi khi tải dữ liệu dữ liệu kho!",3),console.log(e)})}search(e){this.setState({loading:!0}),this.props.loading(!0),fetch(ISD_BASE_URL+"tinhtrangkho/search",{method:"POST",headers:k(),body:JSON.stringify(e)}).then(e=>e.json()).then(e=>{"error"==e.status?c.a.error(e.message,3):this.props.dispatch(u({phieunhap:Ta({},this.props.mainState.phieunhap,{products:e.data})})),this.setState({loading:!1}),this.props.loading(!1)}).catch(e=>{console.log("parsing failed",e),c.a.error("Có lỗi xảy ra trong quá trình tìm kiếm!"),this.setState({loading:!1}),this.props.loading(!1)})}getFields(){let e=this.props.mainState,t=e.kho||[],a=e.productInInventory||[];const n=this.props.form.getFieldDecorator;return r.a.createElement(r.a.Fragment,null,r.a.createElement(x.a,{span:8},r.a.createElement(Na,{label:"Lọc theo mã kho"},n("ma_kho",{rules:[{required:!1}]})(r.a.createElement(_.a,{showSearch:!0,mode:"multiple",placeholder:"Nhập mã kho"},t.map(e=>r.a.createElement(Aa,{value:e.ma_kho,key:e.ma_kho},e.name)))))),r.a.createElement(x.a,{span:8},r.a.createElement(Na,{label:"Lọc theo mã vật tư"},n("product_id",{rules:[{required:!1}]})(r.a.createElement(_.a,{showSearch:!0,mode:"multiple",placeholder:"Nhập mã vật tư"},a.map(e=>r.a.createElement(Aa,{value:e.product_id,key:e.product_id},e.product_id," ","-"," ",e.name)))))),r.a.createElement(x.a,{span:8},r.a.createElement(Na,{label:"Lọc theo mã lô"},n("ma_lo",{rules:[{required:!1}]})(r.a.createElement(v.a,{placeholder:"Nhập mã lô"})))),r.a.createElement(x.a,{span:8},r.a.createElement(Na,{label:"Lọc theo ngày sản xuất"},n("ngay_san_xuat",{rules:[{required:!1}]})(r.a.createElement(qa,{placeholder:["Từ Ngày","Đến Ngày"],format:"DD/MM/YYYY"})))),r.a.createElement(x.a,{span:8},r.a.createElement(Na,{label:"Lọc theo ngày hết hạn"},n("ngay_het_han",{rules:[{required:!1}]})(r.a.createElement(qa,{placeholder:["Từ Ngày","Đến Ngày"],format:"DD/MM/YYYY"})))),r.a.createElement(x.a,{span:8},r.a.createElement(Na,{label:"Lọc sản phẩm sắp hết hạn"},n("sap_het_han",{rules:[{required:!1}]})(r.a.createElement(v.a,{placeholder:"Nhập số ngày"})))))}componentDidMount(){let e=this.props.mainState,t=e.kho||[],a=e.productInInventory||[];t.length||this.fetchKho(),a.length||this.fetchProductInInventory()}render(){return r.a.createElement(S.a,{className:"isd-advanced-search-form",onSubmit:this.handleSearch},r.a.createElement(w.a,{gutter:24},this.getFields()),r.a.createElement(w.a,null,r.a.createElement(x.a,{span:24,style:{textAlign:"center",marginTop:10}},r.a.createElement(E.a,{loading:this.state.loading,type:"primary",htmlType:"submit"},"Tìm kiếm"),r.a.createElement(E.a,{style:{marginLeft:8},onClick:this.handleReset},"Reset bộ lọc"))))}});var Ra=Object(l.b)(e=>({mainState:e.main.present}))(La),Pa=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e};function Ka(e,t){var a={};for(var n in e)t.indexOf(n)>=0||Object.prototype.hasOwnProperty.call(e,n)&&(a[n]=e[n]);return a}const Ma=b(D),Ba=S.a.Item,Ya=r.a.createContext(),Fa={headTitle:"Vật tư trong kho",addNewTitle:"Thêm vật tư vào phiếu nhập"},Ua={changeStatus:"phieunhap/changeStatus"},Ha=S.a.create()(e=>{let t=e.form,a=(e.index,Ka(e,["form","index"]));return r.a.createElement(Ya.Provider,{value:t},r.a.createElement("tr",a))});class Qa extends r.a.Component{constructor(...e){var t;return t=super(...e),this.getInput=(()=>{switch(this.props.inputType){case"product_id":let e=this.props.products;return r.a.createElement(_.a,{showSearch:!0,optionFilterProp:"children",onChange:(e,t)=>{let a=t.props.children.split("-");return a&&a[3]&&(a=a[3].trim()),console.log(a,this.props),!1},filterOption:(e,t)=>t.props.children.toLowerCase().indexOf(e.toLowerCase())>=0,style:{width:200},placeholder:"Chọn VT"},e.map(e=>r.a.createElement(_.a.Option,{key:e.product_id,value:e.product_id},`${e.product_id} - ${e.name} - ${e.unit} `)));case"sl_thucnhap":case"sl_chungtu":case"price":return r.a.createElement(Fe.a,null);default:return r.a.createElement(v.a,null)}}),t}render(){var e=this.props;const t=e.editing,a=e.required,n=e.dataIndex,s=e.title,i=(e.inputType,e.record),l=(e.index,Ka(e,["editing","required","dataIndex","title","inputType","record","index"]));return r.a.createElement(Ya.Consumer,null,e=>{const o=e.getFieldDecorator;return r.a.createElement("td",l,t?r.a.createElement(Ba,{style:{margin:0}},o(n,{rules:[{required:a,message:`Hãy nhập dữ liệu ô ${s}!`}],initialValue:i[n]})(this.getInput())):l.children)})}}var Va=class extends r.a.Component{constructor(e){super(e),this.onInputChange=(e=>{this.setState({searchText:e.target.value})}),this.onSearch=(()=>{const e=this.state.searchText;new RegExp(e,"gi"),this.setState({filterDropdownVisible:!1,filtered:!!e})}),this.handleChange=((e,t,a)=>{this.setState({filteredInfo:t})}),this.clearFilters=(()=>{this.setState({filteredInfo:null})}),this.onSelectChange=(e=>{this.setState({selectedRowKeys:e})}),this.changeStatus=((e,t)=>{this.setState({loading:!0});let a={ids:this.state.selectedRowKeys,type:t,status:e};fetch(ISD_BASE_URL+Ua.changeStatus,{method:"POST",headers:k(),body:JSON.stringify(a)}).then(e=>e.json()).then(e=>{"error"==e.status?(c.a.error(e.message,3),e.show_login&&this.props.dispatch(u({showLogin:!0}))):(this.fetchAllProduct(),c.a.success(e.message)),this.setState({selectedRowKeys:[],loading:!1})}).catch(e=>{console.log("parsing failed",e),c.a.error("Có lỗi xảy ra trong quá trình lưu hoặc chỉnh sửa!")})}),this.isEditing=(e=>e.key===this.props.mainState.phieuAction.editingKey),this.state={productList:{},selectedRowKeys:[],loading:!1,loadProduct:!1,filteredInfo:null,filterDropdownVisible:!1,searchText:"",filtered:!1},this.columns=[{title:"Mã VT",dataIndex:"product_id",width:150,editable:!0,required:!0},{title:"Mã Kho",dataIndex:"ma_kho",width:100,editable:!0,required:!0},{title:"Mã Lô",dataIndex:"ma_lo",width:100,editable:!0,required:!0},{title:"Quy cách",dataIndex:"label",width:200,editable:!0,required:!0},{title:"SL",dataIndex:"sl_thucnhap",editable:!0},{title:"Đơn giá",dataIndex:"price",editable:!0,required:!0},{title:"Ngày SX",dataIndex:"ngay_san_xuat",width:"200px",editable:!0,required:!0,render:(e,t)=>Pe()(e).format("DD/MM/YYYY")},{title:"Ngày hết hạn",dataIndex:"ngay_het_han",width:"200px",editable:!0,required:!0,render:(e,t)=>Pe()(e).format("DD/MM/YYYY")},{title:"QC Duyệt",dataIndex:"qc_check",editable:!1,filterable:!0,filters:D,filterMultiple:!1,width:130,render:(e,t)=>this.showCheckStatus(e)},{title:"QA Duyệt",dataIndex:"qa_check",editable:!1,filterable:!0,filters:D,filterMultiple:!1,width:130,render:(e,t)=>this.showCheckStatus(e)}]}showCheckStatus(e){if(e){let t="processing";return"2"==e&&(t="error"),"1"==e&&(t="success"),r.a.createElement(na.a,{text:Ma[e].text,status:t})}return r.a.createElement(na.a,{text:Ma[0].text,status:"processing"})}getDefaultFields(){return{ma_phieu:"",ma_lo:"",product_id:"",label:"",unit:"kg",sl_chungtu:"1",sl_thucnhap:"1",price:0,qc_check:"0",qa_check:"0"}}isReadOnly(){let e=this.props.mainState.phieuAction;return!(!e||"view"!=e.action)}fetchAllProduct(){this.setState({loadProduct:!0}),fetch(ISD_BASE_URL+"tinhtrangkho/fetchAllProduct",{headers:k()}).then(e=>e.json()).then(e=>{e.data?e.data&&this.props.dispatch(u({phieunhap:Pa({},this.props.mainState.phieunhap,{products:e.data})})):c.a.error(e.message),this.setState({loadProduct:!1})}).catch(e=>{console.log(e)})}getStatusMenu(e){const t=D.map(t=>r.a.createElement(d.a.Item,{key:t.id},r.a.createElement("a",{onClick:()=>{this.changeStatus(t.id,e)},rel:"noopener noreferrer"},t.text)));return r.a.createElement(d.a,null,t)}getActionsByRoles(){if(!this.props.isQA&&!this.props.isQC)return!1;var e=this.state;let t=e.selectedRowKeys,a=e.loading;const n=t.length>0;return r.a.createElement("div",{style:{marginBottom:16}},this.props.isQC?r.a.createElement(St.a,{overlay:this.getStatusMenu("qc_check"),trigger:["click"],disabled:!n},r.a.createElement(E.a,{type:"primary",loading:a},"QC Phê duyệt")):null,this.props.isQA?r.a.createElement(St.a,{overlay:this.getStatusMenu("qa_check"),trigger:["click"],disabled:!n},r.a.createElement(E.a,{type:"primary",loading:a},"QA Phê duyệt")):null,r.a.createElement("span",{style:{marginLeft:8}},n?`Đã chọn ${t.length} vật tư`:""))}componentDidMount(){this.fetchAllProduct()}render(){const e={body:{row:Ha,cell:Qa}};let t=this.props.mainState.products,a=this.columns.map(e=>e.editable?Pa({},e,{onCell:a=>({record:a,inputType:e.dataIndex,dataIndex:e.dataIndex,title:e.title,editing:this.isEditing(a),required:e.required,products:t})}):e);a=a.filter(e=>{if(this.props.isQA||this.props.isQC){if("operation"==e.dataIndex)return!1;if(this.props.isQC&&"qa_check"==e.dataIndex)return!1}return!0});var n=this.state;let s=n.filteredInfo,i=n.searchText;s=s||{},a=a.map(e=>{if(e.filterable)switch(e.dataIndex){case"qc_check":return Pa({},e,{filteredValue:s.qc_check||null,onFilter:(e,t)=>t.qc_check.includes(e)});case"qa_check":return Pa({},e,{filteredValue:s.qa_check||null,onFilter:(e,t)=>t.qa_check.includes(e)})}return"product_id"==e.dataIndex?Pa({},e,{filterDropdown:r.a.createElement("div",{className:"custom-filter-dropdown"},r.a.createElement(v.a,{ref:e=>this.searchInput=e,placeholder:"Nhập mã vật tư",value:this.state.searchText,onChange:this.onInputChange,onPressEnter:this.onSearch}),r.a.createElement(E.a,{type:"primary",onClick:this.onSearch},"Tìm")),filterIcon:r.a.createElement(h.a,{type:"search",style:{color:this.state.filtered?"#108ee9":"#aaa"}}),filterDropdownVisible:this.state.filterDropdownVisible,onFilterDropdownVisibleChange:e=>{this.setState({filterDropdownVisible:e},()=>this.searchInput&&this.searchInput.focus())}}):e});let l=this.props.mainState.phieunhap.products||[];const o=new RegExp(i,"gi");i&&(l=l.map(e=>e.product_id.match(o)?Pa({},e,{product_id:r.a.createElement("span",null,e.product_id.split(new RegExp(`(?<=${i})|(?=${i})`,"i")).map((e,t)=>e.toLowerCase()===i.toLowerCase()?r.a.createElement("span",{key:t,className:"highlight"},e):e))}):null).filter(e=>!!e));const c={selectedRowKeys:this.state.selectedRowKeys,onChange:this.onSelectChange};return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"table-operations no-margin"},r.a.createElement(w.a,null,r.a.createElement(x.a,{span:12},r.a.createElement("h2",{className:"head-title"},Fa.headTitle)),r.a.createElement(x.a,{span:12}))),this.getActionsByRoles(),r.a.createElement(C.a,{rowSelection:c,components:e,bordered:!0,dataSource:l,columns:a,rowClassName:"editable-row",loading:this.state.loadProduct,scroll:{x:1500},onChange:this.handleChange,title:()=>r.a.createElement(Ra,{loading:e=>{this.setState({loadProduct:e})}}),expandedRowRender:e=>r.a.createElement(Oa,{mainState:this.props.mainState,dispatch:this.props.dispatch,record:e})}))}},$a=a(500);var Xa=class extends r.a.Component{render(){return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"table-operations no-margin"},r.a.createElement(w.a,null,r.a.createElement(x.a,{span:12},r.a.createElement("h2",{className:"head-title"},"Thông tin tổng hợp")),r.a.createElement(x.a,{span:12}))),r.a.createElement("div",{style:{background:"#ECECEC",padding:"10px",marginBottom:10}},r.a.createElement(w.a,{gutter:16},r.a.createElement(x.a,{span:6},r.a.createElement($a.a,{title:"Tổng sản phẩm trong kho",bordered:!1},r.a.createElement("div",{className:"isd-status-number"},"1000"))),r.a.createElement(x.a,{span:6},r.a.createElement($a.a,{title:"Sản phẩm chờ duyệt",bordered:!1},r.a.createElement("div",{className:"isd-status-number"},"200"))),r.a.createElement(x.a,{span:6},r.a.createElement($a.a,{title:"Sản phẩm chờ trả hàng",bordered:!1},r.a.createElement("div",{className:"isd-status-number"},"170"))),r.a.createElement(x.a,{span:6},r.a.createElement($a.a,{title:"Sản phẩm chưa chuyển kho",bordered:!1},r.a.createElement("div",{className:"isd-status-number"},"90"))))))}};b(j);var Ja=class extends r.a.Component{constructor(e){super(e)}isQC(){let e=this.props.mainState.userRoles;for(let t=0;t<e.length;t++)if("nhomqc"==e[t].path)return!0;return!1}isQA(){let e=this.props.mainState.userRoles;for(let t=0;t<e.length;t++)if("nhomqa"==e[t].path)return!0;return!1}componentDidMount(){}render(){return r.a.createElement(r.a.Fragment,null,r.a.createElement(Xa,{isQA:this.isQA(),isQC:this.isQC(),dispatch:this.props.dispatch,mainState:this.props.mainState}),r.a.createElement(Va,{isQA:this.isQA(),isQC:this.isQC(),dispatch:this.props.dispatch,mainState:this.props.mainState}))}},za=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e};function Wa(e,t){var a={};for(var n in e)t.indexOf(n)>=0||Object.prototype.hasOwnProperty.call(e,n)&&(a[n]=e[n]);return a}const Ga=S.a.Item,Za=r.a.createContext(),en=S.a.create()(e=>{let t=e.form,a=(e.index,Wa(e,["form","index"]));return r.a.createElement(Za.Provider,{value:t},r.a.createElement("tr",a))});class tn extends r.a.Component{constructor(...e){var t;return t=super(...e),this.getInput=(()=>(this.props.inputType,r.a.createElement(v.a,null))),t}render(){var e=this.props;const t=e.editing,a=e.required,n=e.dataIndex,s=e.title,i=(e.inputType,e.record),l=(e.index,Wa(e,["editing","required","dataIndex","title","inputType","record","index"]));return r.a.createElement(Za.Consumer,null,e=>{const o=e.getFieldDecorator;return r.a.createElement("td",l,t?r.a.createElement(Ga,{style:{margin:0}},o(n,{rules:[{required:a,message:`Hãy nhập dữ liệu ô ${s}!`}],initialValue:i[n]})(this.getInput())):l.children)})}}var an=class extends r.a.Component{constructor(e){super(e),this.isEditing=(e=>e.key===this.state.editingKey),this.cancel=(e=>{this.setState({editingKey:""}),1==this.state.newitem&&(this.state.newitem=0,this.delete(e))}),this.delete=(e=>{if(e.id)fetch(ISD_BASE_URL+"qlns/deleteNs/"+e.id,{headers:k()}).then(e=>e.json()).then(e=>{if("error"==e.status)c.a.error("Có lỗi xảy ra khi xoá dữ liệu nhân viên!",3);else{let t=this.state.data.filter(t=>t.id!=e.data);this.setState({data:t}),c.a.success(e.message),this.state.newitem=0}}).catch(e=>{c.a.error("Có lỗi xảy ra khi xoá dữ liệu nhân viên!",3),console.log(e)});else if(e.key){let t=this.state.data.filter(t=>t.key!=e.key);this.setState({data:t})}}),this.state={data:[],editingKey:"",newitem:0},this.columns=[{title:"Mã Nhân viên",dataIndex:"ma_ns",width:"15%",editable:!0,required:!0},{title:"Tên",dataIndex:"name",editable:!0,required:!0},{title:"Số điện thoại",dataIndex:"phone",editable:!0,required:!0},{title:"Tổ",dataIndex:"group",editable:!0,required:!0},{title:"Thông tin",dataIndex:"description",editable:!0,required:!1},{title:"Actions",dataIndex:"operation",render:(e,t)=>{const a=this.isEditing(t);return r.a.createElement("div",{style:{minWidth:100}},a?r.a.createElement("span",null,r.a.createElement(Za.Consumer,null,e=>r.a.createElement("a",{href:"javascript:;",onClick:()=>this.save(e,t.key),style:{marginRight:8}},"Lưu")),r.a.createElement(y.a,{title:"Bạn thật sự muốn huỷ?",onConfirm:()=>this.cancel(t)},r.a.createElement("a",{href:"javascript:;"},"Huỷ"))):r.a.createElement(r.a.Fragment,null,r.a.createElement("a",{href:"javascript:;",onClick:()=>this.edit(t.key)},"Sửa")," | ",r.a.createElement(y.a,{title:"Bạn thật sự muốn xoá?",okType:"danger",onConfirm:()=>this.delete(t)},r.a.createElement("a",{href:"javascript:;"},"Xoá"))))}}]}addNewRow(){if(0==this.state.newitem){let e=this.getDefaultFields();e=za({},e,{key:this.state.data.length+1}),this.setState({data:[e,...this.state.data],editingKey:e.key}),this.state.newitem=1}else c.a.error("Bạn đang thêm mới nhân viên rồi ...")}getDefaultFields(){return{ma_ns:"",name:"",description:""}}edit(e){this.setState({editingKey:e})}save(e,t){e.validateFields((e,a)=>{if(e)return;const n=[...this.state.data],r=n.findIndex(e=>t===e.key);if(r>-1){const e=n[r];let t=za({},e,a);fetch(ISD_BASE_URL+"qlns/updateNs",{method:"POST",headers:k(),body:JSON.stringify(t)}).then(e=>e.json()).then(e=>{"error"==e.status?c.a.error(e.message,3):(n.splice(r,1,za({},t,e.data)),this.setState({data:n,editingKey:""}),c.a.success(e.message),this.state.newitem=0)}).catch(e=>{console.log("parsing failed",e),c.a.error("Có lỗi xảy ra trong quá trình lưu hoặc chỉnh sửa!")})}else n.push(data),this.setState({data:n,editingKey:""})})}fetchData(){fetch(ISD_BASE_URL+"qlns/fetchNs",{headers:k()}).then(e=>e.json()).then(e=>{if("error"==e.status)c.a.warning(e.message,3);else if(e.data){let t=e.data.map((e,t)=>za({},e,{key:t}));this.setState({data:t})}}).catch(e=>{c.a.error("Có lỗi khi tải dữ liệu dữ liệu nhân viên!",3),console.log(e)})}componentDidMount(){this.fetchData()}render(){const e={body:{row:en,cell:tn}},t=this.columns.map(e=>e.editable?za({},e,{onCell:t=>({record:t,inputType:e.dataIndex,dataIndex:e.dataIndex,title:e.title,editing:this.isEditing(t),required:e.required})}):e);return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"table-operations"},r.a.createElement(w.a,null,r.a.createElement(x.a,{span:12},r.a.createElement("h2",{className:"head-title"},"Quản lý nhân viên")),r.a.createElement(x.a,{span:12},r.a.createElement("div",{className:"action-btns"},r.a.createElement(E.a,{onClick:()=>this.addNewRow(),type:"primary",icon:"plus"},"Thêm nhân viên mới"))))),r.a.createElement(C.a,{components:e,bordered:!0,dataSource:this.state.data,columns:t,rowClassName:"editable-row"}))}},nn=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e};function rn(e,t){var a={};for(var n in e)t.indexOf(n)>=0||Object.prototype.hasOwnProperty.call(e,n)&&(a[n]=e[n]);return a}const sn=S.a.Item,ln=r.a.createContext(),on=S.a.create()(e=>{let t=e.form,a=(e.index,rn(e,["form","index"]));return r.a.createElement(ln.Provider,{value:t},r.a.createElement("tr",a))});class hn extends r.a.Component{constructor(...e){var t;return t=super(...e),this.getInput=(()=>(this.props.inputType,r.a.createElement(v.a,null))),t}render(){var e=this.props;const t=e.editing,a=e.required,n=e.dataIndex,s=e.title,i=(e.inputType,e.record),l=(e.index,rn(e,["editing","required","dataIndex","title","inputType","record","index"]));return r.a.createElement(ln.Consumer,null,e=>{const o=e.getFieldDecorator;return r.a.createElement("td",l,t?r.a.createElement(sn,{style:{margin:0}},o(n,{rules:[{required:a,message:`Hãy nhập dữ liệu ô ${s}!`}],initialValue:i[n]})(this.getInput())):l.children)})}}var cn=class extends r.a.Component{constructor(e){super(e),this.isEditing=(e=>e.key===this.state.editingKey),this.cancel=(e=>{this.setState({editingKey:""}),1==this.state.newitem&&(this.state.newitem=0,this.delete(e))}),this.delete=(e=>{if(e.id)fetch(ISD_BASE_URL+"qljobs/deleteJob/"+e.id,{headers:k()}).then(e=>e.json()).then(e=>{if("error"==e.status)c.a.error("Có lỗi xảy ra khi xoá dữ liệu công việc!",3);else{let t=this.state.data.filter(t=>t.id!=e.data);this.setState({data:t}),c.a.success(e.message),this.state.newitem=0}}).catch(e=>{c.a.error("Có lỗi xảy ra khi xoá dữ liệu công việc!",3),console.log(e)});else if(e.key){let t=this.state.data.filter(t=>t.key!=e.key);this.setState({data:t})}}),this.state={data:[],editingKey:"",newitem:0},this.columns=[{title:"Mã Công Việc",dataIndex:"ma_cv",width:"15%",editable:!0,required:!0},{title:"Diễn giải",dataIndex:"diengiai",editable:!0,required:!0},{title:"Công hệ số",dataIndex:"heso",width:"15%",editable:!0,required:!0},{title:"Sản lượng theo giờ",dataIndex:"sanluong",width:"15%",editable:!0,required:!0},{title:"Ghi chú",dataIndex:"description",editable:!0,required:!1},{title:"Actions",dataIndex:"operation",render:(e,t)=>{const a=this.isEditing(t);return r.a.createElement("div",{style:{minWidth:100}},a?r.a.createElement("span",null,r.a.createElement(ln.Consumer,null,e=>r.a.createElement("a",{href:"javascript:;",onClick:()=>this.save(e,t.key),style:{marginRight:8}},"Lưu")),r.a.createElement(y.a,{title:"Bạn thật sự muốn huỷ?",onConfirm:()=>this.cancel(t)},r.a.createElement("a",{href:"javascript:;"},"Huỷ"))):r.a.createElement(r.a.Fragment,null,r.a.createElement("a",{href:"javascript:;",onClick:()=>this.edit(t.key)},"Sửa")," | ",r.a.createElement(y.a,{title:"Bạn thật sự muốn xoá?",okType:"danger",onConfirm:()=>this.delete(t)},r.a.createElement("a",{href:"javascript:;"},"Xoá"))))}}]}addNewRow(){if(0==this.state.newitem){let e=this.getDefaultFields();e=nn({},e,{key:this.state.data.length+1}),this.setState({data:[e,...this.state.data],editingKey:e.key}),this.state.newitem=1}else c.a.error("Bạn đang thêm mới công việc rồi ...")}getDefaultFields(){return{ma_cv:"",diengiai:"",heso:"",sanluong:"",description:""}}edit(e){this.setState({editingKey:e})}save(e,t){e.validateFields((e,a)=>{if(e)return;const n=[...this.state.data],r=n.findIndex(e=>t===e.key);if(r>-1){const e=n[r];let t=nn({},e,a);fetch(ISD_BASE_URL+"qljobs/updateJob",{method:"POST",headers:k(),body:JSON.stringify(t)}).then(e=>e.json()).then(e=>{"error"==e.status?c.a.error(e.message,3):(n.splice(r,1,nn({},t,e.data)),this.setState({data:n,editingKey:""}),c.a.success(e.message),this.state.newitem=0)}).catch(e=>{console.log("parsing failed",e),c.a.error("Có lỗi xảy ra trong quá trình lưu hoặc chỉnh sửa!")})}else n.push(data),this.setState({data:n,editingKey:""})})}fetchData(){fetch(ISD_BASE_URL+"qljobs/fetchJob",{headers:k()}).then(e=>e.json()).then(e=>{if("error"==e.status)c.a.warning(e.message,3);else if(e.data){let t=e.data.map((e,t)=>nn({},e,{key:t}));this.setState({data:t})}}).catch(e=>{c.a.error("Có lỗi khi tải dữ liệu dữ liệu công việc!",3),console.log(e)})}componentDidMount(){this.fetchData()}render(){const e={body:{row:on,cell:hn}},t=this.columns.map(e=>e.editable?nn({},e,{onCell:t=>({record:t,inputType:e.dataIndex,dataIndex:e.dataIndex,title:e.title,editing:this.isEditing(t),required:e.required})}):e);return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"table-operations"},r.a.createElement(w.a,null,r.a.createElement(x.a,{span:12},r.a.createElement("h2",{className:"head-title"},"Quản lý công việc")),r.a.createElement(x.a,{span:12},r.a.createElement("div",{className:"action-btns"},r.a.createElement(E.a,{onClick:()=>this.addNewRow(),type:"primary",icon:"plus"},"Thêm công việc mới"))))),r.a.createElement(C.a,{components:e,bordered:!0,dataSource:this.state.data,columns:t,rowClassName:"editable-row"}))}},dn=a(295),pn=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e};const un=Ke.a.RangePicker,mn=S.a.Item,gn=_.a.Option;const fn=S.a.create()(class extends r.a.Component{constructor(...e){var t;return t=super(...e),this.state={loading:!1},this.handleSearch=(e=>{e.preventDefault(),this.props.form.validateFields((e,t)=>{let a=pn({},t);if(a.workday&&a.workday.length){let e=a.workday;a.workday=[e[0].format("YYYY-MM-DD"),e[1].format("YYYY-MM-DD")]}this.search(a)})}),this.handleReset=(()=>{this.props.form.resetFields(),this.search()}),t}fetchJob(){fetch(ISD_BASE_URL+"qljobs/fetchJob",{headers:k()}).then(e=>e.json()).then(e=>{"error"==e.status?c.a.warning(e.message,3):e.data&&this.props.dispatch(u({jobs:e.data}))}).catch(e=>{c.a.error("Có lỗi khi tải dữ liệu dữ liệu kho!",3),console.log(e)})}fetchNv(){fetch(ISD_BASE_URL+"qlns/fetchNs",{headers:k()}).then(e=>e.json()).then(e=>{"error"==e.status?c.a.warning(e.message,3):e.data&&this.props.dispatch(u({nhanviens:e.data}))}).catch(e=>{c.a.error("Có lỗi khi tải dữ liệu dữ liệu kho!",3),console.log(e)})}search(e){this.setState({loading:!0}),this.props.loading(!0),fetch(ISD_BASE_URL+"qlsl/search",{method:"POST",headers:k(),body:JSON.stringify(e)}).then(e=>e.json()).then(e=>{"error"==e.status?c.a.error(e.message,3):this.props.onResult(e.data),this.setState({loading:!1}),this.props.loading(!1)}).catch(e=>{console.log("parsing failed",e),c.a.error("Có lỗi xảy ra trong quá trình tìm kiếm!"),this.setState({loading:!1}),this.props.loading(!1)})}getFields(){let e=this.props.mainState,t=e.jobs||[],a=e.nhanviens||[];const n=this.props.form.getFieldDecorator;return r.a.createElement(r.a.Fragment,null,r.a.createElement(x.a,{span:8},r.a.createElement(mn,{label:"Lọc theo ngày"},n("workday",{rules:[{required:!1}]})(r.a.createElement(un,{placeholder:["Từ Ngày","Đến Ngày"],format:"DD/MM/YYYY"})))),r.a.createElement(x.a,{span:8},r.a.createElement(mn,{label:"Lọc theo nhân viên"},n("ma_ns",{rules:[{required:!1}]})(r.a.createElement(_.a,{showSearch:!0,optionFilterProp:"children",filterOption:(e,t)=>t.props.children.join("").toLowerCase().indexOf(e.toLowerCase())>=0,mode:"multiple",placeholder:"Nhập mã nhân viên"},a.map(e=>r.a.createElement(gn,{value:e.ma_ns,key:e.ma_ns},e.ma_ns," ","-"," ",e.name)))))),r.a.createElement(x.a,{span:8},r.a.createElement(mn,{label:"Lọc theo mã công việc"},n("ma_cv",{rules:[{required:!1}]})(r.a.createElement(_.a,{showSearch:!0,optionFilterProp:"children",filterOption:(e,t)=>t.props.children.join("").toLowerCase().indexOf(e.toLowerCase())>=0,mode:"multiple",placeholder:"Nhập mã công việc"},t.map(e=>r.a.createElement(gn,{value:e.ma_cv,key:e.ma_cv},e.ma_cv," - ",e.diengiai)))))))}componentDidMount(){let e=this.props.mainState,t=e.nhanviens||[],a=e.jobs||[];t.length||this.fetchNv(),a.length||this.fetchJob()}render(){return r.a.createElement(S.a,{className:"isd-advanced-search-form",onSubmit:this.handleSearch},r.a.createElement(w.a,{gutter:24},this.getFields()),r.a.createElement(w.a,null,r.a.createElement(x.a,{span:24,style:{textAlign:"center",marginTop:10}},r.a.createElement(E.a,{loading:this.state.loading,type:"primary",htmlType:"submit"},"Tìm kiếm"),r.a.createElement(E.a,{style:{marginLeft:8},onClick:this.handleReset},"Xóa bộ lọc"))))}});var yn=Object(l.b)(e=>({mainState:e.main.present}))(fn),En=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e};function Sn(e,t){var a={};for(var n in e)t.indexOf(n)>=0||Object.prototype.hasOwnProperty.call(e,n)&&(a[n]=e[n]);return a}const xn=S.a.Item,vn=r.a.createContext(),_n=S.a.create()(e=>{let t=e.form,a=(e.index,Sn(e,["form","index"]));return r.a.createElement(vn.Provider,{value:t},r.a.createElement("tr",a))});class wn extends r.a.Component{constructor(...e){var t;return t=super(...e),this.getInput=(()=>{switch(this.props.inputType){case"ma_ns":let e=this.props.khachhang||[];return r.a.createElement(_.a,{style:{maxWidth:200},placeholder:"Chọn nhân viên"},e.map(e=>r.a.createElement(_.a.Option,{key:e.id,value:e.ma_ns},`${e.ma_ns} - ${e.name}`)));case"ma_cv":let t=this.props.jobs||[];return r.a.createElement(_.a,{style:{maxWidth:200},placeholder:"Chọn công việc"},t.map(e=>r.a.createElement(_.a.Option,{key:e.id,value:e.ma_cv},`${e.ma_cv} - ${e.diengiai}  - ${e.heso}`)));case"workday":return r.a.createElement(Ke.a,{placeholder:"Chọn ngày",format:"DD-MM-YYYY"});case"timestart":case"timestop":return r.a.createElement(dn.a,{placeholder:"Chọn giờ",format:"HH:mm"});default:return r.a.createElement(v.a,null)}}),t}render(){var e=this.props;const t=e.editing,a=e.required,n=e.dataIndex,s=e.title,i=(e.inputType,e.record),l=(e.index,Sn(e,["editing","required","dataIndex","title","inputType","record","index"]));return r.a.createElement(vn.Consumer,null,e=>{const o=e.getFieldDecorator;let h;return i&&(h=i[n],"workday"==n?(h=Pe()(h)).isValid()||(h=null):"timestart"!=n&&"timestop"!=n||(h=Pe()(h,"HH:mm")).isValid()||(h=null)),r.a.createElement("td",l,t?r.a.createElement(xn,{style:{margin:0}},o(n,{rules:[{required:a,message:`Hãy nhập dữ liệu ô ${s}!`}],initialValue:h})(this.getInput())):l.children)})}}var Cn=class extends r.a.Component{constructor(e){super(e),this.isEditing=(e=>e.key===this.state.editingKey),this.cancel=(e=>{this.setState({editingKey:""}),1==this.state.newitem&&(this.state.newitem=0,this.delete(e))}),this.delete=(e=>{if(e.id)fetch(ISD_BASE_URL+"qlsl/deleteSl/"+e.id,{headers:k()}).then(e=>e.json()).then(e=>{if("error"==e.status)c.a.error("Có lỗi xảy ra khi xoá sản lượng!",3);else{let t=this.state.data.filter(t=>t.id!=e.data);this.setState({data:t}),c.a.success(e.message),this.state.newitem=0}}).catch(e=>{c.a.error("Có lỗi xảy ra khi xoá sản lượng!",3),console.log(e)});else if(e.key){let t=this.state.data.filter(t=>t.key!=e.key);this.setState({data:t})}}),this.state={data:[],editingKey:"",newitem:0,jobsList:{},khachhangList:{},loading:!1},this.columns=[{title:"Ngày tạo",dataIndex:"workday",width:"18%",editable:!0,required:!0,render:(e,t)=>Pe()(e).format("DD-MM-YYYY")},{title:"Mã nhân viên",dataIndex:"ma_ns",editable:!0,required:!0,render:(e,t)=>{let a=e,n="";return this.state.khachhangList&&this.state.khachhangList[e]&&(a=this.state.khachhangList[e].name,n=this.state.khachhangList[e].ma_ns),r.a.createElement("span",null,n," - ",a)}},{title:"Mã công việc",dataIndex:"ma_cv",editable:!0,required:!0,render:(e,t)=>{let a=e,n="",s="";return this.state.jobsList&&this.state.jobsList[e]&&(a=this.state.jobsList[e].diengiai,n=this.state.jobsList[e].ma_cv,s=this.state.jobsList[e].heso),r.a.createElement("span",null,n," - ",a," - ",s)}},{title:"Giờ bắt đầu",dataIndex:"timestart",editable:!0,render:(e,t)=>Pe()(e,"HH:mm").format("HH:mm")},{title:"Giờ kết thúc",dataIndex:"timestop",editable:!0,render:(e,t)=>Pe()(e,"HH:mm").format("HH:mm")},{title:"Kết quả / sản lượng",dataIndex:"sanluong",width:"20%",editable:!0},{title:"Actions",dataIndex:"operation",render:(e,t)=>{const a=this.isEditing(t);return r.a.createElement("div",{style:{minWidth:100}},a?r.a.createElement("span",null,r.a.createElement(vn.Consumer,null,e=>r.a.createElement("a",{href:"javascript:;",onClick:()=>this.save(e,t.key),style:{marginRight:8}},"Lưu")),r.a.createElement(y.a,{title:"Bạn thật sự muốn huỷ?",onConfirm:()=>this.cancel(t)},r.a.createElement("a",{href:"javascript:;"},"Huỷ"))):r.a.createElement(r.a.Fragment,null,r.a.createElement("a",{href:"javascript:;",onClick:()=>this.edit(t.key)},"Sửa")," | ",r.a.createElement(y.a,{title:"Bạn thật sự muốn xoá?",okType:"danger",onConfirm:()=>this.delete(t)},r.a.createElement("a",{href:"javascript:;"},"Xoá"))))}}]}addNewRow(){if(0==this.state.newitem){let e=this.getDefaultFields();e=En({},e,{key:this.state.data.length+1}),this.setState({data:[e,...this.state.data],editingKey:e.key}),this.state.newitem=1}else c.a.error("Bạn đang thêm mới sản lượng rồi ...")}getDefaultFields(){return{ma_sl:"",ma_ns:"",ma_cv:"",timestart:"",timestop:"",workday:"",ca:"",sanluong:"",address:"",ot:""}}edit(e){this.setState({editingKey:e})}save(e,t){e.validateFields((e,a)=>{if(e)return;const n=[...this.state.data],r=n.findIndex(e=>t===e.key);if(r>-1){const e=n[r];let t=En({},e,a,{workday:a.workday.format("DD-MM-YYYY"),timestart:a.timestart.format("HH:mm"),timestop:a.timestop.format("HH:mm")});fetch(ISD_BASE_URL+"qlsl/updateSl",{method:"POST",headers:k(),body:JSON.stringify(t)}).then(e=>e.json()).then(e=>{"error"==e.status?(c.a.error(e.message,3),e.show_login&&this.props.dispatch(u({showLogin:!0}))):(n.splice(r,1,En({},t,e.data)),this.setState({data:n,editingKey:""}),c.a.success(e.message),this.state.newitem=0)}).catch(e=>{console.log("parsing failed",e),c.a.error("Có lỗi xảy ra trong quá trình lưu hoặc chỉnh sửa!")})}else n.push(data),this.setState({data:n,editingKey:""})})}fetchData(){this.setState({loading:!0}),fetch(ISD_BASE_URL+"qlsl/fetchSl",{headers:k()}).then(e=>e.json()).then(e=>{if("error"==e.status)c.a.warning(e.message,3);else if(e.data){let t=e.data.map((e,t)=>En({},e,{key:t}));this.setState({data:t})}this.setState({loading:!1})}).catch(e=>{c.a.error("Có lỗi khi tải dữ liệu sản lượng!",3),console.log(e),this.setState({loading:!1})})}fetchNhanvien(){fetch(ISD_BASE_URL+"qlns/fetchNs",{headers:k()}).then(e=>e.json()).then(e=>{e.data?e.data&&(this.props.dispatch(u({khachhang:e.data})),this.setState({khachhangList:b(e.data,"ma_ns")})):c.a.error(e.message)}).catch(e=>{console.log(e)})}fetchJobs(){fetch(ISD_BASE_URL+"qljobs/fetchJob",{headers:k()}).then(e=>e.json()).then(e=>{e.data?e.data&&(this.props.dispatch(u({jobs:e.data})),this.setState({jobsList:b(e.data,"ma_cv")})):c.a.error(e.message)}).catch(e=>{console.log(e)})}componentDidMount(){this.fetchNhanvien(),this.fetchJobs(),this.fetchData()}render(){const e={body:{row:_n,cell:wn}};let t=this.props.mainState.jobs,a=this.props.mainState.khachhang;this.props.mainState.data;const n=this.columns.map(e=>e.editable?En({},e,{onCell:n=>({record:n,inputType:e.dataIndex,dataIndex:e.dataIndex,title:e.title,editing:this.isEditing(n),required:e.required,jobs:t,khachhang:a})}):e);return this.state.selectedRowKeys,this.onSelectChange,r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"table-operations"},r.a.createElement(w.a,null,r.a.createElement(x.a,{span:12},r.a.createElement("h2",{className:"head-title"},"Quản lý sản lượng hàng ngày")),r.a.createElement(x.a,{span:12},r.a.createElement("div",{className:"action-btns"},r.a.createElement(E.a,{onClick:()=>this.addNewRow(),type:"primary",icon:"plus"},"Thêm mới"))))),r.a.createElement(C.a,{components:e,bordered:!0,dataSource:this.state.data,columns:n,loading:this.state.loading,rowClassName:"editable-row",pagination:{pageSize:20},title:()=>r.a.createElement(yn,{onResult:e=>{this.setState({data:e})},loading:e=>{this.setState({loading:e})}})}))}},bn=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e};function kn(e,t){var a={};for(var n in e)t.indexOf(n)>=0||Object.prototype.hasOwnProperty.call(e,n)&&(a[n]=e[n]);return a}const In=Ke.a.MonthPicker,jn=S.a.Item,Dn=r.a.createContext(),On=S.a.create()(e=>{let t=e.form,a=(e.index,kn(e,["form","index"]));return r.a.createElement(Dn.Provider,{value:t},r.a.createElement("tr",a))});class Tn extends r.a.Component{constructor(...e){var t;return t=super(...e),this.getInput=(()=>{switch(this.props.inputType){case"ma_ns":let e=this.props.khachhang||[];return r.a.createElement(_.a,{placeholder:"Chọn nhân viên"},e.map(e=>r.a.createElement(_.a.Option,{key:e.id,value:e.id},`${e.ma_ns} - ${e.name}`)));case"workday":return r.a.createElement(Ke.a,{placeholder:"Chọn ngày",format:"DD-MM-YYYY"});case"timestart":case"timestop":return r.a.createElement(dn.a,{placeholder:"Chọn giờ",format:"HH:mm"});default:return r.a.createElement(v.a,null)}}),t}render(){var e=this.props;const t=e.editing,a=e.required,n=e.dataIndex,s=e.title,i=(e.inputType,e.record),l=(e.index,kn(e,["editing","required","dataIndex","title","inputType","record","index"]));return r.a.createElement(Dn.Consumer,null,e=>{const o=e.getFieldDecorator;let h;return i&&(h=i[n],"workday"==n?(h=Pe()(h)).isValid()||(h=null):"timestart"!=n&&"timestop"!=n||(h=Pe()(h,"HH:mm")).isValid()||(h=null)),r.a.createElement("td",l,t?r.a.createElement(jn,{style:{margin:0}},o(n,{rules:[{required:a,message:`Hãy nhập dữ liệu ô ${s}!`}],initialValue:h})(this.getInput())):l.children)})}}var qn=class extends r.a.Component{constructor(e){super(e),this.isEditing=(e=>e.key===this.state.editingKey),this.state={data:[],total:[],editingKey:"",newitem:0,jobsList:{}},this.columns=[{title:"Mã nhân viên",dataIndex:"ma_ns",editable:!0,required:!0},{title:"Tên nhân viên",dataIndex:"name",editable:!0,required:!0},{title:"Sum 1.0",dataIndex:"heso1",editable:!1},{title:"Sum 1.2",dataIndex:"heso12",editable:!1},{title:"Sum 1.3",dataIndex:"heso13",editable:!1},{title:"Sum OT 1.0",dataIndex:"heso21",editable:!1},{title:"Sum OT 1.2",dataIndex:"heso22",editable:!1},{title:"Sum OT 1.3",dataIndex:"heso23",editable:!1},{title:"Tổng công",dataIndex:"tong_cong",editable:!0},{title:"Công quy đổi",dataIndex:"songay",editable:!0}]}getDefaultFields(){return{ma_sl:"",ma_ns:"",ma_cv:"",timestart:"",timestop:"",workday:"",ca:"",sanluong:"",ot:""}}fetchData(){fetch(ISD_BASE_URL+"cdc/fetchCdc",{headers:k()}).then(e=>e.json()).then(e=>{if("error"==e.status)c.a.warning(e.message,3);else if(e.data){let t=e.data.map((e,t)=>bn({},e,{key:t}));this.setState({data:t})}}).catch(e=>{c.a.error("Có lỗi khi tải dữ liệu sản lượng!",3),console.log(e)})}fetchNhanvien(){fetch(ISD_BASE_URL+"qlns/fetchNs",{headers:k()}).then(e=>e.json()).then(e=>{e.data?e.data&&(this.props.dispatch(u({nhansu:e.data})),this.setState({nhansuList:b(e.data,"ma_ns")})):c.a.error(e.message)}).catch(e=>{console.log(e)})}fetchTotal(){fetch(ISD_BASE_URL+"cdc/fetchTotal",{headers:k()}).then(e=>e.json()).then(e=>{if("error"==e.status)c.a.warning(e.message,3);else if(e.data){let t=e.data[0];this.setState({total:t})}}).catch(e=>{c.a.error("Có lỗi khi tải dữ liệu sản lượng!",3),console.log(e)})}componentDidMount(){this.fetchData(),this.fetchTotal(),this.fetchNhanvien()}render(){const e={body:{row:On,cell:Tn}};this.props.mainState.data;let t=this.props.mainState.nhansu||[];const a=this.columns.map(e=>e.editable?bn({},e,{onCell:t=>({record:t,inputType:e.dataIndex,dataIndex:e.dataIndex,title:e.title,editing:this.isEditing(t),required:e.required})}):e);return this.columns.map(e=>e.editable?bn({},e,{onCell:t=>({record:t,inputType:e.dataIndex,dataIndex:e.dataIndex,title:e.title,editing:this.isEditing(t),required:e.required})}):e),r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"table-operations"},r.a.createElement(w.a,null,r.a.createElement(x.a,{span:12},r.a.createElement("h2",{className:"head-title"},"Chuyển đổi công hàng tháng")))),r.a.createElement(w.a,null,r.a.createElement(x.a,{span:8},r.a.createElement("div",{className:"filter_adv"},r.a.createElement(jn,{label:"Lọc theo tháng"},r.a.createElement(In,{placeholder:"Chọn tháng",format:"MM/YYYY"})))),r.a.createElement(x.a,{span:8},r.a.createElement(jn,{label:"Lọc theo nhân viên"},r.a.createElement(_.a,{style:{width:200},showSearch:!0,mode:"multiple",placeholder:"Chọn nhân viên"},t.map(e=>r.a.createElement(Option,{value:e.ma_ns,key:e.ma_ns},e.name))))),r.a.createElement(x.a,{span:8},r.a.createElement("div",{className:"filter_adv"},r.a.createElement(jn,{label:"Tổng công"},this.state.total.tong_cong)))),r.a.createElement(C.a,{components:e,bordered:!0,dataSource:this.state.data,columns:a,rowClassName:"editable-row",footer:()=>r.a.createElement(w.a,null,r.a.createElement(x.a,{span:3}," Tổng công "),r.a.createElement(x.a,{span:3}," HS 1: ",this.state.total.heso1),r.a.createElement(x.a,{span:3}," HS 1.2: ",this.state.total.heso12),r.a.createElement(x.a,{span:3}," HS 1.3: ",this.state.total.heso13),r.a.createElement(x.a,{span:3}," HSOT 1: ",this.state.total.heso1),r.a.createElement(x.a,{span:3}," HSOT 1.2: ",this.state.total.heso1),r.a.createElement(x.a,{span:3}," HSOT 1.3: ",this.state.total.heso1),r.a.createElement(x.a,{span:3}," Tổng: ",this.state.total.tong_cong))}))}};const Nn=o.a.Header,An=o.a.Sider;o.a.Content;var Ln=Object(l.b)(e=>({mainState:e.main.present}))(class extends r.a.Component{constructor(...e){var t;return t=super(...e),this.state={collapsed:!1,logged:!1,loading:!0},this.toggle=(()=>{this.setState({collapsed:!this.state.collapsed})}),t}componentWillMount(){let e=this.props.mainState;if(e.userInfo)this.props.dispatch(u({defaultRouter:e.defaultRouter}));else{let e=sessionStorage.getItem("ISD_TOKEN");""!=e&&null!=e?fetch(ISD_BASE_URL+"fetchRoles",{headers:k()}).then(e=>e.json()).then(e=>{e.userInfo?this.props.dispatch(u({showLogin:!1,userRoles:e.scopes,defaultRouter:e.scopes[0]&&e.scopes[0].path?e.scopes[0].path:"",userInfo:e.userInfo})):"error"==e.status&&c.a.error(e.message,3),this.setState({loading:!1})}).catch(e=>{console.warn(e),this.setState({loading:!1})}):this.setState({loading:!1})}}renderContent(e){var t=this.props;let a=t.dispatch,n=t.mainState;switch(e){case"qldh":return r.a.createElement(ka,{dispatch:a,mainState:n});case"npp":return r.a.createElement(R,{dispatch:a,mainState:n});case"qluser":return r.a.createElement(V,{dispatch:a,mainState:n});case"qlkho":return r.a.createElement(se,{dispatch:a});case"qlvtkho":return r.a.createElement(pe,{mainState:n,dispatch:a});case"qlsx":return r.a.createElement(ut,{mainState:n,dispatch:a});case"qlcate":return r.a.createElement(Se,{dispatch:a});case"product":return r.a.createElement(Le,{dispatch:a,mainState:n});case"qlkh":return r.a.createElement(ke,{dispatch:a});case"qlphieunhap":return r.a.createElement(Yt,{dispatch:a,mainState:n});case"qlphieuxuat":return r.a.createElement(Sa,{dispatch:a,mainState:n});case"tinhtrangkho":return r.a.createElement(Ja,{dispatch:a,mainState:n});case"qlns":return r.a.createElement(an,{dispatch:a,mainState:n});case"qljobs":return r.a.createElement(cn,{dispatch:a,mainState:n});case"qlsl":return r.a.createElement(Cn,{dispatch:a,mainState:n});case"cdc":return r.a.createElement(qn,{dispatch:a,mainState:n})}}render(){if(this.state.loading)return r.a.createElement(G,null);if(this.props.mainState.showLogin)return r.a.createElement(J,{dispatch:this.props.dispatch});let e=this.props.mainState.defaultRouter;return r.a.createElement(o.a,null,r.a.createElement(An,{trigger:null,collapsible:!0,collapsed:this.state.collapsed},r.a.createElement("div",{style:{color:"#fff",textAlign:"center",padding:"10px 0"},className:"logo"},r.a.createElement("img",{style:{width:"50%"},src:"./images/logo.png"})),r.a.createElement(f,{mainState:this.props.mainState,dispatch:this.props.dispatch})),r.a.createElement(o.a,null,r.a.createElement(Nn,{style:{background:"#fff",padding:0}},r.a.createElement(h.a,{className:"trigger",type:this.state.collapsed?"menu-unfold":"menu-fold",onClick:this.toggle}),r.a.createElement(z,{mainState:this.props.mainState,dispatch:this.props.dispatch})),r.a.createElement("div",{style:{margin:"24px 16px",padding:24,background:"#fff",minHeight:280}},e?this.renderContent(e):r.a.createElement(G,null))))}}),Rn=a(61),Pn=a(133),Kn=a.n(Pn),Mn=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e};let Bn,Yn={showLogin:!0,defaultRouter:"",userRoles:[],categories:[],kho:[],products:[],productsForExport:[],phieunhap:{nguoi_giao_dich:"",ma_kho:"",note:"",editNote:"",address:"",products:[],editingKey:""},sx:{ma_sx:"",so:"",ma:"",cong_doan:"",ma_sp:"",co_lo:"",so_lo:"",nsx:"",hd:"",so_dk:"",dang_bao_che:"",qcdg:"",dh:"",tttb_kltb:"",products:[]},phieuAction:{addNewItem:!1,action:"view"},phieuxuat:{nguoi_giao_dich:"",ma_kho:"",note:"",editNote:"",address:"",products:[],editingKey:""},phieuXuatAction:{addNewItem:!1,action:"view",openModal:!1}};var Fn=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e};let Un={sidebar:{open:!1,columnId:null},notify:{open:!0,message:"Hahah",header:"Heheh",type:"success"},savePanel:{open:!1},saveDesignNow:!1};var Hn=a(297),Qn=a.n(Hn);let Vn=[p.UPDATE_STATE_DATA];var $n=Object(Rn.b)({main:Qn()((e=Yn,t)=>{switch(t.type){case p.START_APP:return Bn=Kn()(e),Bn=Mn({},Bn,t.defaultProps);case p.UPDATE_STATE_DATA:let a;return Bn=Kn()(e),t.updateData&&t.updateData.showLogin&&sessionStorage.setItem("ISD_TOKEN",""),t.updateData&&t.updateData.defaultRouter&&(a={phieuAction:Mn({},Bn.phieuAction,{addNewItem:!1})}),Bn=Mn({},Bn,a,t.updateData)}return e},{filter:(e,t,a)=>-1!==Vn.indexOf(e.type),limit:100}),ui:(e=Un,t)=>{switch(t.type){case p.UPDATE_UI:return Fn({},e,t.updateData);case p.TOGGLE_SAVE:return Fn({},e,{savePanel:{open:t.open}});case p.SAVE_DESIGN_NOW:return Fn({},e,{saveDesignNow:t.confirm||!1})}return e}});const Xn=Object(Rn.c)($n);Xn.close=(()=>Xn.dispatch(END));var Jn=Xn;const zn=document.getElementById("isd_app");i.a.render(r.a.createElement(l.a,{store:Jn},r.a.createElement(Ln,null)),zn)},422:function(e,t,a){var n={"./af":280,"./af.js":280,"./ar":279,"./ar-dz":278,"./ar-dz.js":278,"./ar-kw":277,"./ar-kw.js":277,"./ar-ly":276,"./ar-ly.js":276,"./ar-ma":275,"./ar-ma.js":275,"./ar-sa":274,"./ar-sa.js":274,"./ar-tn":273,"./ar-tn.js":273,"./ar.js":279,"./az":272,"./az.js":272,"./be":271,"./be.js":271,"./bg":270,"./bg.js":270,"./bm":269,"./bm.js":269,"./bn":268,"./bn.js":268,"./bo":267,"./bo.js":267,"./br":266,"./br.js":266,"./bs":265,"./bs.js":265,"./ca":264,"./ca.js":264,"./cs":263,"./cs.js":263,"./cv":262,"./cv.js":262,"./cy":261,"./cy.js":261,"./da":260,"./da.js":260,"./de":259,"./de-at":258,"./de-at.js":258,"./de-ch":257,"./de-ch.js":257,"./de.js":259,"./dv":256,"./dv.js":256,"./el":255,"./el.js":255,"./en-au":254,"./en-au.js":254,"./en-ca":253,"./en-ca.js":253,"./en-gb":252,"./en-gb.js":252,"./en-ie":251,"./en-ie.js":251,"./en-il":250,"./en-il.js":250,"./en-nz":249,"./en-nz.js":249,"./eo":248,"./eo.js":248,"./es":247,"./es-do":246,"./es-do.js":246,"./es-us":245,"./es-us.js":245,"./es.js":247,"./et":244,"./et.js":244,"./eu":243,"./eu.js":243,"./fa":242,"./fa.js":242,"./fi":241,"./fi.js":241,"./fo":240,"./fo.js":240,"./fr":239,"./fr-ca":238,"./fr-ca.js":238,"./fr-ch":237,"./fr-ch.js":237,"./fr.js":239,"./fy":236,"./fy.js":236,"./gd":235,"./gd.js":235,"./gl":234,"./gl.js":234,"./gom-latn":233,"./gom-latn.js":233,"./gu":232,"./gu.js":232,"./he":231,"./he.js":231,"./hi":230,"./hi.js":230,"./hr":229,"./hr.js":229,"./hu":228,"./hu.js":228,"./hy-am":227,"./hy-am.js":227,"./id":226,"./id.js":226,"./is":225,"./is.js":225,"./it":224,"./it.js":224,"./ja":223,"./ja.js":223,"./jv":222,"./jv.js":222,"./ka":221,"./ka.js":221,"./kk":220,"./kk.js":220,"./km":219,"./km.js":219,"./kn":218,"./kn.js":218,"./ko":217,"./ko.js":217,"./ky":216,"./ky.js":216,"./lb":215,"./lb.js":215,"./lo":214,"./lo.js":214,"./lt":213,"./lt.js":213,"./lv":212,"./lv.js":212,"./me":211,"./me.js":211,"./mi":210,"./mi.js":210,"./mk":209,"./mk.js":209,"./ml":208,"./ml.js":208,"./mn":207,"./mn.js":207,"./mr":206,"./mr.js":206,"./ms":205,"./ms-my":204,"./ms-my.js":204,"./ms.js":205,"./mt":203,"./mt.js":203,"./my":202,"./my.js":202,"./nb":201,"./nb.js":201,"./ne":200,"./ne.js":200,"./nl":199,"./nl-be":198,"./nl-be.js":198,"./nl.js":199,"./nn":197,"./nn.js":197,"./pa-in":196,"./pa-in.js":196,"./pl":195,"./pl.js":195,"./pt":194,"./pt-br":193,"./pt-br.js":193,"./pt.js":194,"./ro":192,"./ro.js":192,"./ru":191,"./ru.js":191,"./sd":190,"./sd.js":190,"./se":189,"./se.js":189,"./si":188,"./si.js":188,"./sk":187,"./sk.js":187,"./sl":186,"./sl.js":186,"./sq":185,"./sq.js":185,"./sr":184,"./sr-cyrl":183,"./sr-cyrl.js":183,"./sr.js":184,"./ss":182,"./ss.js":182,"./sv":181,"./sv.js":181,"./sw":180,"./sw.js":180,"./ta":179,"./ta.js":179,"./te":178,"./te.js":178,"./tet":177,"./tet.js":177,"./tg":176,"./tg.js":176,"./th":175,"./th.js":175,"./tl-ph":174,"./tl-ph.js":174,"./tlh":173,"./tlh.js":173,"./tr":172,"./tr.js":172,"./tzl":171,"./tzl.js":171,"./tzm":170,"./tzm-latn":169,"./tzm-latn.js":169,"./tzm.js":170,"./ug-cn":168,"./ug-cn.js":168,"./uk":167,"./uk.js":167,"./ur":166,"./ur.js":166,"./uz":165,"./uz-latn":164,"./uz-latn.js":164,"./uz.js":165,"./vi":163,"./vi.js":163,"./x-pseudo":162,"./x-pseudo.js":162,"./yo":161,"./yo.js":161,"./zh-cn":160,"./zh-cn.js":160,"./zh-hk":159,"./zh-hk.js":159,"./zh-tw":158,"./zh-tw.js":158};function r(e){var t=s(e);return a(t)}function s(e){var t=n[e];if(!(t+1)){var a=new Error("Cannot find module '"+e+"'");throw a.code="MODULE_NOT_FOUND",a}return t}r.keys=function(){return Object.keys(n)},r.resolve=s,e.exports=r,r.id=422},492:function(e,t,a){e.exports=a(315)}});